import{Y as O,b0 as X,j as e,a1 as Y,I as p,b1 as Z,b3 as d,f as z,aP as $,r as g,S as w,dL as L,dW as W,dX as G,dU as N,br as ee,dY as se,au as te,a0 as ae,cT as y,a$ as R,B as C,T as v,G as S,aA as ne,bc as B,aj as oe,u as re,V as le,ej as ce,bd as ie,dO as de,cN as A,cV as xe,bj as ue,p as V,l as he,U as me,n as be,bp as je,dQ as ge,H as pe,C as ve}from"./index-cNRh_qft.js";import{C as H}from"./confirm-dialog-V5NQjZtL.js";import{u as Ce,g as Pe,r as we,e as De,T as fe}from"./table-no-data-CeEeU6Ls.js";import{T as Re}from"./table-empty-rows-BTCIE_YQ.js";import{T as Se}from"./table-head-custom-DSpcVu4-.js";import{T as Te}from"./table-pagination-custom-xTp1jojO.js";import{T as ye,a as ke,b as Fe}from"./TableHead-DBnjkyMB.js";import{T as f}from"./TableCell-CGwO8Re3.js";import{s as k}from"./sumBy-ofy1HSRF.js";import{C as T}from"./Card-C_-31fGp.js";import"./empty-content-BzM3Az2z.js";import"./TablePagination-CNNZgEcm.js";import"./LastPage-ChYIEhQh.js";import"./Toolbar-BaRJzfzK.js";function Ie({row:s,onViewRow:u,onDeleteRow:a}){const{cliente:c,produto:l,valor:m,vencimento:x,status:h,recebimentos:i}=s,t=i.filter(n=>n.status==="Pago").length,b=i.length,j=O(),r=X(),D=e.jsx($,{variant:"soft",color:h==="Pago"&&"success"||h==="Pendente"&&"warning"||h==="Vencido"&&"error"||"default",children:h});return e.jsxs(e.Fragment,{children:[e.jsxs(ye,{hover:!0,children:[e.jsx(f,{sx:{whiteSpace:"nowrap"},children:c}),e.jsx(f,{sx:{whiteSpace:"nowrap"},children:l}),e.jsxs(f,{children:["R$ ",m.toLocaleString("pt-BR",{minimumFractionDigits:2})]}),e.jsx(f,{children:new Date(x).toLocaleDateString("pt-BR")}),e.jsxs(f,{children:[t,"/",b]}),e.jsx(f,{children:D}),e.jsx(f,{align:"right",sx:{px:1,whiteSpace:"nowrap"},children:e.jsx(Y,{color:r.open?"inherit":"default",onClick:r.onOpen,children:e.jsx(p,{icon:"eva:more-vertical-fill"})})})]}),e.jsxs(Z,{open:r.open,anchorEl:r.anchorEl,onClose:r.onClose,slotProps:{arrow:{placement:"right-top"}},children:[e.jsxs(d,{onClick:()=>{u(),r.onClose()},children:[e.jsx(p,{icon:"solar:eye-bold"}),"Ver Recebimentos"]}),e.jsxs(d,{onClick:()=>{j.onTrue(),r.onClose()},sx:{color:"error.main"},children:[e.jsx(p,{icon:"solar:trash-bin-trash-bold"}),"Excluir"]})]}),e.jsx(H,{open:j.value,onClose:j.onFalse,title:"Excluir",content:"Tem certeza que deseja excluir esta cobrança?",action:e.jsx(z,{variant:"contained",color:"error",onClick:a,children:"Excluir"})})]})}function Be({filters:s,dateError:u,onResetPage:a,canReset:c,onResetFilters:l}){const m=g.useCallback(t=>{s.setState({name:t.target.value})},[s]),x=g.useCallback(t=>{s.setState({startDate:t})},[s]),h=g.useCallback(t=>{s.setState({endDate:t})},[s]),i=g.useCallback(t=>{s.setState({status:t.target.value})},[s]);return e.jsxs(w,{spacing:2,alignItems:{xs:"flex-end",md:"center"},direction:{xs:"column",md:"row"},sx:{p:2.5,pr:{xs:2.5,md:1}},children:[e.jsx(L,{label:"Data início",value:s.state.startDate,onChange:x,slotProps:{textField:{fullWidth:!0}},sx:{maxWidth:{md:200}}}),e.jsx(L,{label:"Data fim",value:s.state.endDate,onChange:h,slotProps:{textField:{fullWidth:!0,error:u,helperText:u&&"Data fim deve ser maior que data início"}},sx:{maxWidth:{md:200}}}),e.jsxs(W,{sx:{flexShrink:0,width:{xs:1,md:200}},children:[e.jsx(G,{children:"Status"}),e.jsx(N,{value:s.state.status,onChange:i,input:e.jsx(se,{label:"Status"}),renderValue:t=>t,sx:{textTransform:"capitalize"},children:["todos","Pendente","Pago","Vencido"].map(t=>e.jsxs(d,{value:t,children:[e.jsx(ee,{disableRipple:!0,size:"small",checked:s.state.status===t}),t==="todos"?"Todos":t]},t))})]}),e.jsxs(w,{direction:"row",alignItems:"center",spacing:2,flexGrow:1,sx:{width:1},children:[e.jsx(te,{fullWidth:!0,value:s.state.name,onChange:m,placeholder:"Buscar cliente...",InputProps:{startAdornment:e.jsx(ae,{position:"start",children:e.jsx(p,{icon:"eva:search-fill",sx:{color:"text.disabled"}})})}}),c&&e.jsx(Y,{onClick:l,children:e.jsx(p,{icon:"solar:trash-bin-trash-bold"})})]})]})}function Ve({cobrancas:s,sx:u,...a}){const c=s.length,l=s.filter(n=>n.status==="Pago").length,m=s.filter(n=>n.status==="Pendente").length,x=s.filter(n=>n.status==="Vencido").length,h=k(s,n=>n.valor),i=k(s.filter(n=>n.status==="Pago"),n=>n.valor),t=k(s.filter(n=>n.status==="Pendente"),n=>n.valor),b=k(s.filter(n=>n.status==="Vencido"),n=>n.valor),j=c>0?h/c:0,r=c>0?l/c*100:0,D=[{title:"Total a Receber",value:R(h),icon:"solar:dollar-minimalistic-bold-duotone",subtitle:`${y(c)} cobranças`},{title:"Recebido",value:R(i),icon:"solar:check-circle-bold-duotone",subtitle:`${y(l)} cobranças pagas`},{title:"Pendente",value:R(t),icon:"solar:clock-circle-bold-duotone",subtitle:`${y(m)} cobranças pendentes`},{title:"Vencido",value:R(b),icon:"solar:danger-circle-bold-duotone",subtitle:`${y(x)} cobranças vencidas`}];return e.jsxs(w,{spacing:3,sx:u,...a,children:[e.jsxs(C,{children:[e.jsx(v,{variant:"h6",sx:{mb:1},children:"Resumo de Recebimentos"}),e.jsx(v,{variant:"body2",sx:{color:"text.secondary"},children:"Visão geral dos recebimentos e cobranças"})]}),e.jsx(S,{container:!0,spacing:3,children:D.map((n,F)=>e.jsx(S,{size:{xs:12,sm:6,md:3},children:e.jsxs(T,{sx:{p:3},children:[e.jsx(C,{sx:{display:"flex",alignItems:"center",mb:2,color:"text.secondary"},children:e.jsx(p,{icon:n.icon,width:24,sx:{mr:1}})}),e.jsx(v,{variant:"h4",sx:{mb:.5},children:n.value}),e.jsx(v,{variant:"subtitle2",sx:{mb:1,color:"text.primary"},children:n.title}),e.jsx(v,{variant:"caption",sx:{color:"text.secondary"},children:n.subtitle})]})},F))}),e.jsxs(S,{container:!0,spacing:3,children:[e.jsx(S,{size:{xs:12,sm:6},children:e.jsx(T,{sx:{p:3},children:e.jsx(w,{direction:"row",alignItems:"center",spacing:2,children:e.jsxs(C,{sx:{flexGrow:1},children:[e.jsx(v,{variant:"subtitle2",sx:{mb:.5},children:"Ticket Médio"}),e.jsxs(v,{variant:"body2",sx:{color:"text.secondary"},children:[e.jsx("strong",{children:R(j)})," por cobrança"]})]})})})}),e.jsx(S,{size:{xs:12,sm:6},children:e.jsx(T,{sx:{p:3},children:e.jsxs(w,{direction:"row",alignItems:"center",spacing:2,children:[e.jsx(C,{sx:{display:"flex",alignItems:"center",color:"success.main"},children:e.jsx(p,{icon:"solar:percent-circle-bold-duotone",width:24})}),e.jsxs(C,{sx:{flexGrow:1},children:[e.jsx(v,{variant:"subtitle2",sx:{mb:.5},children:"Taxa de Recebimento"}),e.jsxs(v,{variant:"body2",sx:{color:"text.secondary"},children:[e.jsx("strong",{children:ne(r)})," das cobranças foram pagas"]})]})]})})})]}),e.jsx(T,{sx:{p:3},children:e.jsxs(w,{direction:"row",alignItems:"center",spacing:2,children:[e.jsx(C,{sx:{display:"flex",alignItems:"center",color:"warning.main"},children:e.jsx(p,{icon:"solar:crown-bold-duotone",width:24})}),e.jsxs(C,{sx:{flexGrow:1},children:[e.jsx(v,{variant:"subtitle2",sx:{mb:1},children:"Oportunidade de revenda"}),e.jsxs(v,{variant:"body2",sx:{color:"text.secondary"},children:[e.jsx("strong",{children:"4"})," imóveis estão com mais de 90 dias de atraso, indicando possível necessidade de revenda."]})]})]})})]})}function Me({filters:s,totalResults:u,sx:a,...c}){const l=g.useCallback(()=>{s.setState({status:"todos"})},[s]),m=g.useCallback(()=>{s.setState({startDate:null,endDate:null})},[s]),x=g.useCallback(()=>{s.setState({name:""})},[s]);return e.jsxs(w,{spacing:1.5,...c,children:[e.jsxs(C,{sx:{typography:"body2"},children:[e.jsx("strong",{children:u}),e.jsx(C,{component:"span",sx:{color:"text.secondary",ml:.25},children:"resultados encontrados"})]}),e.jsxs(w,{flexGrow:1,spacing:1,direction:"row",flexWrap:"wrap",alignItems:"center",children:[s.state.status!=="todos"&&e.jsx(M,{label:"Status:",children:e.jsx(B,{size:"small",label:s.state.status,onDelete:l,deleteIcon:e.jsx(p,{icon:"mingcute:close-line"})})}),s.state.startDate&&s.state.endDate&&e.jsx(M,{label:"Data:",children:e.jsx(B,{size:"small",label:`${s.state.startDate.format("DD/MM/YYYY")} - ${s.state.endDate.format("DD/MM/YYYY")}`,onDelete:m,deleteIcon:e.jsx(p,{icon:"mingcute:close-line"})})}),!!s.state.name&&e.jsx(M,{label:"Palavra-chave:",children:e.jsx(B,{size:"small",label:s.state.name,onDelete:x,deleteIcon:e.jsx(p,{icon:"mingcute:close-line"})})}),e.jsx(z,{color:"error",onClick:()=>s.setState({name:"",status:"todos",startDate:null,endDate:null}),startIcon:e.jsx(p,{icon:"solar:trash-bin-trash-bold"}),children:"Limpar"})]})]})}function M({label:s,children:u}){return e.jsxs(w,{component:oe,variant:"outlined",spacing:1,direction:"row",sx:{p:1},children:[e.jsx(C,{component:"span",sx:{typography:"subtitle2"},children:s}),u]})}const ze=[{id:"cliente",label:"Cliente"},{id:"produto",label:"Produto"},{id:"valor",label:"Valor"},{id:"vencimento",label:"Vencimento"},{id:"recebimentos",label:"Recebimentos"},{id:"status",label:"Status"},{id:""}],Ee=ce;function Le(){const s=re(),u=le(),a=Ce({defaultOrderBy:"vencimento"}),c=O(),[l,m]=g.useState(Ee),[x,h]=g.useState(()=>String(new Date().getMonth()+1).padStart(2,"0")),i=ie({name:"",status:"todos",startDate:null,endDate:null}),{state:t}=i,b=de(t.startDate,t.endDate),j=x&&x!=="todos"?l.filter(o=>{const P=new Date(o.vencimento);return String(P.getMonth()+1).padStart(2,"0")===x}):l,r=Ae({inputData:j,comparator:Pe(a.order,a.orderBy),filters:t,dateError:b}),D=we(r,a.page,a.rowsPerPage),n=!!t.name||t.status!=="todos"||!!t.startDate&&!!t.endDate,F=!r.length&&n||!r.length,I=o=>j.filter(P=>P.status===o).length,U=[{value:"todos",label:"Todas",color:"default",count:j.length},{value:"Pago",label:"Pagas",color:"success",count:I("Pago")},{value:"Pendente",label:"Pendentes",color:"warning",count:I("Pendente")},{value:"Vencido",label:"Vencidas",color:"error",count:I("Vencido")}],q=g.useCallback(o=>{const P=l.filter(E=>E.id!==o);A.success("Cobrança excluída com sucesso!"),m(P),a.onUpdatePageDeleteRow(D.length)},[D.length,a,l]),J=g.useCallback(()=>{const o=l.filter(P=>!a.selected.includes(P.id));A.success("Cobranças excluídas com sucesso!"),m(o),a.onUpdatePageDeleteRows(D.length,r.length)},[r.length,D.length,a,l]),_=g.useCallback((o,P)=>{a.onResetPage(),i.setState({status:P})},[i,a]),K=g.useCallback(()=>{a.onResetPage(),i.setState({name:"",status:"todos",startDate:null,endDate:null})},[i,a]),Q=()=>e.jsx(H,{open:c.value,onClose:c.onFalse,title:"Excluir",content:e.jsxs(e.Fragment,{children:["Tem certeza que deseja excluir ",e.jsxs("strong",{children:[" ",a.selected.length," "]})," cobrança(s)?"]}),action:e.jsx(z,{variant:"contained",color:"error",onClick:()=>{J(),c.onFalse()},children:"Excluir"})});return e.jsxs(e.Fragment,{children:[e.jsxs(xe,{children:[e.jsx(ue,{heading:"Lista de Cobranças",links:[{name:"Dashboard",href:V.dashboard.root},{name:"Cobrança",href:V.dashboard.cobranca.root},{name:"Lista"}],action:e.jsxs(W,{size:"small",sx:{minWidth:200},children:[e.jsx(G,{children:"Selecionar Mês"}),e.jsxs(N,{value:x,label:"Selecionar Mês",onChange:o=>h(o.target.value),children:[e.jsx(d,{value:"todos",children:"Todos os meses"}),e.jsx(d,{value:"01",children:"Janeiro"}),e.jsx(d,{value:"02",children:"Fevereiro"}),e.jsx(d,{value:"03",children:"Março"}),e.jsx(d,{value:"04",children:"Abril"}),e.jsx(d,{value:"05",children:"Maio"}),e.jsx(d,{value:"06",children:"Junho"}),e.jsx(d,{value:"07",children:"Julho"}),e.jsx(d,{value:"08",children:"Agosto"}),e.jsx(d,{value:"09",children:"Setembro"}),e.jsx(d,{value:"10",children:"Outubro"}),e.jsx(d,{value:"11",children:"Novembro"}),e.jsx(d,{value:"12",children:"Dezembro"})]})]}),sx:{mb:{xs:3,md:5}}}),e.jsx(Ve,{cobrancas:j,sx:{mb:3}}),e.jsxs(T,{children:[e.jsx(he,{value:t.status,onChange:_,sx:{px:2.5,boxShadow:`inset 0 -2px 0 0 ${me(s.vars.palette.grey["500Channel"],.08)}`},children:U.map(o=>e.jsx(be,{value:o.value,label:o.label,iconPosition:"end",icon:e.jsx($,{variant:(o.value==="todos"||o.value===t.status)&&"filled"||"soft",color:o.color,children:o.count})},o.value))}),e.jsx(Be,{filters:i,dateError:b,onResetPage:a.onResetPage,canReset:n,onResetFilters:K}),n&&e.jsx(Me,{filters:i,totalResults:r.length,sx:{p:2.5,pt:0}}),e.jsx(C,{sx:{position:"relative"},children:e.jsx(je,{sx:{minHeight:444},children:e.jsxs(ke,{size:a.dense?"small":"medium",sx:{minWidth:800},children:[e.jsx(Se,{order:a.order,orderBy:a.orderBy,headCells:ze,onSort:a.onSort}),e.jsxs(Fe,{children:[r.slice(a.page*a.rowsPerPage,a.page*a.rowsPerPage+a.rowsPerPage).map(o=>e.jsx(Ie,{row:o,onDeleteRow:()=>q(o.id),onViewRow:()=>u.push(V.dashboard.cobranca.recebimentos(o.id))},o.id)),e.jsx(Re,{height:a.dense?56:76,emptyRows:De(a.page,a.rowsPerPage,r.length)}),e.jsx(fe,{notFound:F})]})]})})}),e.jsx(Te,{page:a.page,dense:a.dense,count:r.length,rowsPerPage:a.rowsPerPage,onPageChange:a.onChangePage,onChangeDense:a.onChangeDense,onRowsPerPageChange:a.onChangeRowsPerPage})]})]}),Q()]})}function Ae({inputData:s,comparator:u,filters:a,dateError:c}){const{name:l,status:m,startDate:x,endDate:h}=a,i=s.map((t,b)=>[t,b]);return i.sort((t,b)=>{const j=u(t[0],b[0]);return j!==0?j:t[1]-b[1]}),s=i.map(t=>t[0]),l&&(s=s.filter(t=>t.cliente.toLowerCase().indexOf(l.toLowerCase())!==-1)),m!=="todos"&&(s=s.filter(t=>t.status===m)),x&&h&&!c&&(s=s.filter(t=>{const b=new Date(t.vencimento);return ge(b,x,h)})),s}const Oe={title:`Cobrança lista | Dashboard - ${ve.appName}`};function es(){return e.jsxs(e.Fragment,{children:[e.jsx(pe,{children:e.jsxs("title",{children:[" ",Oe.title]})}),e.jsx(Le,{})]})}export{es as default};

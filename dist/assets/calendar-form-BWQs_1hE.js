import{bk as I,r as T,a9 as O,y as P,z,O as B,dO as N,e7 as L,cN as r,j as i,F as R,bp as M,S as G,K as c,bg as W,aV as _,a_ as K,a1 as Q,I as $,B as q,f as H,N as J,c6 as y,bn as U,Q as t,bl as j}from"./index-cNRh_qft.js";import{u as X,m as b}from"./index-ChnT1xRF.js";import{a as Y}from"./color-preview-C96dy_lS.js";const x=!1,p=O.calendar,Z={revalidateIfStale:x,revalidateOnFocus:x,revalidateOnReconnect:x};function lo(){const{data:o,isLoading:e,error:a,isValidating:d}=X(null,I,Z);return T.useMemo(()=>(console.log("ðŸ“… Calendar API desabilitada - aguardando backend"),{events:[],eventsLoading:!1,eventsError:null,eventsValidating:!1,eventsEmpty:!0}),[o==null?void 0:o.events,a,e,d])}async function u(o){b(p,e=>{const d=[...(e==null?void 0:e.events)||[],o];return{...e,events:d}},!1)}async function v(o){b(p,e=>{const d=((e==null?void 0:e.events)||[]).map(l=>l.id===o.id?{...l,...o}:l);return{...e,events:d}},!1)}async function E(o){b(p,e=>{const d=((e==null?void 0:e.events)||[]).filter(l=>l.id!==o);return{...e,events:d}},!1)}const oo=B({title:t().min(1,{message:"TÃ­tulo Ã© obrigatÃ³rio!"}).max(100,{message:"TÃ­tulo deve ter menos de 100 caracteres"}),description:t().min(1,{message:"DescriÃ§Ã£o Ã© obrigatÃ³ria!"}).min(10,{message:"DescriÃ§Ã£o deve ter pelo menos 10 caracteres"}),color:t(),allDay:U(),start:y([t(),j()]),end:y([t(),j()])});function ao({currentEvent:o,colorOptions:e,onClose:a,redirectToOrder:d=!1,onSuccess:l}){const S={title:(o==null?void 0:o.title)||"Visita agendada",description:(o==null?void 0:o.description)||"Visita agendada para o cliente",color:(o==null?void 0:o.color)||e[0]||"#1976d2",allDay:(o==null?void 0:o.allDay)||!1,start:(o==null?void 0:o.start)||new Date().getTime(),end:(o==null?void 0:o.end)||new Date(Date.now()+36e5).getTime()},f=P({mode:"all",resolver:z(oo),defaultValues:S}),{reset:w,watch:k,control:C,handleSubmit:D,formState:{isSubmitting:V}}=f,h=k(),m=N(h.start,h.end),A=D(async s=>{console.log("onSubmit chamado com dados:",s),console.log("dateError:",m);const n={id:o!=null&&o.id?o==null?void 0:o.id:L(),color:s==null?void 0:s.color,title:s==null?void 0:s.title,allDay:s==null?void 0:s.allDay,description:s==null?void 0:s.description,end:s==null?void 0:s.end,start:s==null?void 0:s.start};console.log("eventData criado:",n);try{if(m)console.log("Erro de data detectado, nÃ£o enviando formulÃ¡rio");else{if(console.log("Sem erro de data, prosseguindo..."),o!=null&&o.id)console.log("Atualizando evento existente"),await v(n),r.success("Atualizado com sucesso!");else if(console.log("Criando novo evento"),await u(n),r.success("Visita agendada com sucesso!"),console.log("Chamando onSuccess:",!!l),l){const g=new Date(n.start);l(g)}console.log("Fechando modal e resetando formulÃ¡rio"),a(),w()}}catch(g){console.error("Erro no onSubmit:",g),r.error("Erro ao agendar visita!")}}),F=T.useCallback(async()=>{try{await E(`${o==null?void 0:o.id}`),r.success("ExcluÃ­do com sucesso!"),a()}catch(s){console.error(s)}},[o==null?void 0:o.id,a]);return i.jsxs(R,{methods:f,onSubmit:A,children:[i.jsx(M,{sx:{p:3,bgcolor:"background.neutral"},children:i.jsxs(G,{spacing:3,children:[i.jsx(c.Text,{name:"title",label:"TÃ­tulo"}),i.jsx(c.Text,{name:"description",label:"DescriÃ§Ã£o",multiline:!0,rows:3}),i.jsx(c.Switch,{name:"allDay",label:"Dia inteiro"}),i.jsx(c.MobileDateTimePicker,{name:"start",label:"Data de inÃ­cio"}),i.jsx(c.MobileDateTimePicker,{name:"end",label:"Data de tÃ©rmino",slotProps:{textField:{error:m,helperText:m?"Data de tÃ©rmino deve ser posterior Ã  data de inÃ­cio":null}}}),i.jsx(W,{name:"color",control:C,render:({field:s})=>i.jsx(Y,{value:s.value,onChange:n=>s.onChange(n),options:e})})]})}),i.jsxs(_,{sx:{flexShrink:0},children:[!!(o!=null&&o.id)&&i.jsx(K,{title:"Excluir evento",children:i.jsx(Q,{onClick:F,children:i.jsx($,{icon:"solar:trash-bin-trash-bold"})})}),i.jsx(q,{sx:{flexGrow:1}}),i.jsx(H,{variant:"outlined",color:"inherit",onClick:a,children:"Cancelar"}),i.jsx(J,{type:"submit",variant:"contained",loading:V,disabled:m,children:"Agendar visita"})]})]})}export{ao as C,v as a,lo as u};

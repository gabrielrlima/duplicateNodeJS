import{r as v,c8 as Dt}from"./index-D82XrlGq.js";import{s as Zt}from"./index-AY8D22yG.js";const Ut=0,Ht=1,$t=2,xt=3;var Pt=Object.prototype.hasOwnProperty;function mt(t,e){var n,s;if(t===e)return!0;if(t&&e&&(n=t.constructor)===e.constructor){if(n===Date)return t.getTime()===e.getTime();if(n===RegExp)return t.toString()===e.toString();if(n===Array){if((s=t.length)===e.length)for(;s--&&mt(t[s],e[s]););return s===-1}if(!n||typeof t=="object"){s=0;for(n in t)if(Pt.call(t,n)&&++s&&!Pt.call(e,n)||!(n in e)||!mt(t[n],e[n]))return!1;return Object.keys(e).length===s}}return t!==t&&e!==e}const W=new WeakMap,j=()=>{},D=j(),pt=Object,i=t=>t===D,N=t=>typeof t=="function",q=(t,e)=>({...t,...e}),kt=t=>N(t.then),ut={},st={},Tt="undefined",Q=typeof window!=Tt,ht=typeof document!=Tt,te=Q&&"Deno"in window,ee=()=>Q&&typeof window.requestAnimationFrame!=Tt,Bt=(t,e)=>{const n=W.get(t);return[()=>!i(e)&&t.get(e)||ut,s=>{if(!i(e)){const c=t.get(e);e in st||(st[e]=c),n[5](e,q(c,s),c||ut)}},n[6],()=>!i(e)&&e in st?st[e]:!i(e)&&t.get(e)||ut]};let gt=!0;const ne=()=>gt,[wt,vt]=Q&&window.addEventListener?[window.addEventListener.bind(window),window.removeEventListener.bind(window)]:[j,j],se=()=>{const t=ht&&document.visibilityState;return i(t)||t!=="hidden"},re=t=>(ht&&document.addEventListener("visibilitychange",t),wt("focus",t),()=>{ht&&document.removeEventListener("visibilitychange",t),vt("focus",t)}),oe=t=>{const e=()=>{gt=!0,t()},n=()=>{gt=!1};return wt("online",e),wt("offline",n),()=>{vt("online",e),vt("offline",n)}},ie={isOnline:ne,isVisible:se},ae={initFocus:re,initReconnect:oe},Wt=!Dt.useId,X=!Q||te,ce=t=>ee()?window.requestAnimationFrame(t):setTimeout(t,1),lt=X?v.useEffect:v.useLayoutEffect,ft=typeof navigator<"u"&&navigator.connection,Mt=!X&&ft&&(["slow-2g","2g"].includes(ft.effectiveType)||ft.saveData),rt=new WeakMap,ue=t=>pt.prototype.toString.call(t),dt=(t,e)=>t===`[object ${e}]`;let le=0;const Ot=t=>{const e=typeof t,n=ue(t),s=dt(n,"Date"),c=dt(n,"RegExp"),l=dt(n,"Object");let o,u;if(pt(t)===t&&!s&&!c){if(o=rt.get(t),o)return o;if(o=++le+"~",rt.set(t,o),Array.isArray(t)){for(o="@",u=0;u<t.length;u++)o+=Ot(t[u])+",";rt.set(t,o)}if(l){o="#";const R=pt.keys(t).sort();for(;!i(u=R.pop());)i(t[u])||(o+=u+":"+Ot(t[u])+",");rt.set(t,o)}}else o=s?t.toJSON():e=="symbol"?t.toString():e=="string"?JSON.stringify(t):""+t;return o},_t=t=>{if(N(t))try{t=t()}catch{t=""}const e=t;return t=typeof t=="string"?t:(Array.isArray(t)?t.length:t)?Ot(t):"",[t,e]};let fe=0;const St=()=>++fe;async function Kt(...t){const[e,n,s,c]=t,l=q({populateCache:!0,throwOnError:!0},typeof c=="boolean"?{revalidate:c}:c||{});let o=l.populateCache;const u=l.rollbackOnError;let R=l.optimisticData;const A=T=>typeof u=="function"?u(T):u!==!1,O=l.throwOnError;if(N(n)){const T=n,m=[],b=e.keys();for(const p of b)!/^\$(inf|sub)\$/.test(p)&&T(e.get(p)._k)&&m.push(p);return Promise.all(m.map(g))}return g(n);async function g(T){const[m]=_t(T);if(!m)return;const[b,p]=Bt(e,m),[ot,r,Z,J]=W.get(e),M=()=>{const _=ot[m];return(N(l.revalidate)?l.revalidate(b().data,T):l.revalidate!==!1)&&(delete Z[m],delete J[m],_&&_[0])?_[0]($t).then(()=>b().data):b().data};if(t.length<3)return M();let S=s,F,L=!1;const E=St();r[m]=[E,0];const $=!i(R),V=b(),k=V.data,tt=V._c,U=i(tt)?k:tt;if($&&(R=N(R)?R(U,k):R,p({data:R,_c:U})),N(S))try{S=S(U)}catch(_){F=_,L=!0}if(S&&kt(S))if(S=await S.catch(_=>{F=_,L=!0}),E!==r[m][0]){if(L)throw F;return S}else L&&$&&A(F)&&(o=!0,p({data:U,_c:D}));if(o&&!L)if(N(o)){const _=o(S,U);p({data:_,error:D,_c:D})}else p({data:S,error:D,_c:D});if(r[m][1]=St(),Promise.resolve(M()).then(()=>{p({_c:D})}),L){if(O)throw F;return}return S}}const jt=(t,e)=>{for(const n in t)t[n][0]&&t[n][0](e)},de=(t,e)=>{if(!W.has(t)){const n=q(ae,e),s=Object.create(null),c=Kt.bind(D,t);let l=j;const o=Object.create(null),u=(O,g)=>{const T=o[O]||[];return o[O]=T,T.push(g),()=>T.splice(T.indexOf(g),1)},R=(O,g,T)=>{t.set(O,g);const m=o[O];if(m)for(const b of m)b(g,T)},A=()=>{if(!W.has(t)&&(W.set(t,[s,Object.create(null),Object.create(null),Object.create(null),c,R,u]),!X)){const O=n.initFocus(setTimeout.bind(D,jt.bind(D,s,Ut))),g=n.initReconnect(setTimeout.bind(D,jt.bind(D,s,Ht)));l=()=>{O&&O(),g&&g(),W.delete(t)}}};return A(),[t,c,A,l]}return[t,W.get(t)[4]]},Ee=(t,e,n,s,c)=>{const l=n.errorRetryCount,o=c.retryCount,u=~~((Math.random()+.5)*(1<<(o<8?o:8)))*n.errorRetryInterval;!i(l)&&o>l||setTimeout(s,u,c)},Re=mt,[zt,me]=de(new Map),pe=q({onLoadingSlow:j,onSuccess:j,onError:j,onErrorRetry:Ee,onDiscarded:j,revalidateOnFocus:!0,revalidateOnReconnect:!0,revalidateIfStale:!0,shouldRetryOnError:!0,errorRetryInterval:Mt?1e4:5e3,focusThrottleInterval:5*1e3,dedupingInterval:2*1e3,loadingTimeout:Mt?5e3:3e3,compare:Re,isPaused:()=>!1,cache:zt,mutate:me,fallback:{}},ie),he=(t,e)=>{const n=q(t,e);if(e){const{use:s,fallback:c}=t,{use:l,fallback:o}=e;s&&l&&(n.use=s.concat(l)),c&&o&&(n.fallback=q(c,o))}return n},ge=v.createContext({}),we="$inf$",Jt=Q&&window.__SWR_DEVTOOLS_USE__,ve=Jt?window.__SWR_DEVTOOLS_USE__:[],Oe=()=>{Jt&&(window.__SWR_DEVTOOLS_REACT__=Dt)},Se=t=>N(t[1])?[t[0],t[1],t[2]||{}]:[t[0],null,(t[1]===null?t[2]:t[1])||{}],De=()=>{const t=v.useContext(ge);return v.useMemo(()=>q(pe,t),[t])},Te=t=>(e,n,s)=>t(e,n&&((...l)=>{const[o]=_t(e),[,,,u]=W.get(zt);if(o.startsWith(we))return n(...l);const R=u[o];return i(R)?n(...l):(delete u[o],R)}),s),_e=ve.concat(Te),Ce=t=>function(...n){const s=De(),[c,l,o]=Se(n),u=he(s,o);let R=t;const{use:A}=u,O=(A||[]).concat(_e);for(let g=O.length;g--;)R=O[g](R);return R(c,l||u.fetcher||null,u)},ye=(t,e,n)=>{const s=e[t]||(e[t]=[]);return s.push(n),()=>{const c=s.indexOf(n);c>=0&&(s[c]=s[s.length-1],s.pop())}};Oe();const Et=Dt.use||(t=>{switch(t.status){case"pending":throw t;case"fulfilled":return t.value;case"rejected":throw t.reason;default:throw t.status="pending",t.then(e=>{t.status="fulfilled",t.value=e},e=>{t.status="rejected",t.reason=e}),t}}),Rt={dedupe:!0},qt=Promise.resolve(D),Ae=(t,e,n)=>{const{cache:s,compare:c,suspense:l,fallbackData:o,revalidateOnMount:u,revalidateIfStale:R,refreshInterval:A,refreshWhenHidden:O,refreshWhenOffline:g,keepPreviousData:T}=n,[m,b,p,ot]=W.get(s),[r,Z]=_t(t),J=v.useRef(!1),M=v.useRef(!1),S=v.useRef(r),F=v.useRef(e),L=v.useRef(n),E=()=>L.current,$=()=>E().isVisible()&&E().isOnline(),[V,k,tt,U]=Bt(s,r),_=v.useRef({}).current,G=i(o)?i(n.fallback)?D:n.fallback[r]:o,Ct=(a,d)=>{for(const h in _){const f=h;if(f==="data"){if(!c(a[f],d[f])&&(!i(a[f])||!c(nt,d[f])))return!1}else if(d[f]!==a[f])return!1}return!0},yt=v.useMemo(()=>{const a=!r||!e?!1:i(u)?E().isPaused()||l?!1:R!==!1:u,d=C=>{const x=q(C);return delete x._k,a?{isValidating:!0,isLoading:!0,...x}:x},h=V(),f=U(),I=d(h),z=h===f?I:d(f);let w=I;return[()=>{const C=d(V());return Ct(C,w)?(w.data=C.data,w.isLoading=C.isLoading,w.isValidating=C.isValidating,w.error=C.error,w):(w=C,C)},()=>z]},[s,r]),B=Zt.useSyncExternalStore(v.useCallback(a=>tt(r,(d,h)=>{Ct(h,d)||a()}),[s,r]),yt[0],yt[1]),At=!J.current,Gt=m[r]&&m[r].length>0,K=B.data,H=i(K)?G&&kt(G)?Et(G):G:K,et=B.error,it=v.useRef(H),nt=T?i(K)?i(it.current)?H:it.current:K:H,It=Gt&&!i(et)?!1:At&&!i(u)?u:E().isPaused()?!1:l?i(H)?!1:R:i(H)||R,bt=!!(r&&e&&At&&It),Yt=i(B.isValidating)?bt:B.isValidating,Xt=i(B.isLoading)?bt:B.isLoading,Y=v.useCallback(async a=>{const d=F.current;if(!r||!d||M.current||E().isPaused())return!1;let h,f,I=!0;const z=a||{},w=!p[r]||!z.dedupe,C=()=>Wt?!M.current&&r===S.current&&J.current:r===S.current,x={isValidating:!1,isLoading:!1},Vt=()=>{k(x)},Nt=()=>{const y=p[r];y&&y[1]===f&&delete p[r]},Ft={isValidating:!0};i(V().data)&&(Ft.isLoading=!0);try{if(w&&(k(Ft),n.loadingTimeout&&i(V().data)&&setTimeout(()=>{I&&C()&&E().onLoadingSlow(r,n)},n.loadingTimeout),p[r]=[d(Z),St()]),[h,f]=p[r],h=await h,w&&setTimeout(Nt,n.dedupingInterval),!p[r]||p[r][1]!==f)return w&&C()&&E().onDiscarded(r),!1;x.error=D;const y=b[r];if(!i(y)&&(f<=y[0]||f<=y[1]||y[1]===0))return Vt(),w&&C()&&E().onDiscarded(r),!1;const P=V().data;x.data=c(P,h)?P:h,w&&C()&&E().onSuccess(h,r,n)}catch(y){Nt();const P=E(),{shouldRetryOnError:at}=P;P.isPaused()||(x.error=y,w&&C()&&(P.onError(y,r,P),(at===!0||N(at)&&at(y))&&(!E().revalidateOnFocus||!E().revalidateOnReconnect||$())&&P.onErrorRetry(y,r,P,Qt=>{const ct=m[r];ct&&ct[0]&&ct[0](xt,Qt)},{retryCount:(z.retryCount||0)+1,dedupe:!0})))}return I=!1,Vt(),!0},[r,s]),Lt=v.useCallback((...a)=>Kt(s,S.current,...a),[]);if(lt(()=>{F.current=e,L.current=n,i(K)||(it.current=K)}),lt(()=>{if(!r)return;const a=Y.bind(D,Rt);let d=0;E().revalidateOnFocus&&(d=Date.now()+E().focusThrottleInterval);const f=ye(r,m,(I,z={})=>{if(I==Ut){const w=Date.now();E().revalidateOnFocus&&w>d&&$()&&(d=w+E().focusThrottleInterval,a())}else if(I==Ht)E().revalidateOnReconnect&&$()&&a();else{if(I==$t)return Y();if(I==xt)return Y(z)}});return M.current=!1,S.current=r,J.current=!0,k({_k:Z}),It&&(p[r]||(i(H)||X?a():ce(a))),()=>{M.current=!0,f()}},[r]),lt(()=>{let a;function d(){const f=N(A)?A(V().data):A;f&&a!==-1&&(a=setTimeout(h,f))}function h(){!V().error&&(O||E().isVisible())&&(g||E().isOnline())?Y(Rt).then(d):d()}return d(),()=>{a&&(clearTimeout(a),a=-1)}},[A,O,g,r]),v.useDebugValue(nt),l){const a=r&&i(H);if(!Wt&&X&&a)throw new Error("Fallback data is required when using Suspense in SSR.");a&&(F.current=e,L.current=n,M.current=!1);const d=ot[r],h=!i(d)&&a?Lt(d):qt;if(Et(h),!i(et)&&a)throw et;const f=a?Y(Rt):qt;!i(nt)&&a&&(f.status="fulfilled",f.value=!0),Et(f)}return{mutate:Lt,get data(){return _.data=!0,nt},get error(){return _.error=!0,et},get isValidating(){return _.isValidating=!0,Yt},get isLoading(){return _.isLoading=!0,Xt}}},Ve=Ce(Ae);export{me as m,Ve as u};

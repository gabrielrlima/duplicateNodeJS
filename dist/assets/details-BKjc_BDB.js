import{bk as R,r as o,e5 as T,V as P,W as w,p as S,j as e,cV as O,B as L,a1 as k,I as F,T as $,C as f,H as G}from"./index-cNRh_qft.js";import{E as V}from"./empty-content-BzM3Az2z.js";import"./filters-result-BTXXEhsP.js";import"./calendar-form-BWQs_1hE.js";import"./vendas-new-edit-form-CFjQN1J_.js";import{u as H}from"./use-params-DYuE92tD.js";import{u as M}from"./index-ChnT1xRF.js";import{u as W,a as B,b as U,C as z,c as J,d as Q,e as _,f as q}from"./use-collapse-nav-DL8nVFbp.js";import{C as K}from"./styles-BI8UEJk6.js";import"./color-preview-C96dy_lS.js";import"./property-_4o4UaMH.js";import"./Card-C_-31fGp.js";import"./CardHeader-CZZHKPlX.js";import"./index-BDJJM9HW.js";import"./use-light-box-Bxjny2_T.js";import"./keyBy-Dc3MaNHd.js";import"./Skeleton-XGh2Uz0E.js";import"./AvatarGroup-B32XWlKs.js";const X={revalidateIfStale:!1,revalidateOnFocus:!1,revalidateOnReconnect:!1};function Y(n){const{data:s,isLoading:p,error:a,isValidating:i}=M(null,R,X),t=o.useMemo(()=>{if(!n)return null;let l=T.find(c=>c.id===n);if(!l){const c={clientName:"João Silva",clientPhone:"(11) 99999-9999",clientEmail:"joao.silva@email.com",propertyName:"Cobertura Sunset - 4",unitType:"66 m² - 1 Q",availableUnits:"Apartamento 305"};l={id:n,sent:0,taxes:0,status:"atendimento",discount:0,shipping:0,subtotal:0,subTotalPrice:0,createDate:new Date,dueDate:new Date,totalAmount:0,invoiceNumber:`INV-${n}`,corretorId:"1",invoiceFrom:{id:"from-1",name:"Empresa",email:"empresa@email.com",phone:"(11) 99999-9999",address:"Endereço da empresa",company:"Empresa Ltda",primary:!0},invoiceTo:{id:"to-1",name:"Cliente",email:"cliente@email.com",phone:"(11) 88888-8888",address:"Endereço do cliente",company:"Cliente Ltda",primary:!1},items:[],history:{orderTime:new Date().toISOString(),paymentTime:new Date().toISOString(),deliveryTime:new Date().toISOString(),completionTime:new Date().toISOString(),timeline:[{title:"Atendimento criado",time:new Date().toISOString()}]},formData:c}}return l},[n]);return o.useMemo(()=>({venda:(s==null?void 0:s.venda)||t,vendaLoading:p,vendaError:a,vendaValidating:i}),[s==null?void 0:s.venda,t,a,p,i])}function Z(){var b;const n=P(),{id:d=""}=H(),{user:s}=w(),{contacts:p}=W(),{venda:a}=Y(d),i=`venda-${d}`,{conversation:t,conversationError:u,conversationLoading:l}=B(i),c=U(),[g,E]=o.useState([]),[x,h]=o.useState([]);o.useEffect(()=>{i||o.startTransition(()=>{n.push(S.dashboard.chat)})},[u,n,i]),o.useEffect(()=>{t!=null&&t.participants&&h(t.participants)},[t==null?void 0:t.participants,s==null?void 0:s.id]);const C=o.useCallback(r=>{E(r)},[]),I=o.useCallback(r=>{h(m=>m.some(D=>D.id===r.id||D.email===r.email)?m:[...m,r])},[]),A=o.useCallback(r=>{h(m=>m.filter(y=>y.id!==r))},[]),v=x.filter(r=>r.role!=="IA Assistente"),N=x,j=i&&t;return e.jsxs(O,{maxWidth:!1,sx:{display:"flex",flex:"1 1 auto",flexDirection:"column"},children:[e.jsxs(L,{sx:{display:"flex",alignItems:"center",gap:2,mb:{xs:3,md:5}},children:[e.jsx(k,{onClick:()=>n.push(S.dashboard.vendas.root),sx:{bgcolor:"action.hover","&:hover":{bgcolor:"action.selected"}},children:e.jsx(F,{icon:"eva:arrow-back-fill"})}),e.jsxs($,{variant:"h4",children:["Atendimento - ",((b=a==null?void 0:a.invoiceTo)==null?void 0:b.name)||"Cliente"," #"," ",(a==null?void 0:a.invoiceNumber)||`VND-${String(d).padStart(4,"0")}`]})]}),e.jsx(K,{slots:{header:j?e.jsx(_,{collapseNav:c,participants:v,loading:l,vendaStatus:a==null?void 0:a.status,onAddParticipant:I,onRemoveParticipant:A}):e.jsx(q,{contacts:p,onAddRecipients:C}),nav:null,main:e.jsxs(e.Fragment,{children:[i?u?e.jsx(V,{title:u.message,imgUrl:`${f.assetsDir}/assets/icons/empty/ic-chat-empty.svg`}):e.jsx(J,{messages:(t==null?void 0:t.messages)??[],participants:N,loading:l}):e.jsx(V,{title:"Good morning!",description:"Write something awesome...",imgUrl:`${f.assetsDir}/assets/icons/empty/ic-chat-active.svg`}),e.jsx(Q,{recipients:g,onAddRecipients:C,selectedConversationId:i,disabled:!g.length&&!i})]}),details:j&&e.jsx(z,{collapseNav:c,participants:v,loading:l,messages:(t==null?void 0:t.messages)??[]})}})]})}const ee={title:`Vendas details | Dashboard - ${f.appName}`};function ve(){return e.jsxs(e.Fragment,{children:[e.jsx(G,{children:e.jsxs("title",{children:[" ",ee.title]})}),e.jsx(Z,{})]})}export{ve as default};

import{u as q,Y as K,r as D,dZ as Y,dC as Z,dD as J,c5 as I,j as e,c4 as M,S as A,D as L,l as Q,U as X,n as ee,aP as F,d_ as se,B as d,f as C,dF as ae,ca as te,a1 as re,R as V,I as h,T as t,cN as oe,p as z,cb as ne,cc as ie,cd as le,V as ce,b8 as S,G as m,A as de,aA as R,b6 as E,cG as xe,aB as me,aK as k,aS as he,aT as ue,aU as pe,au as je,aV as ge,H as be,C as ve}from"./index-D82XrlGq.js";import{E as B}from"./empty-content-CAmd9egU.js";import"./corretor-new-edit-form-DDbtC7on.js";import"./filters-result-BUC8QtIh.js";import{u as fe}from"./use-params-BTd0VUeQ.js";import{a as ye}from"./use-corretores-D9KzIeK_.js";import{C as Ce}from"./confirm-dialog-rvtuH5TT.js";import{u as Pe,g as we,r as De,e as Te,T as Ie}from"./table-no-data-DH7CjOyR.js";import{T as Ae}from"./table-empty-rows-Vu5FyjZw.js";import{T as Se}from"./table-head-custom-CuFVaOdc.js";import{T as Re}from"./table-pagination-custom-D5_o9sKp.js";import{V as y,a as ze,b as Fe,c as Me}from"./vendas-table-filters-result-CSMYYp2K.js";import{C as f}from"./Card-Bw-3A9ev.js";import{s as N}from"./sumBy-ofy1HSRF.js";import{T as Ve,a as Ee}from"./TableHead-RMfhpLqX.js";import"./schema-helper-BcHhi0sG.js";import"./TableCell-9zzJlMjB.js";import"./TablePagination-DsJAP4En.js";import"./LastPage-xOhVKZvt.js";import"./Toolbar-CnhKmG_y.js";const ke=[{id:"invoiceNumber",label:"Cliente"},{id:"createDate",label:"Criado"},{id:"dueDate",label:"Ultima atualização"},{id:"price",label:"Valor"},{id:"sent",label:"Produto",align:"center"},{id:"status",label:"Status"},{id:"actions"}];function Be({corretorId:n}){const x=q(),a=Pe({defaultOrderBy:"createDate"}),p=K(),[c,b]=D.useState(Y.filter(r=>r.corretorId===n)),v=Z({name:"",service:[],status:"all",startDate:null,endDate:null}),{state:i,setState:s}=v,j=J(i.startDate,i.endDate),o=Ne({inputData:c,comparator:we(a.order,a.orderBy),filters:i,dateError:j}),l=De(o,a.page,a.rowsPerPage),T=!!i.name||i.service.length>0||i.status!=="all"||!!i.startDate&&!!i.endDate,O=!o.length&&T||!o.length,u=r=>c.filter(g=>g.status===r).length,P=r=>N(c.filter(g=>g.status===r),g=>g.totalAmount),w=r=>u(r)/c.length*100,_=[{value:"all",label:"Todos",color:"default",count:c.length},{value:"atendimento",label:"Atendimento",color:"warning",count:u("atendimento")},{value:"visita",label:"Visita",color:"info",count:u("visita")},{value:"interesse",label:"Interesse",color:"primary",count:u("interesse")},{value:"proposta",label:"Proposta",color:"secondary",count:u("proposta")},{value:"assinatura_pagamento",label:"Pagamento",color:"success",count:u("assinatura_pagamento")},{value:"cancelado",label:"Cancelado",color:"error",count:u("cancelado")}],H=D.useCallback(r=>{const g=c.filter(W=>W.id!==r);I.success("Delete success!"),b(g),a.onUpdatePageDeleteRow(l.length)},[l.length,a,c]),U=D.useCallback(()=>{const r=c.filter(g=>!a.selected.includes(g.id));I.success("Delete success!"),b(r),a.onUpdatePageDeleteRows(l.length,o.length)},[o.length,l.length,a,c]),G=D.useCallback((r,g)=>{a.onResetPage(),s({status:g})},[a,s]);return e.jsxs(e.Fragment,{children:[e.jsx(f,{sx:{mb:{xs:3,md:5}},children:e.jsx(M,{sx:{minHeight:108},children:e.jsxs(A,{divider:e.jsx(L,{orientation:"vertical",flexItem:!0,sx:{borderStyle:"dashed"}}),sx:{py:2,flexDirection:"row"},children:[e.jsx(y,{title:"Todos",total:c.length,percent:100,price:N(c,r=>r.totalAmount),icon:"solar:bill-list-bold-duotone",color:x.vars.palette.info.main}),e.jsx(y,{title:"Atendimento",total:u("atendimento"),percent:w("atendimento"),price:P("atendimento"),icon:"solar:user-speak-bold-duotone",color:x.vars.palette.warning.main}),e.jsx(y,{title:"Visita",total:u("visita"),percent:w("visita"),price:P("visita"),icon:"solar:home-bold-duotone",color:x.vars.palette.info.main}),e.jsx(y,{title:"Interesse",total:u("interesse"),percent:w("interesse"),price:P("interesse"),icon:"solar:heart-bold-duotone",color:x.vars.palette.primary.main}),e.jsx(y,{title:"Proposta",total:u("proposta"),percent:w("proposta"),price:P("proposta"),icon:"solar:document-text-bold-duotone",color:x.vars.palette.secondary.main}),e.jsx(y,{title:"Pagamento",total:u("assinatura_pagamento"),percent:w("assinatura_pagamento"),price:P("assinatura_pagamento"),icon:"solar:file-check-bold-duotone",color:x.vars.palette.success.main}),e.jsx(y,{title:"Cancelado",total:u("cancelado"),percent:w("cancelado"),price:P("cancelado"),icon:"solar:close-circle-bold-duotone",color:x.vars.palette.error.main})]})})}),e.jsxs(f,{children:[e.jsx(Q,{value:i.status,onChange:G,sx:{px:2.5,boxShadow:`inset 0 -2px 0 0 ${X(x.vars.palette.grey["500Channel"],.08)}`},children:_.map(r=>e.jsx(ee,{value:r.value,label:r.label,iconPosition:"end",icon:e.jsx(F,{variant:(r.value==="all"||r.value===i.status)&&"filled"||"soft",color:r.color,children:r.count})},r.value))}),e.jsx(ze,{filters:v,onResetPage:a.onResetPage,dateError:j,options:{services:se.map(r=>r.name)}}),T&&e.jsx(Fe,{filters:v,totalResults:o.length,onResetPage:a.onResetPage,sx:{p:2.5,pt:0}}),e.jsx(d,{sx:{position:"relative"},children:e.jsx(M,{sx:{minHeight:444},children:e.jsxs(Ve,{size:a.dense?"small":"medium",sx:{minWidth:800},children:[e.jsx(Se,{order:a.order,orderBy:a.orderBy,headCells:ke,onSort:a.onSort}),e.jsxs(Ee,{children:[o.slice(a.page*a.rowsPerPage,a.page*a.rowsPerPage+a.rowsPerPage).map(r=>e.jsx(Me,{row:r,onDeleteRow:()=>H(r.id),editHref:`/dashboard/vendas/${r.id}/edit`,detailsHref:`/dashboard/vendas/${r.id}`},r.id)),e.jsx(Ae,{height:a.dense?56:76,emptyRows:Te(a.page,a.rowsPerPage,o.length)}),e.jsx(Ie,{notFound:O,title:"Nenhuma opção para o filtro selecionado"})]})]})})}),e.jsx(Re,{page:a.page,dense:a.dense,count:o.length,rowsPerPage:a.rowsPerPage,onPageChange:a.onChangePage,onChangeDense:a.onChangeDense,onRowsPerPageChange:a.onChangeRowsPerPage})]}),$()]});function $(){return e.jsx(Ce,{open:p.value,onClose:p.onFalse,title:"Delete",content:e.jsxs(e.Fragment,{children:["Are you sure want to delete ",e.jsxs("strong",{children:[" ",a.selected.length," "]})," items?"]}),action:e.jsx(C,{variant:"contained",color:"error",onClick:()=>{U(),p.onFalse()},children:"Delete"})})}}function Ne({inputData:n,comparator:x,filters:a,dateError:p}){const{name:c,status:b,service:v,startDate:i,endDate:s}=a,j=n.map((o,l)=>[o,l]);return j.sort((o,l)=>{const T=x(o[0],l[0]);return T!==0?T:o[1]-l[1]}),n=j.map(o=>o[0]),c&&(n=n.filter(o=>o.invoiceNumber.toLowerCase().indexOf(c.toLowerCase())!==-1||o.invoiceTo.name.toLowerCase().indexOf(c.toLowerCase())!==-1)),b!=="all"&&(n=n.filter(o=>o.status===b)),v.length&&(n=n.filter(o=>o.items.some(l=>v.includes(l.service)))),p||i&&s&&(n=n.filter(o=>ae(o.createDate,i,s))),n}function Le({status:n,backHref:x,corretorId:a,createdAt:p,corretorName:c,statusOptions:b,onChangeStatus:v}){const i=te(),s=()=>e.jsx(ne,{open:i.open,anchorEl:i.anchorEl,onClose:i.onClose,slotProps:{arrow:{placement:"top-right"}},children:e.jsx(ie,{children:b.map(j=>e.jsx(le,{selected:j.value===n,onClick:()=>{i.onClose(),v(j.value)},children:j.label},j.value))})});return e.jsxs(e.Fragment,{children:[e.jsxs(d,{sx:{gap:3,display:"flex",mb:{xs:3,md:5},flexDirection:{xs:"column",md:"row"}},children:[e.jsxs(d,{sx:{gap:1,display:"flex",alignItems:"flex-start"},children:[e.jsx(re,{component:V,href:x,children:e.jsx(h,{icon:"eva:arrow-ios-back-fill"})}),e.jsxs(A,{spacing:.5,children:[e.jsxs(d,{sx:{gap:1,display:"flex",alignItems:"center"},children:[e.jsx(t,{variant:"h4",children:c}),e.jsxs(F,{variant:"soft",color:n==="ativo"&&"success"||n==="suspenso"&&"warning"||n==="inativo"&&"error"||"default",children:[n==="ativo"&&"Ativo",n==="suspenso"&&"Suspenso",n==="inativo"&&"Inativo"]})]}),e.jsx(t,{variant:"body2",sx:{color:"text.disabled"},children:oe(p)})]})]}),e.jsxs(d,{sx:{gap:1.5,flexGrow:1,display:"flex",alignItems:"center",justifyContent:"flex-end"},children:[e.jsxs(C,{color:"inherit",variant:"outlined",endIcon:e.jsx(h,{icon:"eva:arrow-ios-downward-fill"}),onClick:i.onOpen,sx:{textTransform:"capitalize"},children:[n==="ativo"&&"Ativo",n==="suspenso"&&"Suspenso",n==="inativo"&&"Inativo"]}),e.jsx(C,{color:"inherit",variant:"contained",startIcon:e.jsx(h,{icon:"solar:pen-bold"}),component:V,href:z.dashboard.corretores.edit(a),children:"Editar"})]})]}),s()]})}function Oe(){const n=ce(),{id:x}=fe(),[a,p]=D.useState(!1),[c,b]=D.useState(""),v=[{value:"ativo",label:"Ativo"},{value:"suspenso",label:"Suspenso"},{value:"inativo",label:"Inativo"}],i=l=>{console.log("Alterando status para:",l),I.success(`Status alterado para ${l}`)},{corretor:s,loading:j,error:o}=ye(x);return j?e.jsx(S,{children:e.jsx(B,{title:"Carregando corretor...",description:"Aguarde enquanto buscamos os dados",sx:{py:10}})}):o||!s?e.jsx(S,{children:e.jsx(B,{filled:!0,title:"Corretor não encontrado",description:o||"O corretor solicitado não foi encontrado",action:e.jsx(C,{variant:"contained",onClick:()=>n.push(z.dashboard.corretores.list),startIcon:e.jsx(h,{icon:"eva:arrow-back-fill"}),children:"Voltar para lista"}),sx:{py:10}})}):e.jsxs(S,{children:[e.jsx(Le,{status:s.status,backHref:z.dashboard.corretores.list,corretorId:s.id,corretorName:s.name,createdAt:s.createdAt,statusOptions:v,onChangeStatus:i}),e.jsxs(m,{container:!0,spacing:3,children:[e.jsxs(m,{size:{xs:12,md:4},children:[e.jsxs(f,{sx:{p:3,textAlign:"center"},children:[e.jsx(de,{alt:s.name,src:s.avatarUrl,sx:{width:120,height:120,mx:"auto",mb:2},children:s.name.split(" ").map(l=>l.charAt(0)).join("").toUpperCase().slice(0,2)}),e.jsx(t,{variant:"h5",sx:{mb:1},children:s.name}),e.jsx(t,{variant:"body2",sx:{color:"text.secondary",mb:2},children:s.especialidade||"Corretor Imobiliário"}),e.jsxs(F,{variant:"soft",color:s.status==="ativo"&&"success"||s.status==="ferias"&&"warning"||s.status==="inativo"&&"error"||"default",sx:{mb:3},children:[s.status==="ativo"&&"Ativo",s.status==="ferias"&&"Férias",s.status==="inativo"&&"Inativo"]}),e.jsx(L,{sx:{my:3}}),e.jsxs(A,{spacing:2,children:[e.jsxs(d,{sx:{display:"flex",alignItems:"center"},children:[e.jsx(h,{icon:"solar:phone-bold",sx:{mr:1,color:"text.secondary"}}),e.jsx(t,{variant:"body2",children:s.phone})]}),e.jsxs(d,{sx:{display:"flex",alignItems:"center"},children:[e.jsx(h,{icon:"solar:letter-bold",sx:{mr:1,color:"text.secondary"}}),e.jsx(t,{variant:"body2",children:s.email})]}),s.creci&&e.jsxs(d,{sx:{display:"flex",alignItems:"center"},children:[e.jsx(h,{icon:"solar:document-text-bold",sx:{mr:1,color:"text.secondary"}}),e.jsx(t,{variant:"body2",children:s.creci})]})]})]}),s.leads&&e.jsxs(f,{sx:{p:2.5,mt:3},children:[e.jsx(d,{sx:{display:"flex",alignItems:"center",mb:2},children:e.jsx(h,{icon:"solar:chart-2-bold-duotone",width:24,sx:{color:"secondary.main",mr:1}})}),e.jsx(t,{variant:"h5",sx:{mb:.5,fontSize:"1.2rem"},children:R(s.vendas/s.leads*100)}),e.jsx(t,{variant:"subtitle2",sx:{color:"text.secondary"},children:"Taxa de Conversão"})]})]}),e.jsx(m,{size:{xs:12,md:8},children:e.jsxs(A,{spacing:3,children:[e.jsxs(m,{container:!0,spacing:3,children:[e.jsx(m,{size:{xs:12,sm:6,md:3},children:e.jsxs(f,{sx:{p:2.5},children:[e.jsx(d,{sx:{display:"flex",alignItems:"center",mb:2},children:e.jsx(h,{icon:"solar:chart-square-bold-duotone",width:24,sx:{color:"primary.main",mr:1}})}),e.jsx(t,{variant:"h5",sx:{mb:.5,fontSize:"1.2rem"},children:E(s.vendas)}),e.jsxs(t,{variant:"subtitle2",sx:{color:"text.secondary"},children:["Vendas",e.jsx("br",{}),"Realizadas"]})]})}),e.jsx(m,{size:{xs:12,sm:6,md:3},children:e.jsxs(f,{sx:{p:2.5},children:[e.jsx(d,{sx:{display:"flex",alignItems:"center",mb:2},children:e.jsx(h,{icon:"solar:dollar-minimalistic-bold-duotone",width:24,sx:{color:"success.main",mr:1}})}),e.jsx(t,{variant:"h5",sx:{mb:.5,fontSize:"1.1rem"},children:xe(s.comissaoTotal)}),e.jsxs(t,{variant:"subtitle2",sx:{color:"text.secondary"},children:["Comissão",e.jsx("br",{}),"Total"]})]})}),s.meta&&e.jsx(m,{size:{xs:12,sm:6,md:3},children:e.jsxs(f,{sx:{p:2.5},children:[e.jsx(d,{sx:{display:"flex",alignItems:"center",mb:2},children:e.jsx(h,{icon:"solar:target-bold-duotone",width:24,sx:{color:"warning.main",mr:1}})}),e.jsx(t,{variant:"h5",sx:{mb:.5,fontSize:"1.2rem"},children:E(s.meta)}),e.jsxs(t,{variant:"subtitle2",sx:{color:"text.secondary"},children:["Meta",e.jsx("br",{}),"Mensal"]})]})}),s.performance&&e.jsx(m,{size:{xs:12,sm:6,md:3},children:e.jsxs(f,{sx:{p:2.5},children:[e.jsx(d,{sx:{display:"flex",alignItems:"center",mb:2},children:e.jsx(h,{icon:"solar:pie-chart-2-bold-duotone",width:24,sx:{color:"info.main",mr:1}})}),e.jsx(t,{variant:"h5",sx:{mb:.5,fontSize:"1.2rem"},children:R(s.performance)}),e.jsxs(t,{variant:"subtitle2",sx:{color:"text.secondary"},children:["Performance",e.jsx("br",{}),"Total"]})]})})]}),e.jsxs(f,{sx:{p:3},children:[e.jsxs(d,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3},children:[e.jsx(t,{variant:"h6",children:"Progresso da Meta"}),e.jsx(C,{variant:"outlined",size:"small",startIcon:e.jsx(h,{icon:"solar:pen-bold"}),onClick:()=>{var l;b(((l=s.meta)==null?void 0:l.toString())||""),p(!0)},children:s.meta?"Editar Meta":"Definir Meta"})]}),s.meta&&s.performance!==void 0?e.jsxs(e.Fragment,{children:[e.jsxs(d,{sx:{mb:2},children:[e.jsxs(d,{sx:{display:"flex",justifyContent:"space-between",mb:1},children:[e.jsxs(t,{variant:"body2",children:["Vendas: ",s.vendas," / ",s.meta]}),e.jsx(t,{variant:"body2",children:R(s.performance)})]}),e.jsx(me,{variant:"determinate",value:s.performance,color:s.performance>=80&&"success"||s.performance>=60&&"warning"||"error",sx:{height:8,borderRadius:1}})]}),e.jsx(t,{variant:"caption",sx:{color:"text.secondary"},children:s.performance>=100?"🎉 Meta superada! Parabéns!":s.performance>=80?"🔥 Muito próximo da meta!":s.performance>=60?"⚡ No caminho certo!":"💪 Vamos acelerar!"})]}):e.jsxs(d,{sx:{textAlign:"center",py:4},children:[e.jsx(h,{icon:"solar:target-bold",sx:{width:64,height:64,color:"primary.main",mb:2}}),e.jsx(t,{variant:"h6",sx:{mb:1,color:"text.primary"},children:"Bem-vindo(a)! 👋"}),e.jsx(t,{variant:"body2",sx:{color:"text.secondary",mb:2},children:"Para começar a acompanhar seu progresso, é necessário definir uma meta de vendas."}),e.jsx(t,{variant:"caption",sx:{color:"text.secondary"},children:'Clique no botão "Definir Meta" acima para começar!'})]})]}),e.jsxs(f,{sx:{p:3},children:[e.jsx(t,{variant:"h6",sx:{mb:3},children:"Informações Adicionais"}),e.jsxs(m,{container:!0,spacing:3,children:[e.jsxs(m,{size:{xs:12,sm:6},children:[e.jsx(t,{variant:"subtitle2",sx:{mb:1},children:"Data de Cadastro"}),e.jsx(t,{variant:"body2",sx:{color:"text.secondary"},children:k(s.createdAt)})]}),s.lastActivity&&e.jsxs(m,{size:{xs:12,sm:6},children:[e.jsx(t,{variant:"subtitle2",sx:{mb:1},children:"Última Atividade"}),e.jsx(t,{variant:"body2",sx:{color:"text.secondary"},children:k(s.lastActivity)})]}),s.especialidade&&e.jsxs(m,{size:{xs:12,sm:6},children:[e.jsx(t,{variant:"subtitle2",sx:{mb:1},children:"Especialidade"}),e.jsx(t,{variant:"body2",sx:{color:"text.secondary"},children:s.especialidade})]}),s.grupo&&e.jsxs(m,{size:{xs:12,sm:6},children:[e.jsx(t,{variant:"subtitle2",sx:{mb:1},children:"Grupo"}),e.jsx(t,{variant:"body2",sx:{color:"text.secondary"},children:s.grupo})]})]})]})]})}),e.jsx(m,{size:{xs:12},children:e.jsx(Be,{corretorId:s.id})})]}),e.jsxs(he,{open:a,onClose:()=>p(!1),maxWidth:"sm",fullWidth:!0,children:[e.jsx(ue,{children:"Editar Meta"}),e.jsx(pe,{children:e.jsx(je,{autoFocus:!0,margin:"dense",label:"Nova Meta",type:"number",fullWidth:!0,variant:"outlined",value:c,onChange:l=>b(l.target.value),sx:{mt:2}})}),e.jsxs(ge,{children:[e.jsx(C,{onClick:()=>p(!1),color:"inherit",children:"Cancelar"}),e.jsx(C,{onClick:()=>{console.log("Nova meta:",c),I.success("Meta atualizada com sucesso!"),p(!1)},variant:"contained",children:"Salvar"})]})]})]})}const _e={title:`Detalhes do corretor | Dashboard - ${ve.appName}`};function ls(){return e.jsxs(e.Fragment,{children:[e.jsx(be,{children:e.jsxs("title",{children:[" ",_e.title]})}),e.jsx(Oe,{})]})}export{ls as default};

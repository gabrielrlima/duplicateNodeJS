import{Y as G,b0 as oe,j as e,b1 as ie,b2 as ne,b3 as y,R as H,I as b,aJ as P,D as U,f as w,S as p,B as t,a$ as K,aP as Z,a1 as Q,bX as le,aj as re,cN as M,r as j,au as de,a0 as ce,dL as _,bc as R,dM as xe,bd as he,dO as me,eG as ue,cV as J,T as X,bj as ge,p as I,l as be,U as je,n as fe,bp as ve,dQ as pe,H as Ce,C as ye}from"./index-cNRh_qft.js";import{b as Pe,u as Se}from"./property-_4o4UaMH.js";import{u as De,g as Te,r as ke,e as Ie,T as Fe}from"./table-no-data-CeEeU6Ls.js";import{T as Re}from"./table-empty-rows-BTCIE_YQ.js";import{T as Ae}from"./table-head-custom-DSpcVu4-.js";import{T as Ee}from"./table-pagination-custom-xTp1jojO.js";import{C as we}from"./confirm-dialog-V5NQjZtL.js";import{T as Y,a as Me,b as ze}from"./TableHead-DBnjkyMB.js";import{T as v}from"./TableCell-CGwO8Re3.js";import{F as Be,a as A,c as E}from"./filters-result-BTXXEhsP.js";import{C as We}from"./Card-C_-31fGp.js";import"./index-ChnT1xRF.js";import"./index-BDJJM9HW.js";import"./empty-content-BzM3Az2z.js";import"./TablePagination-CNNZgEcm.js";import"./LastPage-ChYIEhQh.js";import"./Toolbar-BaRJzfzK.js";function Le({row:s,onDeleteRow:c,detailsHref:r,onUpdateStatus:m}){const o=G(),l=oe(),h=G(),d=async i=>{try{const g={disponivel:"available",reservado:"reserved",vendido:"sold",suspenso:"inactive"};await Pe(s.id,g[i]||i),M.success("Status atualizado com sucesso!"),m==null||m(i),l.onClose()}catch(g){console.error("Erro ao atualizar status:",g),M.error("Erro ao atualizar status do imóvel")}},u=()=>{var i;return e.jsxs(Y,{hover:!0,children:[e.jsx(v,{children:e.jsxs(p,{sx:{typography:"body2",alignItems:"flex-start"},children:[e.jsx(t,{component:"span",sx:{fontWeight:"fontWeightMedium"},children:s.titulo}),e.jsxs(t,{component:"span",sx:{color:"text.disabled"},children:[s.localizacao.bairro,", ",s.localizacao.cidade]})]})}),e.jsx(v,{children:e.jsx(t,{sx:{typography:"body2"},children:s.corretor||"Sem corretor"})}),e.jsxs(v,{align:"center",children:[e.jsxs(t,{sx:{typography:"body2"},children:[((i=s.area)==null?void 0:i.toLocaleString("pt-BR"))||0," m²"]}),e.jsxs(t,{sx:{typography:"caption",color:"text.disabled"},children:[K(s.precoM2||0),"/m²"]})]}),e.jsxs(v,{children:[e.jsx(t,{sx:{typography:"body2",fontWeight:"fontWeightMedium"},children:K(s.preco)}),s.negociavel&&e.jsx(t,{sx:{typography:"caption",color:"warning.main"},children:"Negociável"})]}),e.jsx(v,{children:e.jsxs(Z,{variant:"soft",color:s.status==="available"&&"success"||s.status==="reserved"&&"warning"||s.status==="sold"&&"info"||s.status==="inactive"&&"default"||"default",children:[s.status==="available"&&"Disponível",s.status==="reserved"&&"Reservado",s.status==="sold"&&"Vendido",s.status==="inactive"&&"Inativo"]})}),e.jsxs(v,{align:"right",sx:{px:1,whiteSpace:"nowrap"},children:[e.jsx(Q,{color:h.value?"inherit":"default",onClick:h.onToggle,sx:{...h.value&&{bgcolor:"action.hover"}},children:e.jsx(b,{icon:"eva:arrow-ios-downward-fill"})}),e.jsx(Q,{color:l.open?"inherit":"default",onClick:l.onOpen,children:e.jsx(b,{icon:"eva:more-vertical-fill"})})]})]})},x=()=>{var i,g,f,S;return e.jsx(Y,{children:e.jsx(v,{sx:{p:0,border:"none"},colSpan:6,children:e.jsx(le,{in:h.value,timeout:"auto",unmountOnExit:!0,sx:{bgcolor:"background.neutral"},children:e.jsx(re,{sx:{m:1.5},children:e.jsxs(t,{sx:F=>({display:"flex",alignItems:"flex-start",p:F.spacing(2),gap:2}),children:[s.imagens&&s.imagens.length>0&&s.imagens[0]?e.jsx(t,{component:"img",src:s.imagens[0],alt:s.titulo,sx:{width:120,height:80,borderRadius:1,objectFit:"cover",flexShrink:0}}):e.jsxs(t,{sx:{width:120,height:80,borderRadius:1,flexShrink:0,display:"flex",alignItems:"center",justifyContent:"center",flexDirection:"column",bgcolor:"background.neutral",border:"1px dashed",borderColor:"divider",gap:.5},children:[e.jsx(b,{icon:"solar:image-bold",width:24,sx:{color:"text.disabled"}}),e.jsx(t,{sx:{typography:"caption",color:"text.disabled"},children:"Sem imagem"})]}),e.jsxs(p,{sx:{flex:1},spacing:1.5,children:[e.jsx(t,{children:e.jsx(t,{sx:{typography:"subtitle2",mb:.5},children:s.titulo})}),e.jsxs(p,{spacing:1.5,children:[e.jsxs(t,{sx:{display:"grid",gridTemplateColumns:{xs:"1fr",sm:"1fr 1fr"},gap:2},children:[e.jsxs(t,{children:[e.jsx(t,{sx:{typography:"caption",color:"text.secondary",mb:.5},children:"Localização"}),e.jsx(t,{sx:{typography:"body2"},children:s.localizacao.endereco}),e.jsxs(t,{sx:{typography:"caption",color:"text.disabled"},children:[s.localizacao.bairro,", ",s.localizacao.cidade," - ",s.localizacao.estado]})]}),e.jsxs(t,{children:[e.jsx(t,{sx:{typography:"caption",color:"text.secondary",mb:.5},children:"Proprietário"}),e.jsx(t,{sx:{typography:"body2"},children:s.proprietario.nome}),e.jsx(t,{sx:{typography:"caption",color:"text.disabled"},children:s.proprietario.telefone})]})]}),e.jsxs(t,{children:[e.jsx(t,{sx:{typography:"caption",color:"text.secondary",mb:.5},children:"Características"}),e.jsxs(t,{sx:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(80px, 1fr))",gap:1},children:[e.jsxs(t,{sx:{textAlign:"center"},children:[e.jsx(t,{sx:{typography:"body2",fontWeight:"fontWeightMedium"},children:((i=s.caracteristicas)==null?void 0:i.quartos)||0}),e.jsx(t,{sx:{typography:"caption",color:"text.disabled"},children:"Quartos"})]}),e.jsxs(t,{sx:{textAlign:"center"},children:[e.jsx(t,{sx:{typography:"body2",fontWeight:"fontWeightMedium"},children:((g=s.caracteristicas)==null?void 0:g.banheiros)||0}),e.jsx(t,{sx:{typography:"caption",color:"text.disabled"},children:"Banheiros"})]}),e.jsxs(t,{sx:{textAlign:"center"},children:[e.jsx(t,{sx:{typography:"body2",fontWeight:"fontWeightMedium"},children:((f=s.caracteristicas)==null?void 0:f.suites)||0}),e.jsx(t,{sx:{typography:"caption",color:"text.disabled"},children:"Suítes"})]}),e.jsxs(t,{sx:{textAlign:"center"},children:[e.jsx(t,{sx:{typography:"body2",fontWeight:"fontWeightMedium"},children:((S=s.caracteristicas)==null?void 0:S.vagasGaragem)||0}),e.jsx(t,{sx:{typography:"caption",color:"text.disabled"},children:"Vagas"})]})]})]}),s.descricao&&e.jsxs(t,{children:[e.jsx(t,{sx:{typography:"caption",color:"text.secondary",mb:.5},children:"Descrição"}),e.jsx(t,{sx:{typography:"body2",color:"text.secondary"},children:s.descricao.length>150?`${s.descricao.substring(0,150)}...`:s.descricao})]})]}),e.jsx(p,{direction:"row",spacing:1,sx:{pt:1},children:e.jsx(w,{component:H,href:r,size:"small",variant:"outlined",startIcon:e.jsx(b,{icon:"solar:eye-bold"}),children:"Ver detalhes"})})]})]})})})})})};return e.jsxs(e.Fragment,{children:[u(),x(),e.jsx(ie,{open:l.open,anchorEl:l.anchorEl,onClose:l.onClose,slotProps:{arrow:{placement:"right-top"}},children:e.jsxs(ne,{children:[e.jsxs(y,{component:H,href:r,onClick:l.onClose,children:[e.jsx(b,{icon:"solar:eye-bold"}),e.jsx(P,{primary:"Ver"})]}),e.jsx(U,{sx:{borderStyle:"dashed"}}),e.jsxs(y,{onClick:()=>d("disponivel"),children:[e.jsx(b,{icon:"solar:check-circle-bold"}),e.jsx(P,{primary:"Marcar como Disponível"})]}),e.jsxs(y,{onClick:()=>d("reservado"),children:[e.jsx(b,{icon:"solar:clock-circle-bold"}),e.jsx(P,{primary:"Marcar como Reservado"})]}),e.jsxs(y,{onClick:()=>d("vendido"),children:[e.jsx(b,{icon:"solar:check-square-bold"}),e.jsx(P,{primary:"Marcar como Vendido"})]}),e.jsxs(y,{onClick:()=>d("suspenso"),children:[e.jsx(b,{icon:"solar:pause-circle-bold"}),e.jsx(P,{primary:"Suspender"})]}),e.jsx(U,{sx:{borderStyle:"dashed"}}),e.jsxs(y,{onClick:()=>{o.onTrue(),l.onClose()},sx:{color:"error.main"},children:[e.jsx(b,{icon:"solar:trash-bin-trash-bold"}),e.jsx(P,{primary:"Excluir"})]})]})}),e.jsx(we,{open:o.value,onClose:o.onFalse,title:"Excluir imóvel",content:"Tem certeza de que deseja excluir este imóvel?",action:e.jsx(w,{variant:"contained",color:"error",onClick:()=>{c(),o.onFalse()},children:"Excluir"})})]})}function Ne({filters:s,onResetPage:c,dateError:r}){const{state:m,setState:o}=s,l=j.useCallback(u=>{c(),o({name:u.target.value})},[c,o]),h=j.useCallback(u=>{c(),o({startDate:u})},[c,o]),d=j.useCallback(u=>{c(),o({endDate:u})},[c,o]);return e.jsx(p,{spacing:2,alignItems:{xs:"flex-end",md:"center"},direction:{xs:"column",md:"row"},sx:{p:2.5,pr:{xs:2.5,md:1}},children:e.jsxs(p,{direction:"row",alignItems:"center",spacing:2,flexGrow:1,sx:{width:1},children:[e.jsx(de,{fullWidth:!0,value:m.name,onChange:l,placeholder:"Buscar imóvel...",InputProps:{startAdornment:e.jsx(ce,{position:"start",children:e.jsx(b,{icon:"eva:search-fill",sx:{color:"text.disabled"}})})}}),e.jsx(_,{label:"Data inicial",value:m.startDate,onChange:h,slotProps:{textField:{fullWidth:!0}},sx:{maxWidth:{md:200}}}),e.jsx(_,{label:"Data final",value:m.endDate,onChange:d,slotProps:{textField:{fullWidth:!0,error:r,helperText:r?"A data final deve ser posterior à data inicial":null}},sx:{maxWidth:{md:200}}})]})})}function Oe({filters:s,totalResults:c,onResetPage:r,sx:m}){const{state:o,setState:l,resetState:h}=s,d=j.useCallback(()=>{r(),l({name:""})},[r,l]),u=j.useCallback(()=>{r(),l({status:"all"})},[r,l]),x=j.useCallback(()=>{r(),l({startDate:null,endDate:null})},[r,l]),i=j.useCallback(()=>{r(),h()},[r,h]);return e.jsxs(Be,{totalResults:c,onReset:i,sx:m,children:[e.jsx(A,{label:"Status:",isShow:o.status!=="all",children:e.jsx(R,{...E,label:o.status,onDelete:u,sx:{textTransform:"capitalize"}})}),e.jsx(A,{label:"Date:",isShow:!!(o.startDate&&o.endDate),children:e.jsx(R,{...E,label:xe(o.startDate,o.endDate),onDelete:x})}),e.jsx(A,{label:"Keyword:",isShow:!!o.name,children:e.jsx(R,{...E,label:o.name,onDelete:d})})]})}const Ve=[{value:"all",label:"Todos"},{value:"available",label:"Disponível"},{value:"reserved",label:"Reservado"},{value:"sold",label:"Vendido"},{value:"inactive",label:"Inativo"}],$e=[{id:"titulo",label:"Imóvel"},{id:"corretor",label:"Corretor",width:140},{id:"area",label:"Área (m²)",width:120,align:"center"},{id:"preco",label:"Preço",width:140},{id:"status",label:"Status",width:110},{id:"",width:88}];function qe(){const s=De({defaultOrderBy:"titulo"}),{properties:c,propertiesLoading:r,propertiesError:m}=Se(),[o,l]=j.useState([]);j.useEffect(()=>{if(c&&c.length>0){const n=c.map((a,D)=>{var T,k,C,z,B,W,L,N,O,V,$,q;return{id:a.id,codigo:`IMO-${(a.id||`${D}`).toString().slice(-4).padStart(4,"0")}`,titulo:a.name||a.title||"Imóvel sem título",descricao:a.description||"Sem descrição",area:a.totalArea||0,preco:a.value||a.salePrice||0,precoM2:a.pricePerSquareMeter||(a.value&&a.totalArea?Math.round(a.value/a.totalArea):0),finalidade:a.purpose||"venda",status:a.status||"available",tipo:a.type||"apartamento",condicao:a.condition||"usado",quartos:a.bedrooms||0,banheiros:a.bathrooms||0,suites:a.suites||0,vagasGaragem:a.parkingSpaces||0,mobiliado:a.furnished||!1,anoConstucao:a.yearBuilt||"",elevador:a.elevator||!1,sacada:a.balcony||!1,posicaoSolar:a.sunPosition||"",createdAt:a.createdAt,updatedAt:a.updatedAt,localizacao:{endereco:typeof a.address=="string"?a.address:typeof a.address=="object"&&a.address&&`${a.address.street||""} ${a.address.number||""}`.trim()||"Endereço não informado",complemento:((T=a.address)==null?void 0:T.complement)||"",bairro:a.neighborhood||((k=a.address)==null?void 0:k.neighborhood)||"Bairro não informado",cidade:a.city||((C=a.address)==null?void 0:C.city)||"Cidade não informada",estado:a.state||((z=a.address)==null?void 0:z.state)||"Estado não informado",cep:a.cep||a.zipCode||((B=a.address)==null?void 0:B.zipCode)||"CEP não informado",andar:((W=a.address)==null?void 0:W.floor)||"",nomeEdificio:((L=a.address)==null?void 0:L.buildingName)||"",coordenadas:a.latitude&&a.longitude?{lat:a.latitude,lng:a.longitude}:void 0},proprietario:{id:a.ownerId||"",nome:((N=a.owner)==null?void 0:N.name)||"Proprietário não informado",email:((O=a.owner)==null?void 0:O.email)||"",telefone:((V=a.owner)==null?void 0:V.phone)||"",avatarUrl:(($=a.owner)==null?void 0:$.avatarUrl)||"",documento:((q=a.owner)==null?void 0:q.document)||""},caracteristicas:{area:a.totalArea||0,quartos:a.bedrooms||0,banheiros:a.bathrooms||0,suites:a.suites||0,vagasGaragem:a.parkingSpaces||0,anoConstucao:a.yearBuilt||"",elevador:a.elevator||!1,sacada:a.balcony||!1,mobiliado:a.furnished||!1,condicao:a.condition||"usado",documentacao:a.hasDocumentation?"Completa":"Incompleta"},valores:{valorVenda:a.salePrice||0,valorAluguel:a.rentPrice||0,valorCondominio:a.condominiumFee||0,valorIPTU:a.propertyTax||0,aceitaFinanciamento:a.acceptsFinancing||!1},imagens:a.images||[],destaque:a.highlightProperty||!1,negociavel:a.acceptsFinancing||!1,observacoes:a.description||"",corretor:a.broker?a.broker:"Sem corretor"}});l(n)}else!r&&(!c||c.length===0)&&l([])},[c,r]);const h=he({name:"",status:"all",startDate:null,endDate:null}),{state:d,setState:u}=h,x=me(d.startDate,d.endDate),i=Ge({inputData:o,comparator:Te(s.order,s.orderBy),filters:d,dateError:x}),g=ke(i,s.page,s.rowsPerPage),f=!!d.name||d.status!=="all"||!!d.startDate&&!!d.endDate,S=o.length===0&&!r&&!m,F=!i.length&&f,ee=S||F,ae=j.useCallback(n=>{const a=o.filter(D=>D.id!==n);M.success("Imóvel removido com sucesso!"),l(a),s.onUpdatePageDeleteRow(g.length)},[g.length,s,o]),se=j.useCallback((n,a)=>{const T={disponivel:"available",reservado:"reserved",vendido:"sold",suspenso:"inactive"}[a]||a,k=o.map(C=>C.id===n?{...C,status:T}:C);l(k)},[o]),te=j.useCallback((n,a)=>{s.onResetPage(),u({status:a})},[u,s]);return r?e.jsx(ue,{}):m?e.jsx(J,{children:e.jsxs(t,{sx:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",minHeight:400,textAlign:"center"},children:[e.jsx(b,{icon:"eva:alert-triangle-fill",sx:{width:64,height:64,color:"error.main",mb:2}}),e.jsx(X,{variant:"h6",sx:{mb:1},children:"Erro ao carregar imóveis"}),e.jsx(X,{variant:"body2",color:"text.secondary",children:m.message||"Ocorreu um erro inesperado"})]})}):e.jsx(e.Fragment,{children:e.jsxs(J,{children:[e.jsxs(p,{direction:{xs:"column",sm:"row"},alignItems:{xs:"flex-start",sm:"center"},justifyContent:"space-between",spacing:{xs:2,sm:0},sx:{mb:{xs:3,md:5}},children:[e.jsx(ge,{heading:"Todos os imóveis",links:[{name:"Dashboard",href:I.dashboard.root},{name:"Imóveis",href:I.dashboard.property.root},{name:"Lista de imóveis"}],sx:{".MuiTypography-h4":{fontSize:{xs:"1.25rem",md:"1.5rem"}}}}),e.jsx(w,{variant:"contained",startIcon:e.jsx(b,{icon:"eva:plus-fill"}),href:I.dashboard.property.new,sx:{fontSize:{xs:"0.875rem",md:"1rem"},width:{xs:"100%",sm:"auto"}},children:"Novo imóvel"})]}),e.jsxs(We,{children:[e.jsx(be,{value:d.status,onChange:te,sx:[n=>({px:2.5,boxShadow:`inset 0 -2px 0 0 ${je(n.vars.palette.grey["500Channel"],.08)}`})],children:Ve.map(n=>e.jsx(fe,{iconPosition:"end",value:n.value,label:n.label,icon:e.jsx(Z,{variant:(n.value==="all"||n.value===d.status)&&"filled"||"soft",color:n.value==="available"&&"success"||n.value==="reserved"&&"warning"||n.value==="sold"&&"info"||n.value==="inactive"&&"error"||"default",children:n.value==="all"?o.length:o.filter(a=>a.status===n.value).length})},n.value))}),e.jsx(Ne,{filters:h,onResetPage:s.onResetPage,dateError:x}),f&&e.jsx(Oe,{filters:h,totalResults:i.length,onResetPage:s.onResetPage,sx:{p:2.5,pt:0}}),e.jsx(t,{sx:{position:"relative"},children:e.jsx(ve,{sx:{minHeight:444},children:e.jsxs(Me,{size:s.dense?"small":"medium",sx:{minWidth:960},children:[e.jsx(Ae,{order:s.order,orderBy:s.orderBy,headCells:$e,rowCount:i.length,numSelected:0,onSort:s.onSort}),e.jsxs(ze,{children:[i.slice(s.page*s.rowsPerPage,s.page*s.rowsPerPage+s.rowsPerPage).map(n=>e.jsx(Le,{row:n,onDeleteRow:()=>ae(n.id),onUpdateStatus:a=>se(n.id,a),detailsHref:I.dashboard.property.details(n.id)},n.id)),e.jsx(Re,{height:s.dense?56:76,emptyRows:Ie(s.page,s.rowsPerPage,i.length)}),e.jsx(Fe,{notFound:ee,title:S?"Nenhum imóvel registrado":"Nenhum resultado encontrado"})]})]})})}),e.jsx(Ee,{page:s.page,dense:s.dense,count:i.length,rowsPerPage:s.rowsPerPage,onPageChange:s.onChangePage,onChangeDense:s.onChangeDense,onRowsPerPageChange:s.onChangeRowsPerPage})]})]})})}function Ge({inputData:s,comparator:c,filters:r,dateError:m}){const{status:o,name:l,startDate:h,endDate:d}=r,u=s.map((x,i)=>[x,i]);return u.sort((x,i)=>{const g=c(x[0],i[0]);return g!==0?g:x[1]-i[1]}),s=u.map(x=>x[0]),l&&(s=s.filter(({codigo:x,titulo:i,proprietario:g})=>[x,i,g.nome,g.email].some(f=>f==null?void 0:f.toLowerCase().includes(l.toLowerCase())))),o!=="all"&&(s=s.filter(x=>x.status===o)),m||h&&d&&(s=s.filter(x=>pe(x.createdAt,h,d))),s}const He={title:`Lista de imóveis | Painel - ${ye.appName}`};function da(){return e.jsxs(e.Fragment,{children:[e.jsx(Ce,{children:e.jsxs("title",{children:[" ",He.title]})}),e.jsx(qe,{})]})}export{da as default};

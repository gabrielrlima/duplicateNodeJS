import{b0 as _,j as e,b1 as z,b2 as U,b3 as R,R as F,I as f,B as g,az as A,aJ as X,d1 as ee,L as H,dM as q,a1 as G,a$ as W,r as c,p as S,f as $,V as se,b4 as te,b5 as ne,b6 as M,b7 as re,b8 as J,b9 as ae,ba as le,A as E,T as C,au as Q,a0 as ie,bb as oe,f2 as Y,bo as N,ax as ce,bp as de,S as Z,a_ as xe,D as he,dL as V,eZ as pe,bc as D,bq as ue,br as me,Y as be,bd as ge,dO as je,cV as fe,bj as ve,dQ as ye,e$ as Ce,f3 as Se,f4 as ke,H as De,C as Fe}from"./index-cNRh_qft.js";import{E as we}from"./empty-content-BzM3Az2z.js";import{C as Te}from"./Card-C_-31fGp.js";import{P as Ie,p as Re}from"./Pagination-tgO33XKK.js";import{F as Ee,a as T,c as I}from"./filters-result-BTXXEhsP.js";import{o as B}from"./orderBy-BP_idRMj.js";import"./tour-new-edit-form-CXV2iTdp.js";import"./html-to-markdown-wPkGdeP1.js";import"./LastPage-ChYIEhQh.js";import"./schema-helper-D18en8Wv.js";import"./CardHeader-CZZHKPlX.js";function Pe({tour:s,editHref:p,detailsHref:a,onDelete:n,sx:r,...x}){const o=_(),l=()=>e.jsxs(g,{sx:{top:8,right:8,zIndex:9,display:"flex",borderRadius:1,alignItems:"center",position:"absolute",p:"2px 6px 2px 4px",typography:"subtitle2",bgcolor:"warning.lighter"},children:[e.jsx(f,{icon:"eva:star-fill",sx:{color:"warning.main",mr:.25}})," ",s.ratingNumber]}),h=()=>e.jsxs(g,{sx:{top:8,left:8,zIndex:9,display:"flex",borderRadius:1,bgcolor:"grey.800",alignItems:"center",position:"absolute",p:"2px 6px 2px 4px",color:"common.white",typography:"subtitle2"},children:[!!s.priceSale&&e.jsx(g,{component:"span",sx:{color:"grey.500",mr:.25,textDecoration:"line-through"},children:W(s.priceSale)}),W(s.price)]}),u=()=>e.jsxs(g,{sx:{p:1,gap:.5,display:"flex"},children:[e.jsxs(g,{sx:{flexGrow:1,position:"relative"},children:[h(),l(),e.jsx(A,{alt:s.images[0],src:s.images[0],sx:{width:1,height:164,borderRadius:1}})]}),e.jsxs(g,{sx:{gap:.5,display:"flex",flexDirection:"column"},children:[e.jsx(A,{alt:s.images[1],src:s.images[1],ratio:"1/1",sx:{borderRadius:1,width:80,height:80}}),e.jsx(A,{alt:s.images[2],src:s.images[2],ratio:"1/1",sx:{borderRadius:1,width:80,height:80}})]})]}),t=()=>e.jsx(X,{sx:{p:"20px 20px 16px 20px"},primary:`Posted date: ${ee(s.createdAt)}`,secondary:e.jsx(H,{component:F,href:a,color:"inherit",children:s.name}),slotProps:{primary:{sx:{typography:"caption",color:"text.disabled"}},secondary:{noWrap:!0,component:"h6",sx:{mt:1,color:"text.primary",typography:"subtitle1"}}}}),m=()=>e.jsxs(g,{sx:{gap:1.5,display:"flex",position:"relative",flexDirection:"column",p:"0 20px 20px 20px"},children:[e.jsx(G,{onClick:o.onOpen,sx:{position:"absolute",bottom:20,right:8},children:e.jsx(f,{icon:"eva:more-vertical-fill"})}),[{icon:e.jsx(f,{icon:"mingcute:location-fill",sx:{color:"error.main"}}),label:s.destination},{icon:e.jsx(f,{icon:"solar:clock-circle-bold",sx:{color:"info.main"}}),label:q(s.available.startDate,s.available.endDate)},{icon:e.jsx(f,{icon:"solar:users-group-rounded-bold",sx:{color:"primary.main"}}),label:`${s.bookers.length} Booked`}].map(d=>e.jsxs(g,{sx:[{gap:.5,display:"flex",typography:"body2",alignItems:"center"}],children:[d.icon,d.label]},d.label))]}),b=()=>e.jsx(z,{open:o.open,anchorEl:o.anchorEl,onClose:o.onClose,slotProps:{arrow:{placement:"right-top"}},children:e.jsxs(U,{children:[e.jsx("li",{children:e.jsxs(R,{component:F,href:a,onClick:()=>o.onClose(),children:[e.jsx(f,{icon:"solar:eye-bold"}),"View"]})}),e.jsx("li",{children:e.jsxs(R,{component:F,href:p,onClick:()=>o.onClose(),children:[e.jsx(f,{icon:"solar:pen-bold"}),"Edit"]})}),e.jsxs(R,{onClick:()=>{o.onClose(),n()},sx:{color:"error.main"},children:[e.jsx(f,{icon:"solar:trash-bin-trash-bold"}),"Delete"]})]})});return e.jsxs(e.Fragment,{children:[e.jsxs(Te,{sx:r,...x,children:[u(),t(),m()]}),b()]})}function Oe({tours:s}){const p=c.useCallback(a=>{console.info("DELETE",a)},[]);return e.jsxs(e.Fragment,{children:[e.jsx(g,{sx:{gap:3,display:"grid",gridTemplateColumns:{xs:"repeat(1, 1fr)",sm:"repeat(2, 1fr)",md:"repeat(3, 1fr)"}},children:s.map(a=>e.jsx(Pe,{tour:a,editHref:S.dashboard.tour.edit(a.id),detailsHref:S.dashboard.tour.details(a.id),onDelete:()=>p(a.id)},a.id))}),s.length>8&&e.jsx(Ie,{count:8,sx:{mt:{xs:5,md:8},[`& .${Re.ul}`]:{justifyContent:"center"}}})]})}function Le({sort:s,onSort:p,sortOptions:a}){const n=_(),r=()=>e.jsx(z,{open:n.open,anchorEl:n.anchorEl,onClose:n.onClose,children:e.jsx(U,{children:a.map(x=>e.jsx(R,{selected:x.value===s,onClick:()=>{n.onClose(),p(x.value)},children:x.label},x.value))})});return e.jsxs(e.Fragment,{children:[e.jsxs($,{disableRipple:!0,color:"inherit",onClick:n.onOpen,endIcon:e.jsx(f,{icon:n.open?"eva:arrow-ios-upward-fill":"eva:arrow-ios-downward-fill"}),sx:{fontWeight:"fontWeightSemiBold"},children:["Sort by:",e.jsx(g,{component:"span",sx:{ml:.5,fontWeight:"fontWeightBold",textTransform:"capitalize"},children:s})]}),r()]})}function Ae({redirectPath:s,sx:p}){const a=se(),[n,r]=c.useState(""),[x,o]=c.useState(null),l=te(n),{searchResults:h,searchLoading:u}=Be(l),t=c.useCallback(d=>{o(d),d&&a.push(s(d.id))},[a,s]),m=ne({matchFrom:"any",stringify:d=>`${d.name} ${d.destination}`}),b={width:320,[` .${M.listbox}`]:{[` .${M.option}`]:{p:0,[` .${re.root}`]:{p:.75,gap:1.5,width:1,display:"flex",alignItems:"center"}}}};return e.jsx(J,{autoHighlight:!0,popupIcon:null,loading:u,options:h,value:x,filterOptions:m,onChange:(d,j)=>t(j),onInputChange:(d,j)=>r(j),getOptionLabel:d=>d.name,noOptionsText:e.jsx(oe,{query:l}),isOptionEqualToValue:(d,j)=>d.id===j.id,slotProps:{paper:{sx:b}},sx:[{width:{xs:1,sm:260}},...Array.isArray(p)?p:[p]],renderInput:d=>e.jsx(Q,{...d,placeholder:"Pesquisar...",slotProps:{input:{...d.InputProps,startAdornment:e.jsx(ie,{position:"start",children:e.jsx(f,{icon:"eva:search-fill",sx:{ml:1,color:"text.disabled"}})}),endAdornment:e.jsxs(e.Fragment,{children:[u?e.jsx(f,{icon:"svg-spinners:8-dots-rotate",sx:{mr:-3}}):null,d.InputProps.endAdornment]})}}}),renderOption:(d,j,{inputValue:w})=>{const P=ae(j.name,w),O=le(j.name,P);return c.createElement("li",{...d,key:j.id},e.jsxs(H,{component:F,href:s(j.id),color:"inherit",underline:"none",children:[e.jsx(E,{alt:j.name,src:j.images[0],variant:"rounded",sx:{width:48,height:48,flexShrink:0,borderRadius:1}},j.id),e.jsx("div",{children:O.map((k,L)=>e.jsx(C,{component:"span",color:k.highlight?"primary":"textPrimary",sx:{typography:"body2",fontWeight:k.highlight?"fontWeightSemiBold":"fontWeightMedium"},children:k.text},L))},w)]}))}})}function Be(s){const[p,a]=c.useState([]),[n,r]=c.useState(!1),x=c.useCallback(async()=>{r(!0);try{await new Promise(l=>setTimeout(l,500));const o=Y.filter(({name:l,destination:h})=>[l,h].some(u=>u==null?void 0:u.toLowerCase().includes(s.toLowerCase())));a(o)}catch(o){console.error(o)}finally{r(!1)}},[s]);return c.useEffect(()=>{s?x():a([])},[x,s]),{searchResults:p,searchLoading:n}}function Ge({open:s,onOpen:p,onClose:a,filters:n,options:r,canReset:x,dateError:o}){const{state:l,setState:h,resetState:u}=n,t=c.useCallback(i=>{const v=l.services.includes(i)?l.services.filter(y=>y!==i):[...l.services,i];h({services:v})},[h,l.services]),m=c.useCallback(i=>{h({startDate:i})},[h]),b=c.useCallback(i=>{h({endDate:i})},[h]),d=c.useCallback(i=>{h({destination:i})},[h]),j=c.useCallback(i=>{h({tourGuides:i})},[h]),w=()=>e.jsxs(e.Fragment,{children:[e.jsxs(g,{sx:{py:2,pr:1,pl:2.5,display:"flex",alignItems:"center"},children:[e.jsx(C,{variant:"h6",sx:{flexGrow:1},children:"Filters"}),e.jsx(xe,{title:"Reset",children:e.jsx(G,{onClick:()=>u(),children:e.jsx(N,{color:"error",variant:"dot",invisible:!x,children:e.jsx(f,{icon:"solar:restart-bold"})})})}),e.jsx(G,{onClick:a,children:e.jsx(f,{icon:"mingcute:close-line"})})]}),e.jsx(he,{sx:{borderStyle:"dashed"}})]}),P=()=>e.jsxs(g,{sx:{display:"flex",flexDirection:"column"},children:[e.jsx(C,{variant:"subtitle2",sx:{mb:1.5},children:"Durations"}),e.jsx(V,{label:"Start date",value:l.startDate,onChange:m,sx:{mb:2.5}}),e.jsx(V,{label:"End date",value:l.endDate,onChange:b,slotProps:{textField:{error:o,helperText:o?"End date must be later than start date":null}}})]}),O=()=>e.jsxs(g,{sx:{display:"flex",flexDirection:"column"},children:[e.jsx(C,{variant:"subtitle2",sx:{mb:1.5},children:"Destination"}),e.jsx(pe,{id:"multiple-destinations",multiple:!0,fullWidth:!0,placeholder:l.destination.length?"+ Destination":"Select Destination",value:l.destination,onChange:(i,v)=>d(v)})]}),k=()=>e.jsxs(g,{sx:{display:"flex",flexDirection:"column"},children:[e.jsx(C,{variant:"subtitle2",sx:{mb:1.5},children:"Tour guide"}),e.jsx(J,{multiple:!0,disableCloseOnSelect:!0,options:r.tourGuides,value:l.tourGuides,onChange:(i,v)=>j(v),getOptionLabel:i=>i.name,renderInput:i=>e.jsx(Q,{placeholder:"Select Tour Guides",...i}),renderOption:(i,v)=>c.createElement("li",{...i,key:v.id},e.jsx(E,{alt:v.avatarUrl,src:v.avatarUrl,sx:{mr:1,width:24,height:24,flexShrink:0}},v.id),v.name),renderTags:(i,v)=>i.map((y,K)=>c.createElement(D,{...v({index:K}),key:y.id,size:"small",variant:"soft",label:y.name,avatar:e.jsx(E,{alt:y.name,src:y.avatarUrl})}))})]}),L=()=>e.jsxs(g,{sx:{display:"flex",flexDirection:"column"},children:[e.jsx(C,{variant:"subtitle2",sx:{mb:1},children:"Services"}),r.services.map(i=>e.jsx(ue,{label:i,control:e.jsx(me,{checked:l.services.includes(i),onClick:()=>t(i),inputProps:{id:`${i}-checkbox`}})},i))]});return e.jsxs(e.Fragment,{children:[e.jsx($,{disableRipple:!0,color:"inherit",endIcon:e.jsx(N,{color:"error",variant:"dot",invisible:!x,children:e.jsx(f,{icon:"ic:round-filter-list"})}),onClick:p,children:"Filters"}),e.jsxs(ce,{anchor:"right",open:s,onClose:a,slotProps:{backdrop:{invisible:!0}},PaperProps:{sx:{width:320}},children:[w(),e.jsx(de,{sx:{px:2.5,py:3},children:e.jsxs(Z,{spacing:3,children:[P(),O(),k(),L()]})})]})]})}function $e({filters:s,totalResults:p,sx:a}){const{state:n,setState:r,resetState:x}=s,o=c.useCallback(t=>{const m=n.services.filter(b=>b!==t);r({services:m})},[r,n.services]),l=c.useCallback(()=>{r({startDate:null,endDate:null})},[r]),h=c.useCallback(t=>{const m=n.tourGuides.filter(b=>b.name!==t.name);r({tourGuides:m})},[r,n.tourGuides]),u=c.useCallback(t=>{const m=n.destination.filter(b=>b!==t);r({destination:m})},[r,n.destination]);return e.jsxs(Ee,{totalResults:p,onReset:()=>x(),sx:a,children:[e.jsx(T,{label:"Available:",isShow:!!(n.startDate&&n.endDate),children:e.jsx(D,{...I,label:q(n.startDate,n.endDate),onDelete:l})}),e.jsx(T,{label:"Services:",isShow:!!n.services.length,children:n.services.map(t=>c.createElement(D,{...I,key:t,label:t,onDelete:()=>o(t)}))}),e.jsx(T,{label:"Tour guide:",isShow:!!n.tourGuides.length,children:n.tourGuides.map(t=>c.createElement(D,{...I,key:t.id,avatar:e.jsx(E,{alt:t.name,src:t.avatarUrl}),label:t.name,onDelete:()=>h(t)}))}),e.jsx(T,{label:"Destination:",isShow:!!n.destination.length,children:n.destination.map(t=>c.createElement(D,{...I,key:t,label:t,onDelete:()=>u(t)}))})]})}function We(){const s=be(),[p,a]=c.useState("latest"),n=ge({destination:[],tourGuides:[],services:[],startDate:null,endDate:null}),{state:r}=n,x=je(r.startDate,r.endDate),o=Me({inputData:Y,filters:r,sortBy:p,dateError:x}),l=r.destination.length>0||r.tourGuides.length>0||r.services.length>0||!!r.startDate&&!!r.endDate,h=!o.length&&l,u=c.useCallback(b=>{a(b)},[]),t=()=>e.jsxs(g,{sx:{gap:3,display:"flex",justifyContent:"space-between",alignItems:{xs:"flex-end",sm:"center"},flexDirection:{xs:"column",sm:"row"}},children:[e.jsx(Ae,{redirectPath:b=>S.dashboard.tour.details(b)}),e.jsxs(g,{sx:{gap:1,flexShrink:0,display:"flex"},children:[e.jsx(Ge,{filters:n,canReset:l,dateError:x,open:s.value,onOpen:s.onTrue,onClose:s.onFalse,options:{tourGuides:Se,services:Ce.map(b=>b.label)}}),e.jsx(Le,{sort:p,onSort:u,sortOptions:ke})]})]}),m=()=>e.jsx($e,{filters:n,totalResults:o.length});return e.jsxs(fe,{children:[e.jsx(ve,{heading:"List",links:[{name:"Dashboard",href:S.dashboard.root},{name:"Tour",href:S.dashboard.tour.root},{name:"List"}],action:e.jsx($,{component:F,href:S.dashboard.tour.new,variant:"contained",startIcon:e.jsx(f,{icon:"mingcute:add-line"}),children:"New Tour"}),sx:{mb:{xs:3,md:5}}}),e.jsxs(Z,{spacing:2.5,sx:{mb:{xs:3,md:5}},children:[t(),l&&m()]}),h&&e.jsx(we,{filled:!0,sx:{py:10}}),e.jsx(Oe,{tours:o})]})}function Me({inputData:s,filters:p,sortBy:a,dateError:n}){const{services:r,destination:x,startDate:o,endDate:l,tourGuides:h}=p,u=h.map(t=>t.id);return a==="latest"&&(s=B(s,["createdAt"],["desc"])),a==="oldest"&&(s=B(s,["createdAt"],["asc"])),a==="popular"&&(s=B(s,["totalViews"],["desc"])),x.length&&(s=s.filter(t=>x.includes(t.destination))),u.length&&(s=s.filter(t=>t.tourGuides.some(m=>u.includes(m.id)))),r.length&&(s=s.filter(t=>t.services.some(m=>r.includes(m)))),n||o&&l&&(s=s.filter(t=>ye(o,t.available.startDate,t.available.endDate))),s}const Ne={title:`Tour list | Dashboard - ${Fe.appName}`};function Xe(){return e.jsxs(e.Fragment,{children:[e.jsx(De,{children:e.jsxs("title",{children:[" ",Ne.title]})}),e.jsx(We,{})]})}export{Xe as default};

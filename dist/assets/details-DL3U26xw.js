import{b$ as R,r as o,dZ as T,V as P,W as w,p as S,j as e,b8 as O,B as L,a1 as F,I as $,T as k,C as f,H as G}from"./index-D82XrlGq.js";import{E}from"./empty-content-CAmd9egU.js";import"./filters-result-BUC8QtIh.js";import"./calendar-form-BY3cR15k.js";import"./vendas-new-edit-form-CLwVBLHF.js";import{u as H}from"./use-params-BTd0VUeQ.js";import{u as M}from"./index-nX3EE7Rc.js";import{u as W,a as B,b as U,C as z,c as J,d as Q,e as Z,f as _}from"./use-collapse-nav-CeNSFNTp.js";import{C as q}from"./styles-BlGNM00e.js";import"./color-preview-fxJWItmu.js";import"./property-D2aquZ-Y.js";import"./Card-Bw-3A9ev.js";import"./CardHeader-BbCWHGKm.js";import"./index-AY8D22yG.js";import"./use-light-box-dXPttcOB.js";import"./keyBy-Dc3MaNHd.js";import"./Skeleton-B8_s61tm.js";import"./AvatarGroup-BSnlJl2K.js";const K={revalidateIfStale:!1,revalidateOnFocus:!1,revalidateOnReconnect:!1};function X(n){const{data:s,isLoading:p,error:a,isValidating:i}=M(null,R,K),t=o.useMemo(()=>{if(!n)return null;let l=T.find(c=>c.id===n);if(!l){const c={clientName:"João Silva",clientPhone:"(11) 99999-9999",clientEmail:"joao.silva@email.com",propertyName:"Cobertura Sunset - 4",unitType:"66 m² - 1 Q",availableUnits:"Apartamento 305"};l={id:n,sent:0,taxes:0,status:"atendimento",discount:0,shipping:0,subtotal:0,subTotalPrice:0,createDate:new Date,dueDate:new Date,totalAmount:0,invoiceNumber:`INV-${n}`,corretorId:"1",invoiceFrom:{id:"from-1",name:"Empresa",email:"empresa@email.com",phone:"(11) 99999-9999",address:"Endereço da empresa",company:"Empresa Ltda",primary:!0},invoiceTo:{id:"to-1",name:"Cliente",email:"cliente@email.com",phone:"(11) 88888-8888",address:"Endereço do cliente",company:"Cliente Ltda",primary:!1},items:[],history:{orderTime:new Date().toISOString(),paymentTime:new Date().toISOString(),deliveryTime:new Date().toISOString(),completionTime:new Date().toISOString(),timeline:[{title:"Atendimento criado",time:new Date().toISOString()}]},formData:c}}return l},[n]);return o.useMemo(()=>({venda:(s==null?void 0:s.venda)||t,vendaLoading:p,vendaError:a,vendaValidating:i}),[s==null?void 0:s.venda,t,a,p,i])}function Y(){var j;const n=P(),{id:d=""}=H(),{user:s}=w(),{contacts:p}=W(),{venda:a}=X(d),i=`venda-${d}`,{conversation:t,conversationError:u,conversationLoading:l}=B(i),c=U(),[g,I]=o.useState([]),[x,h]=o.useState([]);o.useEffect(()=>{i||o.startTransition(()=>{n.push(S.dashboard.chat)})},[u,n,i]),o.useEffect(()=>{t!=null&&t.participants&&h(t.participants)},[t==null?void 0:t.participants,s==null?void 0:s.id]);const C=o.useCallback(r=>{I(r)},[]),V=o.useCallback(r=>{h(m=>m.some(D=>D.id===r.id||D.email===r.email)?m:[...m,r])},[]),A=o.useCallback(r=>{h(m=>m.filter(y=>y.id!==r))},[]),v=x.filter(r=>r.role!=="IA Assistente"),N=x,b=i&&t;return e.jsxs(O,{maxWidth:!1,sx:{display:"flex",flex:"1 1 auto",flexDirection:"column"},children:[e.jsxs(L,{sx:{display:"flex",alignItems:"center",gap:2,mb:{xs:3,md:5}},children:[e.jsx(F,{onClick:()=>n.push(S.dashboard.vendas.root),sx:{bgcolor:"action.hover","&:hover":{bgcolor:"action.selected"}},children:e.jsx($,{icon:"eva:arrow-back-fill"})}),e.jsxs(k,{variant:"h4",children:["Atendimento - ",((j=a==null?void 0:a.invoiceTo)==null?void 0:j.name)||"Cliente"," #"," ",(a==null?void 0:a.invoiceNumber)||`VND-${String(d).padStart(4,"0")}`]})]}),e.jsx(q,{slots:{header:b?e.jsx(Z,{collapseNav:c,participants:v,loading:l,vendaStatus:a==null?void 0:a.status,onAddParticipant:V,onRemoveParticipant:A}):e.jsx(_,{contacts:p,onAddRecipients:C}),nav:null,main:e.jsxs(e.Fragment,{children:[i?u?e.jsx(E,{title:u.message,imgUrl:`${f.assetsDir}/assets/icons/empty/ic-chat-empty.svg`}):e.jsx(J,{messages:(t==null?void 0:t.messages)??[],participants:N,loading:l}):e.jsx(E,{title:"Good morning!",description:"Write something awesome...",imgUrl:`${f.assetsDir}/assets/icons/empty/ic-chat-active.svg`}),e.jsx(Q,{recipients:g,onAddRecipients:C,selectedConversationId:i,disabled:!g.length&&!i})]}),details:b&&e.jsx(z,{collapseNav:c,participants:v,loading:l,messages:(t==null?void 0:t.messages)??[]})}})]})}const ee={title:`Vendas details | Dashboard - ${f.appName}`};function ve(){return e.jsxs(e.Fragment,{children:[e.jsx(G,{children:e.jsxs("title",{children:[" ",ee.title]})}),e.jsx(Y,{})]})}export{ve as default};

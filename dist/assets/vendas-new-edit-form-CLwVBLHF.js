import{V as O,y as A,z as R,O as S,r as l,c5 as U,p as I,j as t,F as V,S as h,B as d,N as W,Q as o,bH as z,D as w,K as r,e1 as v,T as f}from"./index-D82XrlGq.js";import{u as H}from"./property-D2aquZ-Y.js";import{C as E}from"./Card-Bw-3A9ev.js";import{C as y}from"./CardHeader-BbCWHGKm.js";const G=S({name:o().optional(),isNewClient:z(),clientName:o().optional(),clientPhone:o().optional(),clientEmail:o().optional(),code:o().min(1,{message:"Product code is required!"}),unitType:o().optional(),availableUnits:o().optional()});function J({currentVendas:P,onValidationChange:c,onSubmittingChange:m,onCreateAtendimento:j,isCreatingAtendimento:g=!1}){const{properties:p}=H(),C=O(),T={name:"",isNewClient:!1,clientName:"",clientPhone:"",clientEmail:"",code:"",unitType:"",availableUnits:""},N=A({resolver:R(G),defaultValues:T}),{reset:$,watch:D,setValue:a,handleSubmit:F,formState:{isSubmitting:b}}=N,s=D(),k=i=>{const e=i.replace(/\D/g,"");return e.length<=2?`(${e}`:e.length<=3?`(${e.slice(0,2)}) ${e.slice(2)}`:e.length<=7?`(${e.slice(0,2)}) ${e.slice(2,3)} ${e.slice(3)}`:`(${e.slice(0,2)}) ${e.slice(2,3)} ${e.slice(3,7)}-${e.slice(7,11)}`},u=l.useCallback(()=>{if(!s.code)return!1;const i=!!s.name&&!s.isNewClient,e=s.isNewClient&&!!(s.clientName&&s.clientPhone&&s.clientEmail);return i||e},[s.code,s.name,s.isNewClient,s.clientName,s.clientPhone,s.clientEmail]);l.useEffect(()=>{c==null||c(u())},[s.name,s.isNewClient,s.clientName,s.clientPhone,s.clientEmail,s.code,c,u]),l.useEffect(()=>{m==null||m(b)},[b,m]),l.useEffect(()=>{s.name&&!s.isNewClient&&(a("clientName",""),a("clientPhone",""),a("clientEmail",""))},[s.name,s.isNewClient,a]),l.useEffect(()=>{s.isNewClient&&a("name","")},[s.isNewClient,a]);const q=F(async i=>{try{await new Promise(e=>setTimeout(e,500)),$(),U.success(P?"Update success!":"Create success!"),C.push(I.dashboard.vendas.root),console.info("DATA",i)}catch(e){console.error(e)}}),B=()=>t.jsxs(E,{children:[t.jsx(y,{title:"Registrar novo atendimento",subheader:"Preencha as informações solicitadas",sx:{mb:3}}),t.jsx(w,{}),t.jsxs(h,{spacing:3,sx:{p:3},children:[t.jsx(r.Autocomplete,{name:"name",label:"Busque um cliente existente",placeholder:"Digite o nome do cliente...",options:v.map(i=>i.name),getOptionLabel:i=>i,disabled:s.isNewClient,renderOption:(i,e)=>{const n=v.find(x=>x.name===e);return l.createElement("li",{...i,key:e},t.jsxs(d,{sx:{display:"flex",alignItems:"center",gap:2},children:[t.jsx(d,{component:"img",src:n==null?void 0:n.avatarUrl,sx:{width:32,height:32,borderRadius:"50%"}}),t.jsxs(d,{children:[t.jsx(f,{variant:"body2",children:n==null?void 0:n.name}),t.jsx(f,{variant:"caption",color:"text.secondary",children:n==null?void 0:n.email})]})]}))}}),t.jsx(r.Switch,{name:"isNewClient",label:"Novo cliente"}),s.isNewClient&&t.jsxs(t.Fragment,{children:[t.jsx(r.Text,{name:"clientName",label:"Nome completo",placeholder:"Digite o nome completo do cliente"}),t.jsx(r.Text,{name:"clientPhone",label:"WhatsApp",placeholder:"(00) 0 0000-0000",onChange:i=>{const e=k(i.target.value);a("clientPhone",e)},inputProps:{inputMode:"numeric",pattern:"[0-9]*",maxLength:16}}),t.jsx(r.Text,{name:"clientEmail",label:"E-mail",placeholder:"E-mail",type:"email"})]})]})]}),L=()=>t.jsxs(E,{children:[t.jsx(y,{title:"Selecione o imóvel",subheader:"Informe qual o imóvel de interesse do cliente",sx:{mb:3}}),t.jsx(w,{}),t.jsx(h,{spacing:3,sx:{p:3},children:t.jsx(r.Autocomplete,{name:"code",label:"Imóvel",placeholder:"Busque o imóvel que será comprado",options:(p||[]).map(i=>i.id),getOptionLabel:i=>{const e=(p||[]).find(n=>n.id===i);return e?e.name:i},renderOption:(i,e)=>{const n=(p||[]).find(x=>x.id===e);return l.createElement("li",{...i,key:e},t.jsx(f,{variant:"body2",children:n==null?void 0:n.name}))}})})]});return t.jsx(V,{methods:N,onSubmit:q,id:"vendas-form",children:t.jsxs(h,{spacing:{xs:3,md:5},sx:{mx:"auto",maxWidth:{xs:720,xl:880}},children:[B(),L(),j&&t.jsx(d,{sx:{mt:3},children:t.jsx(W,{fullWidth:!0,variant:"contained",color:"warning",size:"large",disabled:!u(),loading:g,onClick:j,children:"Criar novo atendimento"})})]})})}export{J as V};

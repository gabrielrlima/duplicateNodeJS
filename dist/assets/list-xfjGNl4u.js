import{b0 as Q,j as e,a1 as H,I as C,B as f,aP as se,aJ as ae,aK as ne,L as J,R as A,D as K,T as w,aA as G,b1 as U,b2 as Y,b3 as _,r as d,p as I,f as O,bk as le,V as oe,b4 as ie,b6 as N,b7 as ce,b8 as $,b9 as de,ba as ue,au as L,a0 as pe,bb as xe,bc as k,bo as q,ax as me,bp as he,S as M,a_ as fe,aj as ge,Y as be,bd as je,cV as Ce,bj as Pe,dV as ve,aq as ye}from"./index-cNRh_qft.js";import{u as we}from"./use-comissoes-DByAcImR.js";import{E as D}from"./empty-content-BzM3Az2z.js";import{C as ke}from"./Card-C_-31fGp.js";import{P as Se,p as Te}from"./Pagination-tgO33XKK.js";import{u as Ie}from"./index-ChnT1xRF.js";import"./LastPage-ChYIEhQh.js";import"./index-BDJJM9HW.js";const y=t=>"percentualTotal"in t&&"tipoProduto"in t,Me=t=>"comissaoTotalId"in t&&"participantes"in t;function Fe({comissao:t,editHref:x,detailsHref:i,onDelete:l,comissoes:n,sx:h,...m}){const s=Q(),u=()=>e.jsx(U,{open:s.open,anchorEl:s.anchorEl,onClose:s.onClose,slotProps:{arrow:{placement:"right-top"}},children:e.jsxs(Y,{children:[e.jsx("li",{children:e.jsxs(_,{component:A,href:i,onClick:()=>s.onClose(),children:[e.jsx(C,{icon:"solar:eye-bold"}),"Visualizar"]})}),e.jsx("li",{children:e.jsxs(_,{component:A,href:x,onClick:()=>s.onClose(),children:[e.jsx(C,{icon:"solar:pen-bold"}),"Editar"]})}),e.jsxs(_,{onClick:()=>{s.onClose(),l()},sx:{color:"error.main"},children:[e.jsx(C,{icon:"solar:trash-bin-trash-bold"}),"Excluir"]})]})});return e.jsxs(e.Fragment,{children:[e.jsxs(ke,{sx:h,...m,children:[e.jsx(H,{onClick:s.onOpen,sx:{position:"absolute",top:8,right:8},children:e.jsx(C,{icon:"eva:more-vertical-fill"})}),e.jsxs(f,{sx:{p:3,pb:2},children:[e.jsx(f,{sx:{mb:2},children:e.jsx(se,{variant:"soft",color:t.status==="ativo"&&"success"||"default",sx:{textTransform:"capitalize",fontSize:"0.75rem",fontWeight:600},children:t.status})}),e.jsx(ae,{sx:{mb:1},primary:e.jsx(J,{component:A,href:i,color:"inherit",children:t.nome}),secondary:t.descricao||`Criado em: ${ne(t.createdAt)}`,slotProps:{primary:{sx:{typography:"subtitle1",minHeight:"2.5em",lineHeight:1.25,display:"flex",alignItems:"flex-start"}},secondary:{sx:{mt:1,typography:"caption",color:"text.disabled",minHeight:"2.4em",lineHeight:1.2,display:"-webkit-box",WebkitLineClamp:2,WebkitBoxOrient:"vertical",overflow:"hidden",textOverflow:"ellipsis"}}}})]}),e.jsx(K,{sx:{borderStyle:"dashed"}}),e.jsxs(f,{sx:{p:3,display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs(f,{sx:{gap:.5,display:"flex",alignItems:"center",color:"text.disabled"},children:[e.jsx(C,{width:16,icon:"solar:tag-bold",sx:{flexShrink:0,color:"info.main"}}),e.jsx(w,{variant:"caption",noWrap:!0,children:(()=>{if(y(t))switch(t.tipoProduto){case"imovel":return"Imóvel";case"terreno":return"Terreno";case"empreendimento":return"Empreendimento";default:return"Produto"}const g=n==null?void 0:n.find(r=>y(r)&&r.id===t.comissaoTotalId);if(g&&y(g))switch(g.tipoProduto){case"imovel":return"Imóvel";case"terreno":return"Terreno";case"empreendimento":return"Empreendimento";default:return"Produto"}return"Produto"})()})]}),e.jsxs(f,{sx:{gap:.5,display:"flex",alignItems:"center",color:"text.disabled"},children:[e.jsx(C,{width:16,icon:"solar:percent-bold",sx:{flexShrink:0,color:"success.main"}}),e.jsx(w,{variant:"caption",noWrap:!0,children:y(t)?G(t.percentualTotal||0):G(0)})]})]})]}),u()]})}function Re({comissoes:t,page:x=0,count:i=0,rowsPerPage:l=9,onPageChange:n,onRowsPerPageChange:h}){const m=d.useCallback(s=>{console.info("DELETE",s)},[]);return e.jsxs(e.Fragment,{children:[e.jsx(f,{sx:{gap:3,display:"grid",gridTemplateColumns:{xs:"repeat(1, 1fr)",sm:"repeat(2, 1fr)",md:"repeat(3, 1fr)"}},children:t.map(s=>e.jsx(Fe,{comissao:s,editHref:I.dashboard.comissoes.edit(s.id),detailsHref:I.dashboard.comissoes.details(s.id),onDelete:()=>m(s.id),comissoes:t},s.id))}),i>1&&e.jsx(Se,{page:x+1,count:i,onChange:(s,u)=>n==null?void 0:n(s,u-1),sx:{mt:{xs:8,md:8},[`& .${Te.ul}`]:{justifyContent:"center"}}})]})}function Ee({sort:t,onSort:x,sortOptions:i}){const l=Q(),n=i.find(s=>s.value===t),h=(n==null?void 0:n.label)||t,m=()=>e.jsx(U,{open:l.open,anchorEl:l.anchorEl,onClose:l.onClose,children:e.jsx(Y,{children:i.map(s=>e.jsx(_,{selected:s.value===t,onClick:()=>{l.onClose(),x(s.value)},children:s.label},s.value))})});return e.jsxs(e.Fragment,{children:[e.jsxs(O,{disableRipple:!0,color:"inherit",onClick:l.onOpen,endIcon:e.jsx(C,{icon:l.open?"eva:arrow-ios-upward-fill":"eva:arrow-ios-downward-fill"}),sx:{fontWeight:"fontWeightSemiBold"},children:["Ordenar por:",e.jsx(f,{component:"span",sx:{ml:.5,fontWeight:"fontWeightBold",textTransform:"capitalize"},children:h})]}),m()]})}const Le={revalidateIfStale:!1,revalidateOnFocus:!1,revalidateOnReconnect:!1};function Ae(t,x){const i=new URLSearchParams;i.append("real_estate_id",t),i.append("search",x);const l=null,{data:n,isLoading:h,error:m,isValidating:s}=Ie(l,le,Le);return d.useMemo(()=>{var g,r,p,o;return{searchResults:((g=n==null?void 0:n.data)==null?void 0:g.data)||[],searchPagination:((r=n==null?void 0:n.data)==null?void 0:r.pagination)||{page:1,limit:10,total:0,totalPages:0,hasNext:!1,hasPrev:!1},searchLoading:h,searchError:m,searchValidating:s,searchEmpty:!h&&!s&&!((o=(p=n==null?void 0:n.data)==null?void 0:p.data)!=null&&o.length)}},[n,m,h,s])}function Oe({redirectPath:t,sx:x}){const i=oe(),[l,n]=d.useState(""),[h,m]=d.useState(null),s=ie(l),{searchResults:u,searchLoading:g}=We(s),r=d.useCallback(o=>{m(o),o&&i.push(t(o.id))},[t,i]),p={width:320,[` .${N.listbox}`]:{[` .${N.option}`]:{p:0,[` .${ce.root}`]:{px:1,py:.75,width:1}}}};return e.jsx($,{autoHighlight:!0,popupIcon:null,loading:g,options:u,value:h,onChange:(o,b)=>r(b),onInputChange:(o,b)=>n(b),getOptionLabel:o=>(o==null?void 0:o.nome)||"",noOptionsText:e.jsx(xe,{query:s}),isOptionEqualToValue:(o,b)=>o.id===b.id,slotProps:{paper:{sx:p}},sx:[{width:{xs:1,sm:260}},...Array.isArray(x)?x:[x]],renderInput:o=>e.jsx(L,{...o,placeholder:"Pesquisar regras de comissão...",slotProps:{input:{...o.InputProps,startAdornment:e.jsx(pe,{position:"start",children:e.jsx(C,{icon:"eva:search-fill",sx:{ml:1,color:"text.disabled"}})}),endAdornment:e.jsxs(e.Fragment,{children:[g?e.jsx(C,{icon:"svg-spinners:8-dots-rotate",sx:{mr:-3}}):null,o.InputProps.endAdornment]})}}}),renderOption:(o,b,{inputValue:S})=>{const P=de(b.nome,S),F=ue(b.nome,P);return d.createElement("li",{...o,key:b.id},e.jsx(J,{component:A,href:t(b.id),color:"inherit",underline:"none",children:F.map((v,R)=>e.jsx(w,{component:"span",color:v.highlight?"primary":"textPrimary",sx:{typography:"body2",fontWeight:v.highlight?"fontWeightSemiBold":"fontWeightMedium"},children:v.text},R))},S))}})}function We(t){const{searchResults:x,searchLoading:i}=Ae("",t);return{searchResults:x,searchLoading:i}}function _e({open:t,onOpen:x,onClose:i,filters:l,canReset:n,onResetSearch:h,options:m}){const{state:s,setState:u}=l,g=d.useCallback(a=>{u({status:a})},[u]),r=d.useCallback(a=>{u({tipo:a})},[u]),p=d.useCallback(a=>{u({percentualMinimo:a})},[u]),o=d.useCallback(a=>{u({percentualMaximo:a})},[u]),b=d.useCallback(a=>{u({categoriaProduto:a})},[u]),S=d.useCallback(a=>{u({tiposParticipante:a})},[u]),P=d.useCallback(()=>{u({status:"all",tipo:[],categoriaProduto:[],tiposParticipante:[],percentualMinimo:null,percentualMaximo:null}),h()},[u,h]),F=e.jsxs(f,{display:"flex",alignItems:"center",sx:{py:2,pr:1,pl:2.5},children:[e.jsx(w,{variant:"h6",sx:{flexGrow:1},children:"Filtros"}),e.jsx(fe,{title:"Resetar",children:e.jsx(H,{onClick:P,children:e.jsx(q,{color:"error",variant:"dot",invisible:!n,children:e.jsx(C,{icon:"solar:restart-bold"})})})}),e.jsx(H,{onClick:i,children:e.jsx(C,{icon:"mingcute:close-line"})})]}),v=e.jsxs(f,{display:"flex",flexDirection:"column",children:[e.jsx(w,{variant:"subtitle2",sx:{mb:1},children:"Status"}),e.jsx(f,{gap:1,display:"flex",flexWrap:"wrap",children:["all",...m.status].map(a=>e.jsx(k,{label:a==="all"?"Todos":a,size:"small",variant:s.status===a?"filled":"outlined",onClick:()=>g(a)},a))})]}),R=e.jsxs(f,{display:"flex",flexDirection:"column",children:[e.jsx(w,{variant:"subtitle2",sx:{mb:1.5},children:"Tipo de Comissão"}),e.jsx($,{multiple:!0,options:m.tipo,value:s.tipo,onChange:(a,c)=>r(c),renderInput:a=>e.jsx(L,{placeholder:"Selecionar tipos",...a}),renderOption:(a,c)=>d.createElement("li",{...a,key:c},c==="total_imobiliaria"?"Comissão Total":c==="distribuicao_interna"?"Distribuição Interna":c),renderTags:(a,c)=>a.map((j,E)=>d.createElement(k,{...c({index:E}),key:j,label:j==="total_imobiliaria"?"Comissão Total":j==="distribuicao_interna"?"Distribuição Interna":j,size:"small",variant:"soft"}))})]}),z=e.jsxs(f,{display:"flex",flexDirection:"column",children:[e.jsx(w,{variant:"subtitle2",sx:{mb:1},children:"Categoria de Produto"}),e.jsx(f,{gap:1,display:"flex",flexWrap:"wrap",children:m.categoriaProduto.map(a=>e.jsx(k,{label:a==="imovel"?"Imóvel":a==="terreno"?"Terreno":a==="empreendimento"?"Empreendimento":a,size:"small",variant:s.categoriaProduto.includes(a)?"filled":"outlined",onClick:()=>{const c=s.categoriaProduto.includes(a)?s.categoriaProduto.filter(j=>j!==a):[...s.categoriaProduto,a];b(c)}},a))})]}),V=e.jsxs(f,{display:"flex",flexDirection:"column",children:[e.jsx(w,{variant:"subtitle2",sx:{mb:1.5},children:"Tipos de Participante"}),e.jsx($,{multiple:!0,options:m.tiposParticipante,value:s.tiposParticipante,onChange:(a,c)=>S(c),renderInput:a=>e.jsx(L,{placeholder:"Selecionar participantes",...a}),renderOption:(a,c)=>d.createElement("li",{...a,key:c},c==="imobiliaria"?"Imobiliária":c==="corretor_principal"?"Corretor Principal":c==="corretor_suporte"?"Corretor Suporte":c==="coordenador"?"Coordenador":c==="grupo"?"Grupo":c==="captador"?"Captador":c),renderTags:(a,c)=>a.map((j,E)=>d.createElement(k,{...c({index:E}),key:j,label:j==="imobiliaria"?"Imobiliária":j==="corretor_principal"?"Corretor Principal":j==="corretor_suporte"?"Corretor Suporte":j==="coordenador"?"Coordenador":j==="grupo"?"Grupo":j==="captador"?"Captador":j,size:"small",variant:"soft"}))})]}),B=e.jsxs(f,{display:"flex",flexDirection:"column",children:[e.jsx(w,{variant:"subtitle2",sx:{mb:1.5},children:"Faixa de Percentual (%)"}),e.jsxs(f,{gap:1.5,display:"flex",children:[e.jsx(L,{label:"Mínimo",type:"number",value:s.percentualMinimo||"",onChange:a=>{const c=a.target.value?Number(a.target.value):null;p(c)},sx:{flexGrow:1}}),e.jsx(L,{label:"Máximo",type:"number",value:s.percentualMaximo||"",onChange:a=>{const c=a.target.value?Number(a.target.value):null;o(c)},sx:{flexGrow:1}})]})]});return e.jsxs(e.Fragment,{children:[e.jsx(O,{disableRipple:!0,color:"inherit",endIcon:e.jsx(q,{color:"error",variant:"dot",invisible:!n,children:e.jsx(C,{icon:"ic:round-filter-list"})}),onClick:x,children:"Filtros"}),e.jsxs(me,{anchor:"right",open:t,onClose:i,slotProps:{backdrop:{invisible:!0}},PaperProps:{sx:{width:320}},children:[F,e.jsx(K,{}),e.jsx(he,{sx:{px:2.5,py:3},children:e.jsxs(M,{spacing:3,children:[v,R,z,V,B]})})]})]})}function ze({filters:t,totalResults:x,...i}){const{state:l,setState:n}=t,h=d.useCallback(()=>{n({status:"all"})},[n]),m=d.useCallback(r=>{const p=l.tipo.filter(o=>o!==r);n({tipo:p})},[l.tipo,n]),s=d.useCallback(()=>{n({percentualMinimo:null})},[n]),u=d.useCallback(()=>{n({percentualMaximo:null})},[n]),g=d.useCallback(()=>{n({status:"all",tipo:[],percentualMinimo:null,percentualMaximo:null})},[n]);return e.jsxs(M,{spacing:1.5,...i,children:[e.jsxs(f,{sx:{typography:"body2"},children:[e.jsx("strong",{children:x}),e.jsx(f,{component:"span",sx:{color:"text.secondary",ml:.25},children:"resultados encontrados"})]}),e.jsxs(M,{flexGrow:1,spacing:1,direction:"row",flexWrap:"wrap",alignItems:"center",children:[l.status!=="all"&&e.jsx(W,{label:"Status:",children:e.jsx(k,{size:"small",label:l.status,onDelete:h})}),!!l.tipo.length&&e.jsx(W,{label:"Tipo:",children:l.tipo.map(r=>e.jsx(k,{label:r,size:"small",onDelete:()=>m(r)},r))}),l.percentualMinimo!==null&&e.jsx(W,{label:"Percentual mín.:",children:e.jsx(k,{size:"small",label:`${l.percentualMinimo}%`,onDelete:s})}),l.percentualMaximo!==null&&e.jsx(W,{label:"Percentual máx.:",children:e.jsx(k,{size:"small",label:`${l.percentualMaximo}%`,onDelete:u})}),e.jsx(O,{color:"error",onClick:g,startIcon:e.jsx(C,{icon:"solar:trash-bin-trash-bold"}),children:"Limpar"})]})]})}function W({label:t,children:x,sx:i,...l}){return e.jsxs(M,{component:ge,variant:"outlined",spacing:1,direction:"row",sx:{p:1,borderRadius:1,overflow:"hidden",borderStyle:"dashed",...i},...l,children:[e.jsx(f,{component:"span",sx:{typography:"subtitle2"},children:t}),e.jsx(M,{spacing:1,direction:"row",flexWrap:"wrap",children:x})]})}function Je(){const t=be(),[x,i]=d.useState("latest"),[l,n]=d.useState(""),[h,m]=d.useState(0),[s,u]=d.useState(9),g=je({status:"all",tipo:[],categoriaProduto:[],tiposParticipante:[],percentualMinimo:null,percentualMaximo:null}),{state:r}=g,{comissoes:p,loading:o,error:b,refetch:S}=we(),P=Ve({inputData:p,filters:r,sortBy:x,searchQuery:l}),F=P.slice(h*s,h*s+s),v=!!l||r.status!=="all"||!!r.tipo.length||!!r.categoriaProduto.length||!!r.tiposParticipante.length||r.percentualMinimo!==null||r.percentualMaximo!==null,R=!P.length&&v,z=o&&!p.length,V=!!b&&!o,B=!o&&!b&&!P.length&&!v,a=!o&&!b&&P.length>0,c=d.useCallback(T=>{i(T)},[]),j=d.useCallback((T,re)=>{m(re)},[]),E=d.useCallback(T=>{u(parseInt(T.target.value,10)),m(0)},[]),X={status:["ativo","inativo","pendente"],tipo:["total_imobiliaria","distribuicao_interna"],categoriaProduto:["imovel","terreno","empreendimento"],tiposParticipante:["imobiliaria","corretor_principal","corretor_suporte","coordenador","grupo","captador"]},Z=[{value:"latest",label:"Mais recentes"},{value:"oldest",label:"Mais antigos"},{value:"nome",label:"Nome"},{value:"percentual",label:"Percentual"},{value:"status",label:"Status"}],ee=()=>e.jsxs(f,{sx:{gap:3,display:"flex",justifyContent:"space-between",flexDirection:{xs:"column",sm:"row"},alignItems:{xs:"flex-end",sm:"center"}},children:[e.jsx(Oe,{redirectPath:T=>I.dashboard.comissoes.details(T)}),e.jsxs(f,{sx:{gap:1,flexShrink:0,display:"flex"},children:[e.jsx(_e,{filters:g,canReset:v,open:t.value,onOpen:t.onTrue,onClose:t.onFalse,onResetSearch:()=>n(""),options:X}),e.jsx(Ee,{sort:x,onSort:c,sortOptions:Z})]})]}),te=()=>e.jsx(ze,{filters:g,totalResults:P.length});return e.jsxs(Ce,{children:[e.jsx(Pe,{heading:"Regras de Comissões",links:[{name:"Dashboard",href:I.dashboard.root},{name:"Regras de Comissões",href:I.dashboard.comissoes.root},{name:"Lista"}],action:e.jsx(O,{component:A,href:I.dashboard.comissoes.new,variant:"contained",startIcon:e.jsx(C,{icon:"mingcute:add-line"}),children:"Nova regra"}),sx:{mb:{xs:3,md:5}}}),e.jsxs(M,{spacing:2.5,sx:{mb:{xs:3,md:5}},children:[ee(),v&&te()]}),z&&e.jsx(f,{sx:{display:"flex",justifyContent:"center",py:10},children:e.jsx(ve,{})}),V&&e.jsxs(ye,{severity:"error",sx:{mb:3},children:[b,e.jsx(O,{onClick:S,sx:{ml:2},children:"Tentar novamente"})]}),B&&e.jsx(D,{filled:!0,sx:{py:10}}),R&&e.jsx(D,{filled:!0,sx:{py:10}}),a&&e.jsx(Re,{comissoes:F,page:h,count:Math.ceil(P.length/s),rowsPerPage:s,onPageChange:j,onRowsPerPageChange:E})]})}function Ve({inputData:t,filters:x,sortBy:i,searchQuery:l}){const{status:n,tipo:h,categoriaProduto:m,tiposParticipante:s,percentualMinimo:u,percentualMaximo:g}=x;return l&&(t=t.filter(r=>r.nome.toLowerCase().indexOf(l.toLowerCase())!==-1||r.descricao.toLowerCase().indexOf(l.toLowerCase())!==-1)),n!=="all"&&(t=t.filter(r=>r.status===n)),h.length&&(t=t.filter(r=>{const p=y(r)?"total_imobiliaria":"distribuicao_interna";return h.includes(p)})),m.length&&(t=t.filter(r=>y(r)?m.includes(r.tipoProduto):!0)),s.length&&(t=t.filter(r=>{var p;return Me(r)?((p=r.participantes)==null?void 0:p.some(o=>s.includes(o.tipo)))||!1:!0})),u!==null&&(t=t.filter(r=>y(r)?r.percentualTotal>=u:!0)),g!==null&&(t=t.filter(r=>y(r)?r.percentualTotal<=g:!0)),i==="latest"&&(t=t.sort((r,p)=>new Date(p.createdAt).getTime()-new Date(r.createdAt).getTime())),i==="oldest"&&(t=t.sort((r,p)=>new Date(r.createdAt).getTime()-new Date(p.createdAt).getTime())),i==="nome"&&(t=t.sort((r,p)=>r.nome.localeCompare(p.nome))),i==="percentual"&&(t=t.sort((r,p)=>{const o=y(r)?r.percentualTotal:0;return(y(p)?p.percentualTotal:0)-o})),i==="status"&&(t=t.sort((r,p)=>r.status.localeCompare(p.status))),t}export{Je as default};

import{j as a,B as o,T as e,a$ as D,A as H,az as V,b0 as W,a1 as J,R as _,I as z,S as B,aP as K,d1 as Q,f as O,p as G,b1 as X,b2 as Y,b3 as Z,r as v,cN as P,cV as w,eM as ss,G as F,D as q,W as as,H as R,C as is,a8 as es,a9 as os}from"./index-cNRh_qft.js";import{u as ds}from"./use-params-DYuE92tD.js";import"./empty-content-BzM3Az2z.js";import"./terreno-wizard-form-CdhYBVNp.js";import{u as ls}from"./terreno-B_nrSajh.js";import{C as k}from"./Card-C_-31fGp.js";import{C as j}from"./CardHeader-CZZHKPlX.js";import{u as cs,L as ts}from"./use-light-box-Bxjny2_T.js";import"./Grid-BAAHJ7js.js";import"./index-ChnT1xRF.js";import"./index-BDJJM9HW.js";function ns({sx:s,title:d,area:l,price:c,description:n,...t}){return a.jsxs(k,{sx:s,...t,children:[a.jsx(j,{title:"Informações Gerais"}),a.jsxs(o,{sx:{p:3},children:[a.jsxs(o,{sx:{mb:3},children:[a.jsx(e,{variant:"h6",sx:{mb:1},children:d||"Não informado"}),a.jsxs(o,{sx:{display:"grid",gap:2,gridTemplateColumns:"repeat(auto-fit, minmax(200px, 1fr))",mb:2},children:[a.jsxs(o,{children:[a.jsx(e,{variant:"body2",sx:{color:"text.secondary",mb:.5},children:"Área"}),a.jsx(e,{variant:"subtitle2",children:l?`${l.toLocaleString()} m²`:"Não informado"})]}),a.jsxs(o,{children:[a.jsx(e,{variant:"body2",sx:{color:"text.secondary",mb:.5},children:"Preço"}),a.jsx(e,{variant:"subtitle2",sx:{color:"success.main"},children:c?D(c):"Não informado"})]})]})]}),a.jsxs(o,{children:[a.jsx(e,{variant:"body2",sx:{color:"text.secondary",mb:1},children:"Descrição"}),a.jsx(e,{variant:"body2",sx:{lineHeight:1.6},children:n||"Não informado"})]})]})]})}function rs({owner:s}){var d,l;return a.jsxs(a.Fragment,{children:[a.jsx(j,{title:"Proprietário"}),a.jsxs(o,{sx:{p:3},children:[a.jsxs(o,{sx:{display:"flex",alignItems:"center",mb:2.5},children:[a.jsx(H,{alt:s==null?void 0:s.name,src:s==null?void 0:s.avatarUrl,sx:{width:56,height:56,mr:2},children:(l=(d=s==null?void 0:s.name)==null?void 0:d.charAt(0))==null?void 0:l.toUpperCase()}),a.jsxs(o,{children:[a.jsx(e,{variant:"subtitle1",sx:{mb:.5,fontWeight:600},children:(s==null?void 0:s.name)||"Não informado"}),a.jsx(e,{variant:"body2",sx:{color:"text.secondary"},children:(s==null?void 0:s.document)||"Não informado"})]})]}),a.jsxs(o,{sx:{display:"grid",gap:2,gridTemplateColumns:"repeat(auto-fit, minmax(200px, 1fr))"},children:[a.jsxs(o,{children:[a.jsx(e,{variant:"body2",sx:{color:"text.secondary",mb:.5},children:"E-mail"}),a.jsx(e,{variant:"subtitle2",children:(s==null?void 0:s.email)||"Não informado"})]}),a.jsxs(o,{children:[a.jsx(e,{variant:"body2",sx:{color:"text.secondary",mb:.5},children:"Telefone"}),a.jsx(e,{variant:"subtitle2",children:(s==null?void 0:s.phone)||"Não informado"})]})]})]})]})}function xs({images:s=[]}){const d=s.map(c=>({src:c})),l=cs(d);return s.length===0?a.jsxs(a.Fragment,{children:[a.jsx(j,{title:"Imagens"}),a.jsx(o,{sx:{p:3,textAlign:"center"},children:a.jsx(e,{variant:"body2",sx:{color:"text.secondary"},children:"Nenhuma imagem disponível"})})]}):a.jsxs(a.Fragment,{children:[a.jsx(j,{title:"Imagens",subheader:`${s.length} ${s.length===1?"imagem":"imagens"}`}),a.jsx(o,{sx:{p:3},children:a.jsx(o,{sx:{display:"grid",gap:1,gridTemplateColumns:{xs:"repeat(2, 1fr)",sm:"repeat(3, 1fr)",md:"repeat(4, 1fr)"}},children:s.map((c,n)=>a.jsx(o,{sx:{position:"relative",paddingTop:"75%",cursor:"pointer",borderRadius:1,overflow:"hidden","&:hover":{opacity:.8}},onClick:()=>l.onOpen(c),children:a.jsx(V,{alt:`Terreno ${n+1}`,src:c,sx:{position:"absolute",top:0,left:0,width:1,height:1,objectFit:"cover"}})},n))})}),a.jsx(ts,{index:l.selected,slides:d,open:l.open,close:l.onClose})]})}function hs({status:s,backHref:d,terrenoId:l,createdAt:c,terrenoCode:n,statusOptions:t,onChangeStatus:p}){const r=W(),h=()=>{const u={available:"disponivel",reserved:"reservado",sold:"vendido",inactive:"suspenso"}[s||""]||s;return a.jsx(X,{open:r.open,anchorEl:r.anchorEl,onClose:r.onClose,slotProps:{arrow:{placement:"top-right"}},children:a.jsx(Y,{children:t.map(x=>{const m=x.value===u;return a.jsx(Z,{selected:m,disabled:m,onClick:m?void 0:()=>{r.onClose(),p(x.value)},children:x.label},x.value)})})})};return a.jsxs(a.Fragment,{children:[a.jsxs(o,{sx:{gap:3,display:"flex",mb:{xs:3,md:5},flexDirection:{xs:"column",md:"row"}},children:[a.jsxs(o,{sx:{gap:1,display:"flex",alignItems:"flex-start"},children:[a.jsx(J,{component:_,href:d,children:a.jsx(z,{icon:"eva:arrow-ios-back-fill"})}),a.jsxs(B,{spacing:.5,children:[a.jsxs(o,{sx:{gap:1,display:"flex",alignItems:"center"},children:[a.jsxs(e,{variant:"h4",children:[" Terreno ",n," "]}),a.jsx(K,{variant:"soft",color:s==="available"&&"success"||s==="reserved"&&"warning"||s==="sold"&&"info"||s==="inactive"&&"error"||"default",children:s==="available"?"Disponível":s==="reserved"?"Reservado":s==="sold"?"Vendido":s==="inactive"?"Inativo":s})]}),a.jsx(e,{variant:"body2",sx:{color:"text.disabled"},children:Q(c)})]})]}),a.jsxs(o,{sx:{gap:1.5,flexGrow:1,display:"flex",alignItems:"center",justifyContent:"flex-end"},children:[a.jsx(O,{color:"inherit",variant:"outlined",endIcon:a.jsx(z,{icon:"eva:arrow-ios-downward-fill"}),onClick:r.onOpen,sx:{textTransform:"capitalize"},children:s==="available"?"Disponível":s==="reserved"?"Reservado":s==="sold"?"Vendido":s==="inactive"?"Inativo":s}),a.jsx(O,{color:"inherit",variant:"contained",startIcon:a.jsx(z,{icon:"solar:pen-bold"}),component:_,href:G.dashboard.terrenos.edit(l),children:"Editar"})]})]}),h()]})}function ms({sx:s,address:d,city:l,state:c,zipCode:n,coordinates:t,...p}){const r=()=>{if(t){const h=`https://www.google.com/maps?q=${t.lat},${t.lng}`;window.open(h,"_blank")}};return a.jsxs(k,{sx:s,...p,children:[a.jsx(j,{title:"Localização"}),a.jsxs(o,{sx:{p:3},children:[a.jsxs(o,{sx:{mb:3},children:[a.jsx(e,{variant:"body2",sx:{color:"text.secondary",mb:.5},children:"Endereço"}),a.jsx(e,{variant:"subtitle2",sx:{mb:1},children:d||"Não informado"}),a.jsxs(o,{sx:{display:"flex",gap:2,mb:2},children:[a.jsxs(o,{sx:{flex:1},children:[a.jsx(e,{variant:"body2",sx:{color:"text.secondary",mb:.5},children:"Cidade"}),a.jsx(e,{variant:"subtitle2",children:l||"Não informado"})]}),a.jsxs(o,{sx:{flex:1},children:[a.jsx(e,{variant:"body2",sx:{color:"text.secondary",mb:.5},children:"Estado"}),a.jsx(e,{variant:"subtitle2",children:c||"Não informado"})]})]}),a.jsxs(o,{children:[a.jsx(e,{variant:"body2",sx:{color:"text.secondary",mb:.5},children:"CEP"}),a.jsx(e,{variant:"subtitle2",children:n||"Não informado"})]})]}),t&&a.jsx(o,{sx:{display:"flex",gap:1},children:a.jsx(O,{variant:"outlined",size:"small",startIcon:a.jsx(z,{icon:"solar:map-point-bold"}),onClick:r,fullWidth:!0,children:"Ver no Mapa"})})]})]})}function ps({price:s,pricePerSqm:d,taxes:l,documentation:c,priceNegotiable:n,ituAnual:t}){return a.jsxs(a.Fragment,{children:[a.jsx(j,{title:"Informações Financeiras"}),a.jsx(o,{sx:{p:3},children:a.jsxs(B,{spacing:2,children:[a.jsxs(o,{children:[a.jsx(e,{variant:"body2",sx:{color:"text.secondary",mb:.5},children:"Preço Total"}),a.jsx(e,{variant:"h6",sx:{color:"success.main"},children:s?D(s):"Não informado"})]}),a.jsxs(o,{children:[a.jsx(e,{variant:"body2",sx:{color:"text.secondary",mb:.5},children:"Preço por m²"}),a.jsx(e,{variant:"subtitle2",children:d?D(d):"Não informado"})]}),a.jsxs(o,{children:[a.jsx(e,{variant:"body2",sx:{color:"text.secondary",mb:.5},children:"Preço Negociável"}),a.jsx(e,{variant:"subtitle2",children:n!==void 0?n?"Sim":"Não":"Não informado"})]}),a.jsxs(o,{children:[a.jsx(e,{variant:"body2",sx:{color:"text.secondary",mb:.5},children:"ITU Anual"}),a.jsx(e,{variant:"subtitle2",children:t?D(t):"Não informado"})]}),a.jsxs(o,{children:[a.jsx(e,{variant:"body2",sx:{color:"text.secondary",mb:.5},children:"Impostos"}),a.jsx(e,{variant:"subtitle2",children:l?D(l):"Não informado"})]}),a.jsxs(o,{children:[a.jsx(e,{variant:"body2",sx:{color:"text.secondary",mb:.5},children:"Documentação"}),a.jsx(e,{variant:"subtitle2",children:c||"Não informado"})]})]})})]})}function us({sx:s,area:d,dimensions:l,topography:c,access:n,...t}){return a.jsxs(k,{sx:s,...t,children:[a.jsx(j,{title:"Características"}),a.jsx(o,{sx:{p:3},children:a.jsxs(o,{sx:{display:"grid",gap:2,gridTemplateColumns:"repeat(auto-fit, minmax(200px, 1fr))",mb:3},children:[a.jsxs(o,{children:[a.jsx(e,{variant:"body2",sx:{color:"text.secondary",mb:.5},children:"Área Total"}),a.jsx(e,{variant:"subtitle2",children:d?`${d.toLocaleString()} m²`:"Não informado"})]}),a.jsxs(o,{children:[a.jsx(e,{variant:"body2",sx:{color:"text.secondary",mb:.5},children:"Dimensões"}),a.jsx(e,{variant:"subtitle2",children:l||"Não informado"})]}),a.jsxs(o,{children:[a.jsx(e,{variant:"body2",sx:{color:"text.secondary",mb:.5},children:"Topografia"}),a.jsx(e,{variant:"subtitle2",children:c||"Não informado"})]}),a.jsxs(o,{children:[a.jsx(e,{variant:"body2",sx:{color:"text.secondary",mb:.5},children:"Acesso"}),a.jsx(e,{variant:"subtitle2",children:n||"Não informado"})]})]})})]})}function js({terreno:s}){var n,t,p,r,h,f,u,x,m,b,g,y,T,C;const[d,l]=v.useState(s==null?void 0:s.status);v.useEffect(()=>{l(s==null?void 0:s.status)},[s==null?void 0:s.status]);const c=v.useCallback(async I=>{if(!(s!=null&&s.id)){P.error("ID do terreno não encontrado");return}try{const S={disponivel:"available",reservado:"reserved",vendido:"sold",suspenso:"inactive"}[I]||I;await ls(s.id,S),l(S),P.success("Status atualizado com sucesso!")}catch(N){console.error("Erro ao atualizar status:",N),P.error("Erro ao atualizar status do terreno")}},[s==null?void 0:s.id]);return a.jsxs(w,{children:[a.jsx(hs,{status:d,createdAt:s==null?void 0:s.createdAt,terrenoId:(s==null?void 0:s.id)||"",terrenoCode:s==null?void 0:s.codigo,backHref:G.dashboard.terrenos.root,onChangeStatus:c,statusOptions:ss}),a.jsxs(F,{container:!0,spacing:3,children:[a.jsx(F,{size:{xs:12,md:8},children:a.jsxs(o,{sx:{gap:3,display:"flex",flexDirection:{xs:"column-reverse",md:"column"}},children:[a.jsx(ns,{title:s==null?void 0:s.titulo,area:s==null?void 0:s.area,price:s==null?void 0:s.preco,description:s==null?void 0:s.descricao}),a.jsx(us,{area:s==null?void 0:s.area,dimensions:(s==null?void 0:s.dimensoes)||((n=s==null?void 0:s.caracteristicas)==null?void 0:n.formato),topography:(t=s==null?void 0:s.caracteristicas)==null?void 0:t.topografia,access:(p=s==null?void 0:s.caracteristicas)==null?void 0:p.acesso}),a.jsx(ms,{address:(r=s==null?void 0:s.localizacao)==null?void 0:r.endereco,city:(h=s==null?void 0:s.localizacao)==null?void 0:h.cidade,state:(f=s==null?void 0:s.localizacao)==null?void 0:f.estado,zipCode:(u=s==null?void 0:s.localizacao)==null?void 0:u.cep,coordinates:(x=s==null?void 0:s.localizacao)==null?void 0:x.coordenadas})]})}),a.jsx(F,{size:{xs:12,md:4},children:a.jsxs(k,{children:[a.jsx(rs,{owner:{name:((m=s==null?void 0:s.proprietario)==null?void 0:m.nome)||"",email:((b=s==null?void 0:s.proprietario)==null?void 0:b.email)||"",phone:((g=s==null?void 0:s.proprietario)==null?void 0:g.telefone)||"",avatarUrl:((y=s==null?void 0:s.proprietario)==null?void 0:y.avatarUrl)||"",document:((T=s==null?void 0:s.proprietario)==null?void 0:T.documento)||""}}),a.jsx(q,{sx:{borderStyle:"dashed"}}),a.jsx(ps,{price:s==null?void 0:s.preco,pricePerSqm:s==null?void 0:s.precoM2,taxes:void 0,documentation:(C=s==null?void 0:s.caracteristicas)==null?void 0:C.documentacao,priceNegotiable:s==null?void 0:s.preco_negociavel,ituAnual:s==null?void 0:s.itu_anual}),a.jsx(q,{sx:{borderStyle:"dashed"}}),a.jsx(xs,{images:s==null?void 0:s.imagens})]})})]})]})}const $={title:`Detalhes do terreno | Dashboard - ${is.appName}`};function Es(){const{id:s=""}=ds(),{user:d}=as(),[l,c]=v.useState(null),[n,t]=v.useState(!0);return v.useEffect(()=>{(async()=>{var r,h,f,u,x,m,b,g,y,T,C,I,N,S;if(!d||!s){console.log("Missing requirements:",{hasUser:!!d,hasId:!!s}),t(!1);return}try{console.log("Fetching terreno data for ID:",s);const A=localStorage.getItem("currentRealEstate");if(!A){console.error("No current real estate found in localStorage");return}const L=JSON.parse(A);console.log("Current Real Estate:",L);const E=(await es.get(`${os.terreno.list}?real_estate_id=${L.id}`)).data;if(console.log("Terrenos API Response:",E),E.success&&((r=E.data)!=null&&r.terrenos)){const U=E.data.terrenos;console.log("Terrenos found:",U.length);const i=U.find(M=>M.id===s);if(console.log("Final Terreno:",i),i){const M={id:i.id||s,codigo:i.codigo||s.slice(-4).padStart(4,"0"),titulo:i.name||"Terreno",descricao:i.description||"",area:i.totalArea||i.area||0,preco:i.value||i.price||0,precoM2:i.pricePerSquareMeter||(i.value&&i.totalArea?i.value/i.totalArea:0),status:i.status||"available",tipo:i.tipo||"residencial",negociavel:i.negociavel||!1,destaque:i.destaque||!1,observacoes:i.observacoes,corretor:i.corretor,createdAt:i.createdAt||new Date().toISOString(),updatedAt:i.updatedAt||new Date().toISOString(),localizacao:{endereco:(h=i.address)!=null&&h.street&&((f=i.address)!=null&&f.number)?`${i.address.street} ${i.address.number}`.trim():((u=i.address)==null?void 0:u.street)||"",bairro:((x=i.address)==null?void 0:x.neighborhood)||"",cidade:((m=i.address)==null?void 0:m.city)||"",estado:((b=i.address)==null?void 0:b.state)||"",cep:((g=i.address)==null?void 0:g.zipCode)||"",coordenadas:i.coordinates},proprietario:{id:((y=i.owner)==null?void 0:y.id)||i.id||"",nome:((T=i.owner)==null?void 0:T.name)||"",email:((C=i.owner)==null?void 0:C.email)||"",telefone:((I=i.owner)==null?void 0:I.phone)||"",documento:((N=i.owner)==null?void 0:N.document)||"",avatarUrl:((S=i.owner)==null?void 0:S.avatarUrl)||""},caracteristicas:{area:i.totalArea||i.area||0,topografia:i.topography||"",formato:i.dimensions||"",acesso:i.access||"",documentacao:i.documentation||""},imagens:i.images||[],dimensoes:i.dimensoes,preco_negociavel:i.preco_negociavel,itu_anual:i.itu_anual};c(M)}}}catch(A){console.error("Error fetching terreno:",A)}finally{t(!1)}})()},[s,d==null?void 0:d.token]),n?a.jsxs(a.Fragment,{children:[a.jsx(R,{children:a.jsx("title",{children:$.title})}),a.jsxs("div",{style:{padding:"20px",textAlign:"center"},children:[a.jsx("h2",{children:"Carregando..."}),a.jsxs("p",{children:["ID sendo buscado: ",s]}),a.jsxs("p",{children:["Usuário autenticado: ",d?"Sim":"Não"]}),a.jsxs("p",{children:["Token disponível: ",d?"Sim":"Não"]})]})]}):l?a.jsxs(a.Fragment,{children:[a.jsx(R,{children:a.jsx("title",{children:$.title})}),a.jsx(js,{terreno:l})]}):a.jsxs(a.Fragment,{children:[a.jsx(R,{children:a.jsx("title",{children:$.title})}),a.jsxs("div",{style:{padding:"20px",textAlign:"center"},children:[a.jsx("h2",{children:"Terreno não encontrado"}),a.jsxs("p",{children:["ID buscado: ",s]}),a.jsxs("p",{children:["Usuário: ",(d==null?void 0:d.name)||"Não identificado"]}),a.jsxs("p",{children:["Token: ",d?"Disponível":"Não disponível"]}),a.jsx("button",{onClick:()=>window.location.reload(),style:{padding:"10px 20px",backgroundColor:"#007bff",color:"white",border:"none",borderRadius:"4px",cursor:"pointer"},children:"Tentar novamente"})]})]})}export{Es as default};

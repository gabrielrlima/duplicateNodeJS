import{u as I,m as f}from"./index-ChnT1xRF.js";import{cU as P,a9 as v,bk as F,r as $,a8 as E}from"./index-cNRh_qft.js";const z={revalidateIfStale:!0,revalidateOnFocus:!1,revalidateOnReconnect:!0,dedupingInterval:2e3};function C(){var p;const{currentRealEstate:e}=P(),s=e?`${v.property.list}?real_estate_id=${e.id}`:null,{data:i,isLoading:d,error:c,isValidating:o}=I(s,F,z);return $.useMemo(()=>{var l,u;return{properties:((l=i==null?void 0:i.data)==null?void 0:l.properties)||[],propertiesLoading:d,propertiesError:c,propertiesValidating:o,propertiesEmpty:!d&&!o&&(!((u=i==null?void 0:i.data)!=null&&u.properties)||i.data.properties.length===0)}},[(p=i==null?void 0:i.data)==null?void 0:p.properties,c,d,o])}async function x(e,s){try{const i=await E.put(`${v.property.update}/${e}`,{status:s});if(i.data.success){console.log("🔄 updatePropertyStatus - Sucesso! Iniciando invalidação do cache..."),console.log("📋 Dados do imóvel:",{propertyId:e,newStatus:s}),console.log("🗂️ Invalidando cache com padrões...");const d=[];f(o=>{if(typeof o=="string"){const r=o.includes("/api/property/list")||o.includes("/api/property/stats")||o.startsWith("/api/property")||o.includes("/api/property")&&o.includes("real_estate_id");return r&&(d.push(o),console.log("🔑 Invalidando chave:",o)),r}return!1}),console.log("📊 Total de chaves invalidadas:",d.length);const c=`${v.property.details}/${e}`;return console.log("🔍 Invalidando cache de detalhes:",c),f(c),console.log("🔄 Forçando revalidação global..."),f(()=>!0),console.log("🔄 Forçando revalidação com opções específicas..."),f(o=>typeof o=="string"?o.includes("/api/property"):!1,void 0,{revalidate:!0}),console.log("✅ Invalidação do cache concluída!"),i.data}throw new Error(i.data.message||"Erro ao atualizar status")}catch(i){throw console.error("Erro ao atualizar status do imóvel:",i),i}}async function K(e,s){var i,d,c,o,r,p,l,u,S,w,n;try{const a=new FormData;a.append("name",s.title||""),a.append("title",s.title||""),a.append("description",s.description||""),a.append("area",((i=s.area)==null?void 0:i.toString())||"0"),a.append("value",((d=s.value)==null?void 0:d.toString())||"0"),a.append("status",s.status||"available"),a.append("type",s.type||"residential"),a.append("purpose",s.purpose||"sale"),a.append("acceptsFinancing",((c=s.acceptsFinancing)==null?void 0:c.toString())||"false"),a.append("realEstateId",s.realEstateId||""),s.address&&(a.append("address[street]",s.address.street||""),a.append("address[number]",s.address.number||"S/N"),a.append("address[complement]",s.address.complement||""),a.append("address[neighborhood]",s.address.neighborhood||""),a.append("address[city]",s.address.city||""),a.append("address[state]",s.address.state||""),a.append("address[zipCode]",s.address.zipCode||"")),s.owner&&(a.append("owner[name]",s.owner.name||""),a.append("owner[email]",s.owner.email||""),a.append("owner[phone]",s.owner.phone||""),a.append("owner[document]",s.owner.document||"")),s.characteristics&&(a.append("bedrooms",((o=s.characteristics.bedrooms)==null?void 0:o.toString())||"0"),a.append("suites",((r=s.characteristics.suites)==null?void 0:r.toString())||"0"),a.append("bathrooms",((p=s.characteristics.bathrooms)==null?void 0:p.toString())||"0"),a.append("parkingSpaces",((l=s.characteristics.parkingSpaces)==null?void 0:l.toString())||"0"),a.append("floor",s.characteristics.floor||""),a.append("furnished",s.characteristics.furnished?"true":"false"),a.append("condition",s.characteristics.condition||"")),s.values&&(a.append("salePrice",((u=s.values.salePrice)==null?void 0:u.toString())||"0"),a.append("rentPrice",((S=s.values.rentPrice)==null?void 0:S.toString())||"0"),a.append("condominiumFee",((w=s.values.condominiumFee)==null?void 0:w.toString())||"0"),a.append("iptuValue",((n=s.values.iptuValue)==null?void 0:n.toString())||"0")),s.imagens&&s.imagens.length>0&&s.imagens.forEach((t,h)=>{t instanceof File&&a.append(`images[${h}]`,t)});const m=await E.put(`${v.property.update}/${e}`,a,{headers:{"Content-Type":"multipart/form-data"}});if(m.data.success){console.log("🔄 updateProperty - Sucesso! Iniciando invalidação do cache..."),console.log("📋 Dados do imóvel:",{propertyId:e,realEstateId:s.realEstateId}),console.log("🗂️ Invalidando cache com padrões...");const t=[];f(g=>{if(typeof g=="string"){const b=g.includes("/api/property/list")||g.includes("/api/property/stats")||g.startsWith("/api/property")||g.includes("/api/property")&&g.includes("real_estate_id");return b&&(t.push(g),console.log("🔑 Invalidando chave:",g)),b}return!1}),console.log("📊 Total de chaves invalidadas:",t.length);const h=`${v.property.details}/${e}`;return console.log("🔍 Invalidando cache de detalhes:",h),f(h),console.log("✅ Invalidação do cache concluída!"),m.data}throw new Error(m.data.message||"Erro ao atualizar imóvel")}catch(a){throw console.error("Erro ao atualizar imóvel:",a),a}}function R(e){var l;const{currentRealEstate:s}=P(),i=e&&s?`${v.property.details}/${e}?real_estate_id=${s.id}`:null,{data:d,isLoading:c,error:o,isValidating:r}=I(i,F,z);return $.useMemo(()=>{var u;return{property:(u=d==null?void 0:d.data)==null?void 0:u.property,propertyLoading:c,propertyError:o,propertyValidating:r}},[(l=d==null?void 0:d.data)==null?void 0:l.property,o,c,r])}async function T(e){var s,i,d,c,o,r,p,l,u,S,w;try{console.log("🔄 createProperty - Dados recebidos:",e);const n=new FormData;n.append("name",e.name||e.title||""),n.append("title",e.title||""),n.append("description",e.description||""),n.append("area",((s=e.area)==null?void 0:s.toString())||"0"),n.append("value",((i=e.value)==null?void 0:i.toString())||"0"),n.append("status",e.status||"available"),n.append("type",e.type||"residential"),n.append("purpose",e.purpose||"sale"),n.append("acceptsFinancing",((d=e.acceptsFinancing)==null?void 0:d.toString())||"false"),n.append("realEstateId",e.realEstateId||""),e.address&&(n.append("address[street]",e.address.street||""),n.append("address[number]",e.address.number||"S/N"),n.append("address[complement]",e.address.complement||""),n.append("address[neighborhood]",e.address.neighborhood||""),n.append("address[city]",e.address.city||""),n.append("address[state]",e.address.state||""),n.append("address[zipCode]",e.address.zipCode||"")),e.owner&&(n.append("owner[name]",e.owner.name||""),n.append("owner[email]",e.owner.email||""),n.append("owner[phone]",e.owner.phone||""),n.append("owner[document]",e.owner.document||"")),e.characteristics&&(n.append("bedrooms",((c=e.characteristics.bedrooms)==null?void 0:c.toString())||"0"),n.append("suites",((o=e.characteristics.suites)==null?void 0:o.toString())||"0"),n.append("bathrooms",((r=e.characteristics.bathrooms)==null?void 0:r.toString())||"0"),n.append("parkingSpaces",((p=e.characteristics.parkingSpaces)==null?void 0:p.toString())||"0"),n.append("floor",e.characteristics.floor||""),n.append("furnished",e.characteristics.furnished?"true":"false"),n.append("condition",e.characteristics.condition||""),n.append("constructionYear",e.characteristics.constructionYear||"")),e.values&&(n.append("salePrice",((l=e.values.salePrice)==null?void 0:l.toString())||"0"),n.append("rentPrice",((u=e.values.rentPrice)==null?void 0:u.toString())||"0"),n.append("condominiumFee",((S=e.values.condominiumFee)==null?void 0:S.toString())||"0"),n.append("iptuValue",((w=e.values.iptuValue)==null?void 0:w.toString())||"0"),n.append("acceptsExchange",e.values.acceptsExchange?"true":"false")),e.amenities&&n.append("amenities",JSON.stringify(e.amenities)),e.imagens&&e.imagens.length>0&&e.imagens.forEach((m,t)=>{m instanceof File&&n.append(`images[${t}]`,m)}),console.log("🚀 Enviando dados para API...");const a=await E.post(v.property.create,n,{headers:{"Content-Type":"multipart/form-data"}});if(a.data.success){console.log("✅ createProperty - Sucesso! Iniciando invalidação do cache..."),console.log("📋 Dados do imóvel criado:",a.data.data),console.log("🗂️ Invalidando cache com padrões...");const m=[];return f(t=>{if(typeof t=="string"){const h=t.includes("/api/property/list")||t.includes("/api/property/stats")||t.startsWith("/api/property")||t.includes("/api/property")&&t.includes("real_estate_id");return h&&(m.push(t),console.log("🔑 Invalidando chave:",t)),h}return!1}),console.log("📊 Total de chaves invalidadas:",m.length),console.log("✅ Invalidação do cache concluída!"),a.data}throw new Error(a.data.message||"Erro ao criar imóvel")}catch(n){throw console.error("❌ Erro ao criar imóvel:",n),n}}export{R as a,x as b,T as c,K as d,C as u};

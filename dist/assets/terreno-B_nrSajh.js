import{u as m,m as i}from"./index-ChnT1xRF.js";import{cU as h,a9 as l,bk as f,r as v,a8 as g}from"./index-cNRh_qft.js";const w={revalidateIfStale:!0,revalidateOnFocus:!1,revalidateOnReconnect:!0,dedupingInterval:2e3};function $(){var p;const{currentRealEstate:e}=h(),a=e?`${l.terreno.list}?real_estate_id=${e.id}`:null,{data:n,isLoading:r,error:o,isValidating:s}=m(a,f,w);return v.useMemo(()=>{var c,d;return{terrenos:((c=n==null?void 0:n.data)==null?void 0:c.terrenos)||[],terrenosLoading:r,terrenosError:o,terrenosValidating:s,terrenosEmpty:!r&&!s&&(!((d=n==null?void 0:n.data)!=null&&d.terrenos)||n.data.terrenos.length===0)}},[(p=n==null?void 0:n.data)==null?void 0:p.terrenos,o,r,s])}async function y(e,a){try{const n=await g.put(`${l.terreno.update}/${e}`,{status:a});if(n.data.success){console.log("🔄 updateTerrenoStatus - Sucesso! Iniciando invalidação do cache..."),console.log("📋 Dados do terreno:",{terrenoId:e,newStatus:a}),console.log("🗂️ Invalidando cache com padrões...");const r=[];i(s=>{if(typeof s=="string"){const t=s.includes("/api/terreno/list")||s.includes("/api/terreno/stats")||s.startsWith("/api/terreno")||s.includes("/api/terreno")&&s.includes("real_estate_id");return t&&(r.push(s),console.log("🔑 Invalidando chave:",s)),t}return!1}),console.log("📊 Total de chaves invalidadas:",r.length);const o=`${l.terreno.details}/${e}`;return console.log("🔍 Invalidando cache de detalhes:",o),i(o),console.log("🔄 Forçando revalidação global..."),i(()=>!0),console.log("🔄 Forçando revalidação com opções específicas..."),i(s=>typeof s=="string"?s.includes("/api/terreno"):!1,void 0,{revalidate:!0}),console.log("✅ Invalidação do cache concluída!"),n.data}throw new Error(n.data.message||"Erro ao atualizar status")}catch(n){throw console.error("Erro ao atualizar status do terreno:",n),n}}async function _(e,a){var n,r,o;try{const s=new FormData;s.append("name",a.title||""),s.append("title",a.title||""),s.append("description",a.description||""),s.append("totalArea",((n=a.totalArea)==null?void 0:n.toString())||"0"),s.append("value",((r=a.value)==null?void 0:r.toString())||"0"),s.append("status",a.status||"available"),s.append("type",a.type||"residential"),s.append("acceptsFinancing",((o=a.acceptsFinancing)==null?void 0:o.toString())||"false"),s.append("topography",a.topography||""),s.append("dimensoes",a.dimensions||""),s.append("accessType",a.accessType||""),s.append("hasDocumentation",a.hasDocumentation?"true":"false"),s.append("realEstateId",a.realEstateId||""),a.address&&(s.append("address[street]",a.address.street||""),s.append("address[number]",a.address.number||"S/N"),s.append("address[neighborhood]",a.address.neighborhood||""),s.append("address[city]",a.address.city||""),s.append("address[state]",a.address.state||""),s.append("address[zipCode]",a.address.zipCode||"")),a.owner&&(s.append("owner[name]",a.owner.name||""),s.append("owner[email]",a.owner.email||""),s.append("owner[phone]",a.owner.phone||""),s.append("owner[document]",a.owner.document||"")),a.imagens&&a.imagens.length>0&&a.imagens.forEach((p,c)=>{p instanceof File&&s.append(`images[${c}]`,p)});const t=await g.put(`${l.terreno.update}/${e}`,s,{headers:{"Content-Type":"multipart/form-data"}});if(t.data.success){console.log("🔄 updateTerreno - Sucesso! Iniciando invalidação do cache..."),console.log("📋 Dados do terreno:",{terrenoId:e,realEstateId:a.realEstateId}),console.log("🗂️ Invalidando cache com padrões...");const p=[];i(d=>{if(typeof d=="string"){const u=d.includes("/api/terreno/list")||d.includes("/api/terreno/stats")||d.startsWith("/api/terreno")||d.includes("/api/terreno")&&d.includes("real_estate_id");return u&&(p.push(d),console.log("🔑 Invalidando chave:",d)),u}return!1}),console.log("📊 Total de chaves invalidadas:",p.length);const c=`${l.terreno.details}/${e}`;if(console.log("🔍 Invalidando cache de detalhes:",c),i(c),a.realEstateId){const d=`${l.terreno.list}?real_estate_id=${a.realEstateId}`,u=`${l.terreno.stats}?real_estate_id=${a.realEstateId}`;console.log("📋 Invalidando cache específico da listagem:",d),console.log("📊 Invalidando cache específico de stats:",u),i(d),i(u)}if(console.log("🔄 Forçando revalidação global..."),i(()=>!0),console.log("🔄 Forçando revalidação com opções específicas..."),i(d=>typeof d=="string"?d.includes("/api/terreno"):!1,void 0,{revalidate:!0}),a.realEstateId){const d=`${l.terreno.list}?real_estate_id=${a.realEstateId}`;console.log("🔄 Forçando revalidação específica da listagem:",d),i(d,void 0,{revalidate:!0})}return console.log("✅ Invalidação do cache concluída!"),t.data}throw new Error(t.data.message||"Erro ao atualizar terreno")}catch(s){throw console.error("Erro ao atualizar terreno:",s),s}}async function T(e){var a,n,r;try{console.log("🔄 createTerreno - Dados recebidos:",e);const o=new FormData;o.append("name",e.title||""),o.append("title",e.title||""),o.append("description",e.description||""),o.append("totalArea",((a=e.totalArea)==null?void 0:a.toString())||"0"),o.append("value",((n=e.value)==null?void 0:n.toString())||"0"),o.append("status",e.status||"available"),o.append("type",e.type||"residential"),o.append("acceptsFinancing",((r=e.acceptsFinancing)==null?void 0:r.toString())||"false"),o.append("topography",e.topography||""),o.append("dimensoes",e.dimensions||""),o.append("accessType",e.accessType||""),o.append("hasDocumentation",e.hasDocumentation?"true":"false"),o.append("realEstateId",e.realEstateId||""),console.log("📤 createTerreno - FormData construído:",{name:e.title,title:e.title,totalArea:e.totalArea,value:e.value,status:e.status,type:e.type,realEstateId:e.realEstateId}),e.address&&(o.append("address[street]",e.address.street||""),o.append("address[number]",e.address.number||"S/N"),o.append("address[neighborhood]",e.address.neighborhood||""),o.append("address[city]",e.address.city||""),o.append("address[state]",e.address.state||""),o.append("address[zipCode]",e.address.zipCode||"")),e.owner&&(o.append("owner[name]",e.owner.name||""),o.append("owner[email]",e.owner.email||""),o.append("owner[phone]",e.owner.phone||""),o.append("owner[document]",e.owner.document||"")),e.imagens&&e.imagens.length>0&&e.imagens.forEach((t,p)=>{t instanceof File&&o.append(`images[${p}]`,t)});const s=await g.post(l.terreno.create,o,{headers:{"Content-Type":"multipart/form-data"}});if(s.data.success)return i(t=>typeof t=="string"?t.includes("/api/terreno/list")||t.includes("/api/terreno/stats")||t.startsWith("/api/terreno")||t.includes("/api/terreno")&&t.includes("real_estate_id"):!1),e.realEstateId&&(i(`${l.terreno.list}?real_estate_id=${e.realEstateId}`),i(`${l.terreno.stats}?real_estate_id=${e.realEstateId}`)),i(()=>!0),s.data;throw new Error(s.data.message||"Erro ao criar terreno")}catch(o){throw console.error("Erro ao criar terreno:",o),o}}export{$ as a,_ as b,T as c,y as u};

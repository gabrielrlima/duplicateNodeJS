import{Y as W,b0 as ae,j as e,S as f,B as o,a$ as N,aP as _,a1 as $,I as h,bX as se,aj as Q,b1 as te,b2 as oe,b3 as v,D as O,R as V,f as z,cN as w,r as b,au as le,a0 as re,dL as H,bc as R,aK as G,bd as ie,dO as ne,eG as de,cV as U,T as q,bj as ce,p as k,l as xe,U as pe,n as ue,bp as he,dQ as me,H as ge,C as be}from"./index-cNRh_qft.js";import{u as je,a as fe}from"./terreno-B_nrSajh.js";import{u as ve,g as ye,r as Ce,e as Te,T as De}from"./table-no-data-CeEeU6Ls.js";import{T as Se}from"./table-empty-rows-BTCIE_YQ.js";import{T as Pe}from"./table-head-custom-DSpcVu4-.js";import{T as ke}from"./table-pagination-custom-xTp1jojO.js";import{C as Re}from"./confirm-dialog-V5NQjZtL.js";import{T as K,a as Ie,b as we}from"./TableHead-DBnjkyMB.js";import{T as y}from"./TableCell-CGwO8Re3.js";import{C as ze}from"./Card-C_-31fGp.js";import"./terreno-wizard-form-CdhYBVNp.js";import"./index-ChnT1xRF.js";import"./index-BDJJM9HW.js";import"./empty-content-BzM3Az2z.js";import"./TablePagination-CNNZgEcm.js";import"./LastPage-ChYIEhQh.js";import"./Toolbar-BaRJzfzK.js";import"./Grid-BAAHJ7js.js";function Ae({row:a,onDeleteRow:d,detailsHref:r,onUpdateStatus:u}){const i=W(),t=ae(),n=W(),c=async g=>{try{const C={disponivel:"available",reservado:"reserved",vendido:"sold",suspenso:"inactive"};await je(a.id,C[g]||g),w.success("Status atualizado com sucesso!"),u==null||u(g),t.onClose()}catch(C){console.error("Erro ao atualizar status:",C),w.error("Erro ao atualizar status do terreno")}},m=()=>e.jsxs(K,{hover:!0,children:[e.jsx(y,{children:e.jsxs(f,{sx:{typography:"body2",alignItems:"flex-start"},children:[e.jsx(o,{component:"span",sx:{fontWeight:"fontWeightMedium"},children:a.titulo}),e.jsxs(o,{component:"span",sx:{color:"text.disabled"},children:[a.localizacao.bairro,", ",a.localizacao.cidade]})]})}),e.jsx(y,{children:e.jsx(o,{sx:{typography:"body2"},children:a.corretor||"Sem corretor"})}),e.jsxs(y,{align:"center",children:[e.jsxs(o,{sx:{typography:"body2"},children:[a.area.toLocaleString("pt-BR")," m²"]}),e.jsxs(o,{sx:{typography:"caption",color:"text.disabled"},children:[N(a.precoM2),"/m²"]})]}),e.jsxs(y,{children:[e.jsx(o,{sx:{typography:"body2",fontWeight:"fontWeightMedium"},children:N(a.preco)}),a.negociavel&&e.jsx(o,{sx:{typography:"caption",color:"warning.main"},children:"Negociável"})]}),e.jsx(y,{children:e.jsxs(_,{variant:"soft",color:a.status==="available"&&"success"||a.status==="reserved"&&"warning"||a.status==="sold"&&"info"||a.status==="inactive"&&"default"||"default",children:[a.status==="available"&&"Disponível",a.status==="reserved"&&"Reservado",a.status==="sold"&&"Vendido",a.status==="inactive"&&"Inativo"]})}),e.jsxs(y,{align:"right",sx:{px:1,whiteSpace:"nowrap"},children:[e.jsx($,{color:n.value?"inherit":"default",onClick:n.onToggle,sx:{...n.value&&{bgcolor:"action.hover"}},children:e.jsx(h,{icon:"eva:arrow-ios-downward-fill"})}),e.jsx($,{color:t.open?"inherit":"default",onClick:t.onOpen,children:e.jsx(h,{icon:"eva:more-vertical-fill"})})]})]}),x=()=>e.jsx(K,{children:e.jsx(y,{sx:{p:0,border:"none"},colSpan:6,children:e.jsx(se,{in:n.value,timeout:"auto",unmountOnExit:!0,sx:{bgcolor:"background.neutral"},children:e.jsx(Q,{sx:{m:1.5},children:e.jsxs(o,{sx:g=>({display:"flex",alignItems:"flex-start",p:g.spacing(2),gap:2}),children:[a.imagens&&a.imagens.length>0&&a.imagens[0]?e.jsx(o,{component:"img",src:a.imagens[0],alt:a.titulo,sx:{width:120,height:80,borderRadius:1,objectFit:"cover",flexShrink:0}}):e.jsxs(o,{sx:{width:120,height:80,borderRadius:1,flexShrink:0,display:"flex",alignItems:"center",justifyContent:"center",flexDirection:"column",bgcolor:"background.neutral",border:"1px dashed",borderColor:"divider",gap:.5},children:[e.jsx(h,{icon:"solar:image-bold",width:24,sx:{color:"text.disabled"}}),e.jsx(o,{sx:{typography:"caption",color:"text.disabled"},children:"Sem imagem"})]}),e.jsxs(f,{sx:{flex:1},spacing:1.5,children:[e.jsx(o,{children:e.jsx(o,{sx:{typography:"subtitle2",mb:.5},children:a.titulo})}),e.jsxs(f,{spacing:1.5,children:[e.jsx(o,{sx:{display:"grid",gridTemplateColumns:{xs:"1fr",sm:"1fr 1fr"},gap:2},children:e.jsxs(o,{children:[e.jsxs(o,{sx:{typography:"caption",color:"text.disabled",mb:.5,display:"flex",alignItems:"center",gap:.5,textTransform:"uppercase",letterSpacing:.5},children:[e.jsx(h,{icon:"eva:pin-fill",width:12}),"Localização"]}),e.jsxs(o,{sx:{display:"flex",flexWrap:"wrap",gap:1,alignItems:"center"},children:[e.jsx(o,{sx:{typography:"body2",fontWeight:500},children:a.localizacao.endereco}),e.jsxs(o,{sx:{typography:"body2",color:"text.secondary"},children:[a.localizacao.bairro," • ",a.localizacao.cidade," • ",a.localizacao.estado]}),e.jsx(o,{sx:{typography:"caption",color:"text.disabled"},children:a.localizacao.cep})]})]})}),a.descricao&&e.jsxs(o,{children:[e.jsxs(o,{sx:{typography:"caption",color:"text.disabled",mb:.5,display:"flex",alignItems:"center",gap:.5,textTransform:"uppercase",letterSpacing:.5},children:[e.jsx(h,{icon:"solar:document-text-bold",width:12}),"Descrição"]}),e.jsx(o,{sx:{typography:"body2",color:"text.secondary",fontStyle:"italic",p:1,bgcolor:"background.neutral",borderRadius:1},children:a.descricao})]})]})]})]})})})})}),p=()=>e.jsx(te,{open:t.open,anchorEl:t.anchorEl,onClose:t.onClose,slotProps:{arrow:{placement:"right-top"}},children:e.jsxs(oe,{children:[e.jsxs(v,{onClick:a.status==="available"?void 0:()=>c("available"),disabled:a.status==="available",children:[e.jsx(h,{icon:"solar:check-circle-bold",sx:{color:"success.main"}}),"Marcar como Disponível"]}),e.jsxs(v,{onClick:a.status==="reserved"?void 0:()=>c("reservado"),disabled:a.status==="reserved",children:[e.jsx(h,{icon:"solar:clock-circle-bold",sx:{color:"warning.main"}}),"Marcar como Reservado"]}),e.jsxs(v,{onClick:a.status==="sold"?void 0:()=>c("vendido"),disabled:a.status==="sold",children:[e.jsx(h,{icon:"solar:dollar-minimalistic-bold",sx:{color:"info.main"}}),"Marcar como Vendido"]}),e.jsxs(v,{onClick:a.status==="inactive"?void 0:()=>c("suspenso"),disabled:a.status==="inactive",children:[e.jsx(h,{icon:"solar:pause-circle-bold",sx:{color:"text.disabled"}}),"Marcar como Inativo"]}),e.jsx(O,{sx:{my:1}}),e.jsx("li",{children:e.jsxs(v,{component:V,href:r,onClick:()=>t.onClose(),children:[e.jsx(h,{icon:"solar:eye-bold"}),"Visualizar"]})}),e.jsx("li",{children:e.jsxs(v,{component:V,href:`${r}/edit`,onClick:()=>t.onClose(),children:[e.jsx(h,{icon:"solar:pen-bold"}),"Editar"]})}),e.jsx(O,{sx:{my:1}}),e.jsxs(v,{onClick:()=>{i.onTrue(),t.onClose()},sx:{color:"error.main"},children:[e.jsx(h,{icon:"solar:trash-bin-trash-bold"}),"Remover"]})]})}),j=()=>e.jsx(Re,{open:i.value,onClose:i.onFalse,title:"Remover terreno",content:"Tem certeza que deseja remover este terreno?",action:e.jsx(z,{variant:"contained",color:"error",onClick:d,children:"Remover"})});return e.jsxs(e.Fragment,{children:[m(),x(),p(),j()]})}function Ee({filters:a,onResetPage:d,dateError:r}){const{state:u,setState:i}=a,t=b.useCallback(m=>{d(),i({name:m.target.value})},[d,i]),n=b.useCallback(m=>{d(),i({startDate:m})},[d,i]),c=b.useCallback(m=>{d(),i({endDate:m})},[d,i]);return e.jsx(f,{spacing:2,alignItems:{xs:"flex-end",md:"center"},direction:{xs:"column",md:"row"},sx:{p:2.5,pr:{xs:2.5,md:1}},children:e.jsxs(f,{direction:"row",alignItems:"center",spacing:2,flexGrow:1,sx:{width:1},children:[e.jsx(le,{fullWidth:!0,value:u.name,onChange:t,placeholder:"Buscar terreno...",InputProps:{startAdornment:e.jsx(re,{position:"start",children:e.jsx(h,{icon:"eva:search-fill",sx:{color:"text.disabled"}})})}}),e.jsx(H,{label:"Data inicial",value:u.startDate,onChange:n,slotProps:{textField:{fullWidth:!0}},sx:{maxWidth:{md:200}}}),e.jsx(H,{label:"Data final",value:u.endDate,onChange:c,slotProps:{textField:{fullWidth:!0,error:r,helperText:r?"A data final deve ser posterior à data inicial":null}},sx:{maxWidth:{md:200}}})]})})}function Fe({filters:a,totalResults:d,onResetPage:r,sx:u,...i}){const{state:t,setState:n}=a,c=b.useCallback(()=>{r(),n({name:""})},[r,n]),m=b.useCallback(()=>{r(),n({status:"all"})},[r,n]),x=b.useCallback(()=>{r(),n({startDate:null,endDate:null})},[r,n]),p=b.useCallback(()=>{r(),n({name:"",status:"all",startDate:null,endDate:null})},[r,n]);return e.jsxs(f,{spacing:1.5,sx:u,...i,children:[e.jsxs(o,{sx:{typography:"body2"},children:[e.jsx("strong",{children:d}),e.jsx(o,{component:"span",sx:{color:"text.secondary",ml:.25},children:"resultados encontrados"})]}),e.jsxs(f,{flexGrow:1,spacing:1,direction:"row",flexWrap:"wrap",alignItems:"center",children:[!!t.name&&e.jsx(I,{label:"Busca:",children:e.jsx(R,{size:"small",label:t.name,onDelete:c})}),t.status!=="all"&&e.jsx(I,{label:"Status:",children:e.jsx(R,{size:"small",label:t.status==="available"?"Disponível":t.status==="reserved"?"Reservado":t.status==="sold"?"Vendido":t.status==="inactive"?"Pausado":t.status,onDelete:m})}),!!t.startDate&&!!t.endDate&&e.jsx(I,{label:"Data:",children:e.jsx(R,{size:"small",label:`${G(t.startDate)} - ${G(t.endDate)}`,onDelete:x})}),e.jsx(z,{color:"error",onClick:p,startIcon:e.jsx(h,{icon:"solar:trash-bin-trash-bold"}),children:"Limpar"})]})]})}function I({label:a,children:d,sx:r,...u}){return e.jsxs(f,{component:Q,variant:"outlined",spacing:1,direction:"row",sx:[{p:1,borderRadius:1,overflow:"hidden",borderStyle:"dashed"},...Array.isArray(r)?r:[r]],...u,children:[e.jsx(o,{component:"span",sx:{typography:"subtitle2"},children:a}),e.jsx(f,{spacing:1,direction:"row",flexWrap:"wrap",children:d})]})}const Me=[{value:"all",label:"Todos"},{value:"available",label:"Disponível"},{value:"reserved",label:"Reservado"},{value:"sold",label:"Vendido"},{value:"inactive",label:"Inativo"}],Be=[{id:"titulo",label:"Terreno"},{id:"corretor",label:"Corretor",width:140},{id:"area",label:"Área (m²)",width:120,align:"center"},{id:"preco",label:"Preço",width:140},{id:"status",label:"Status",width:110},{id:"",width:88}];function Le(){const a=ve({defaultOrderBy:"titulo"}),{terrenos:d,terrenosLoading:r,terrenosError:u}=fe(),[i,t]=b.useState([]);b.useEffect(()=>{if(d&&d.length>0){const l=d.map((s,D)=>{var S,P,T,A,E,F,M,B,L;return{id:s.id,codigo:`TER-${(s.id||`${D}`).toString().slice(-4).padStart(4,"0")}`,titulo:s.name||s.title||"Terreno sem título",descricao:s.description||s.terrainDescription||"Sem descrição",area:s.totalArea||0,preco:s.value||s.salePrice||0,precoM2:s.pricePerSquareMeter||(s.value&&s.totalArea?Math.round(s.value/s.totalArea):0),status:s.status||"available",tipo:s.type==="residential"?"residencial":s.type==="commercial"?"comercial":s.type==="industrial"?"industrial":"rural",createdAt:s.createdAt,updatedAt:s.updatedAt,localizacao:{endereco:typeof s.address=="string"?s.address:typeof s.address=="object"&&s.address&&`${s.address.street||""} ${s.address.number||""}`.trim()||"Endereço não informado",bairro:s.neighborhood||((S=s.address)==null?void 0:S.neighborhood)||"Bairro não informado",cidade:s.city||((P=s.address)==null?void 0:P.city)||"Cidade não informada",estado:s.state||((T=s.address)==null?void 0:T.state)||"Estado não informado",cep:s.cep||s.zipCode||((A=s.address)==null?void 0:A.zipCode)||"CEP não informado",coordenadas:s.latitude&&s.longitude?{lat:s.latitude,lng:s.longitude}:void 0},proprietario:{id:s.ownerId||"",nome:((E=s.owner)==null?void 0:E.name)||"Proprietário não informado",email:((F=s.owner)==null?void 0:F.email)||"",telefone:((M=s.owner)==null?void 0:M.phone)||"",avatarUrl:((B=s.owner)==null?void 0:B.avatarUrl)||"",documento:((L=s.owner)==null?void 0:L.document)||""},caracteristicas:{area:s.totalArea||0,formato:"Não informado",topografia:s.topography==="flat"?"plano":s.topography==="sloped"?"aclive":s.topography==="irregular"?"irregular":s.topography||"plano",acesso:s.accessType==="paved"?"asfalto":s.accessType==="dirt"?"terra":s.accessType||"asfalto",documentacao:s.hasDocumentation?"Completa":"Incompleta"},imagens:s.images||[],destaque:s.highlightProperty||!1,negociavel:s.acceptsFinancing||!1,observacoes:s.description||"",corretor:s.broker?s.broker:"Sem corretor"}});t(l)}else!r&&(!d||d.length===0)&&t([])},[d,r]);const n=ie({name:"",status:"all",startDate:null,endDate:null}),{state:c,setState:m}=n,x=ne(c.startDate,c.endDate),p=We({inputData:i,comparator:ye(a.order,a.orderBy),filters:c,dateError:x}),j=Ce(p,a.page,a.rowsPerPage),g=!!c.name||c.status!=="all"||!!c.startDate&&!!c.endDate,C=i.length===0&&!r&&!u,X=!p.length&&g,Y=C||X,J=b.useCallback(l=>{const s=i.filter(D=>D.id!==l);w.success("Terreno removido com sucesso!"),t(s),a.onUpdatePageDeleteRow(j.length)},[j.length,a,i]),Z=b.useCallback((l,s)=>{const S={disponivel:"available",reservado:"reserved",vendido:"sold",suspenso:"inactive"}[s]||s,P=i.map(T=>T.id===l?{...T,status:S}:T);t(P)},[i]),ee=b.useCallback((l,s)=>{a.onResetPage(),m({status:s})},[m,a]);return r?e.jsx(de,{}):u?e.jsx(U,{children:e.jsxs(o,{sx:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",minHeight:400,textAlign:"center"},children:[e.jsx(h,{icon:"eva:alert-triangle-fill",sx:{width:64,height:64,color:"error.main",mb:2}}),e.jsx(q,{variant:"h6",sx:{mb:1},children:"Erro ao carregar terrenos"}),e.jsx(q,{variant:"body2",color:"text.secondary",children:u.message||"Ocorreu um erro inesperado"})]})}):e.jsx(e.Fragment,{children:e.jsxs(U,{children:[e.jsxs(f,{direction:{xs:"column",sm:"row"},alignItems:{xs:"flex-start",sm:"center"},justifyContent:"space-between",spacing:{xs:2,sm:0},sx:{mb:{xs:3,md:5}},children:[e.jsx(ce,{heading:"Todos os terrenos",links:[{name:"Dashboard",href:k.dashboard.root},{name:"Terrenos",href:k.dashboard.terrenos.root},{name:"Lista de terrenos"}],sx:{".MuiTypography-h4":{fontSize:{xs:"1.25rem",md:"1.5rem"}}}}),e.jsx(z,{variant:"contained",startIcon:e.jsx(h,{icon:"eva:plus-fill"}),href:k.dashboard.terrenos.new,sx:{fontSize:{xs:"0.875rem",md:"1rem"},width:{xs:"100%",sm:"auto"}},children:"Novo terreno"})]}),e.jsxs(ze,{children:[e.jsx(xe,{value:c.status,onChange:ee,sx:[l=>({px:2.5,boxShadow:`inset 0 -2px 0 0 ${pe(l.vars.palette.grey["500Channel"],.08)}`})],children:Me.map(l=>e.jsx(ue,{iconPosition:"end",value:l.value,label:l.label,icon:e.jsx(_,{variant:(l.value==="all"||l.value===c.status)&&"filled"||"soft",color:l.value==="available"&&"success"||l.value==="reserved"&&"warning"||l.value==="sold"&&"info"||l.value==="inactive"&&"error"||"default",children:l.value==="all"?i.length:i.filter(s=>s.status===l.value).length})},l.value))}),e.jsx(Ee,{filters:n,onResetPage:a.onResetPage,dateError:x}),g&&e.jsx(Fe,{filters:n,totalResults:p.length,onResetPage:a.onResetPage,sx:{p:2.5,pt:0}}),e.jsx(o,{sx:{position:"relative"},children:e.jsx(he,{sx:{minHeight:444},children:e.jsxs(Ie,{size:a.dense?"small":"medium",sx:{minWidth:960},children:[e.jsx(Pe,{order:a.order,orderBy:a.orderBy,headCells:Be,rowCount:p.length,numSelected:0,onSort:a.onSort}),e.jsxs(we,{children:[p.slice(a.page*a.rowsPerPage,a.page*a.rowsPerPage+a.rowsPerPage).map(l=>e.jsx(Ae,{row:l,onDeleteRow:()=>J(l.id),onUpdateStatus:s=>Z(l.id,s),detailsHref:k.dashboard.terrenos.details(l.id)},l.id)),e.jsx(Se,{height:a.dense?56:76,emptyRows:Te(a.page,a.rowsPerPage,p.length)}),e.jsx(De,{notFound:Y,title:C?"Nenhum terreno registrado":"Nenhum resultado encontrado"})]})]})})}),e.jsx(ke,{page:a.page,dense:a.dense,count:p.length,rowsPerPage:a.rowsPerPage,onPageChange:a.onChangePage,onChangeDense:a.onChangeDense,onRowsPerPageChange:a.onChangeRowsPerPage})]})]})})}function We({inputData:a,comparator:d,filters:r,dateError:u}){const{status:i,name:t,startDate:n,endDate:c}=r,m=a.map((x,p)=>[x,p]);return m.sort((x,p)=>{const j=d(x[0],p[0]);return j!==0?j:x[1]-p[1]}),a=m.map(x=>x[0]),t&&(a=a.filter(({codigo:x,titulo:p,proprietario:j})=>[x,p,j.nome,j.email].some(g=>g==null?void 0:g.toLowerCase().includes(t.toLowerCase())))),i!=="all"&&(a=a.filter(x=>x.status===i)),u||n&&c&&(a=a.filter(x=>me(x.createdAt,n,c))),a}const Ne={title:`Lista de terrenos | Dashboard - ${be.appName}`};function oa(){return e.jsxs(e.Fragment,{children:[e.jsx(ge,{children:e.jsxs("title",{children:[" ",Ne.title]})}),e.jsx(Le,{})]})}export{oa as default};

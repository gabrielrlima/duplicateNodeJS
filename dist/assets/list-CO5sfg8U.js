import{V as $,Y as H,b0 as O,j as e,B as l,A as W,aJ as q,L as G,aK as U,df as K,aB as _,aP as N,a_ as J,a1 as Y,I as u,b1 as Q,b2 as X,b3 as P,f as A,r as b,S as w,au as Z,a0 as ee,cT as v,a$ as R,aA as se,T as j,G as k,bc as S,bd as te,cN as B,cV as ae,bj as oe,p as f,R as re,l as ne,U as le,n as ie,bp as ce,H as de,C as xe}from"./index-cNRh_qft.js";import{u as me}from"./use-corretores-B0nlkCck.js";import{E as F}from"./empty-content-BzM3Az2z.js";import{u as he,g as ue,r as pe,e as je,T as ge}from"./table-no-data-CeEeU6Ls.js";import{T as be}from"./table-empty-rows-BTCIE_YQ.js";import{T as ve}from"./table-head-custom-DSpcVu4-.js";import{T as fe}from"./table-pagination-custom-xTp1jojO.js";import{C as ye}from"./confirm-dialog-V5NQjZtL.js";import{T as Ce,a as Te,b as Pe}from"./TableHead-DBnjkyMB.js";import{T as g}from"./TableCell-CGwO8Re3.js";import{s as L}from"./sumBy-ofy1HSRF.js";import{C as I}from"./Card-C_-31fGp.js";import{F as Re,a as D,c as E}from"./filters-result-BTXXEhsP.js";import"./TablePagination-CNNZgEcm.js";import"./LastPage-ChYIEhQh.js";import"./Toolbar-BaRJzfzK.js";function Fe({row:s,onDeleteRow:c,editHref:n,detailsHref:a}){const o=$(),i=H(),t=O(),h=()=>{o.push(a)},x=e.jsxs(Ce,{hover:!0,onClick:h,sx:{cursor:"pointer"},children:[e.jsx(g,{children:e.jsxs(l,{sx:{display:"flex",alignItems:"center"},children:[e.jsx(W,{alt:s.name,sx:{mr:2,width:40,height:40},children:s.name.split(" ").map(m=>m.charAt(0)).join("").toUpperCase().slice(0,2)}),e.jsx(q,{primary:e.jsx(G,{color:"inherit",sx:{cursor:"pointer"},children:s.name}),secondary:e.jsx(l,{component:"span",sx:{typography:"caption",color:"text.disabled"},children:s.creci}),slotProps:{primary:{noWrap:!0,sx:{typography:"body2"}},secondary:{sx:{color:"text.disabled","&:hover":{color:"text.secondary"}}}}})]})}),e.jsx(g,{children:e.jsx(l,{sx:{typography:"body2"},children:s.email})}),e.jsx(g,{children:e.jsx(l,{sx:{typography:"body2"},children:s.phone})}),e.jsx(g,{children:s.lastActivity?e.jsxs(l,{children:[e.jsx(l,{sx:{typography:"body2"},children:U(s.lastActivity)}),e.jsx(l,{sx:{typography:"caption",color:"text.disabled"},children:K(s.lastActivity)})]}):e.jsx(l,{sx:{typography:"body2",color:"text.disabled"},children:"-"})}),e.jsx(g,{align:"center",children:e.jsxs(l,{sx:{display:"flex",alignItems:"center",justifyContent:"center"},children:[e.jsxs(l,{sx:{minWidth:35,mr:1},children:[e.jsx(l,{sx:{typography:"body2",fontWeight:"bold"},children:s.vendas}),s.meta&&e.jsxs(l,{sx:{typography:"caption",color:"text.disabled"},children:["/",s.meta]})]}),s.performance&&e.jsxs(l,{sx:{width:60},children:[e.jsx(_,{variant:"determinate",value:s.performance,color:s.performance>=80&&"success"||s.performance>=60&&"warning"||"error",sx:{height:6,borderRadius:1}}),e.jsxs(l,{sx:{typography:"caption",textAlign:"center",mt:.5},children:[s.performance,"%"]})]})]})}),e.jsx(g,{children:e.jsxs(N,{variant:"soft",color:s.status==="ativo"&&"success"||s.status==="ferias"&&"warning"||s.status==="inativo"&&"error"||"default",children:[s.status==="ativo"&&"Ativo",s.status==="ferias"&&"Férias",s.status==="inativo"&&"Inativo"]})}),e.jsx(g,{align:"right",sx:{px:1,whiteSpace:"nowrap"},children:e.jsx(J,{title:"Ações",placement:"top",arrow:!0,children:e.jsx(Y,{color:t.open?"inherit":"default",onClick:m=>{m.stopPropagation(),t.onOpen(m)},children:e.jsx(u,{icon:"eva:more-vertical-fill"})})})})]});return e.jsxs(e.Fragment,{children:[x,e.jsx(Q,{open:t.open,anchorEl:t.anchorEl,onClose:t.onClose,slotProps:{arrow:{placement:"right-top"}},children:e.jsxs(X,{children:[e.jsxs(P,{onClick:()=>{t.onClose(),o.push(a)},children:[e.jsx(u,{icon:"solar:eye-bold"}),"Visualizar"]}),e.jsxs(P,{onClick:()=>{t.onClose(),o.push(n)},children:[e.jsx(u,{icon:"solar:pen-bold"}),"Editar"]}),e.jsxs(P,{onClick:()=>{i.onTrue(),t.onClose()},sx:{color:"error.main"},children:[e.jsx(u,{icon:"solar:trash-bin-trash-bold"}),"Remover"]})]})}),e.jsx(ye,{open:i.value,onClose:i.onFalse,title:"Remover corretor",content:`Tem certeza que deseja remover o corretor ${s.name}?`,action:e.jsx(A,{variant:"contained",color:"error",onClick:()=>{c(),i.onFalse()},children:"Remover"})})]})}function Ae({filters:s,onResetPage:c}){const{state:n,setState:a}=s,o=b.useCallback(i=>{c(),a({name:i.target.value})},[c,a]);return e.jsx(w,{spacing:2,alignItems:{xs:"flex-end",md:"center"},direction:{xs:"column",md:"row"},sx:{p:2.5,pr:{xs:2.5,md:1}},children:e.jsx(Z,{fullWidth:!0,value:n.name,onChange:o,placeholder:"Buscar corretor por nome ou email...",InputProps:{startAdornment:e.jsx(ee,{position:"start",children:e.jsx(u,{icon:"eva:search-fill",sx:{color:"text.disabled"}})})}})})}function we({corretores:s,sx:c,...n}){const a=s.length,o=s.filter(d=>d.status==="ativo").length,i=L(s,d=>d.comissaoTotal),t=L(s,d=>d.vendas),h=a>0?i/a:0,x=a>0?t/a:0,m=s.reduce((d,p)=>d.comissaoTotal>p.comissaoTotal?d:p,s[0]||{}),y=[{title:"Comissão Total",value:R(i),icon:"solar:dollar-minimalistic-bold-duotone",subtitle:`${v(a)} corretores`},{title:"Total de Vendas",value:v(t),icon:"solar:chart-square-bold-duotone",subtitle:`Média: ${v(x)} por corretor`},{title:"Comissão Média",value:R(h),icon:"solar:pie-chart-2-bold-duotone",subtitle:"Por corretor"},{title:"Corretores Ativos",value:v(o),icon:"solar:users-group-rounded-bold-duotone",subtitle:`${se(o/a*100)} do total`}];return e.jsxs(w,{spacing:3,sx:c,...n,children:[e.jsxs(l,{children:[e.jsx(j,{variant:"h6",sx:{mb:1},children:"Resumo de Comissões"}),e.jsx(j,{variant:"body2",sx:{color:"text.secondary"},children:"Visão geral do desempenho da equipe de corretores"})]}),e.jsx(k,{container:!0,spacing:3,children:y.map((d,p)=>e.jsx(k,{size:{xs:12,sm:6,md:3},children:e.jsxs(I,{sx:{p:3},children:[e.jsx(l,{sx:{display:"flex",alignItems:"center",mb:2,color:"text.secondary"},children:e.jsx(u,{icon:d.icon,width:24,sx:{mr:1}})}),e.jsx(j,{variant:"h4",sx:{mb:.5},children:d.value}),e.jsx(j,{variant:"subtitle2",sx:{mb:1,color:"text.primary"},children:d.title}),e.jsx(j,{variant:"caption",sx:{color:"text.secondary"},children:d.subtitle})]})},p))}),(m==null?void 0:m.name)&&e.jsx(I,{sx:{p:3},children:e.jsxs(w,{direction:"row",alignItems:"center",spacing:2,children:[e.jsx(l,{sx:{display:"flex",alignItems:"center",color:"warning.main"},children:e.jsx(u,{icon:"solar:crown-star-bold-duotone",width:24})}),e.jsxs(l,{sx:{flexGrow:1},children:[e.jsx(j,{variant:"subtitle2",sx:{mb:.5},children:"🏆 Top Performer"}),e.jsxs(j,{variant:"body2",sx:{color:"text.secondary"},children:[e.jsx("strong",{children:m.name})," • ",R(m.comissaoTotal)," em comissões • ",v(m.vendas)," vendas"]})]})]})})]})}function Ie({filters:s,totalResults:c,onResetPage:n}){const{state:a,setState:o}=s,i=b.useCallback(()=>{n(),o({name:""})},[n,o]),t=b.useCallback(()=>{n(),o({status:"all"})},[n,o]),h=b.useCallback(()=>{n(),o({name:"",status:"all",startDate:null,endDate:null})},[n,o]);return e.jsxs(Re,{totalResults:c,onReset:h,sx:{p:2.5,pt:0},children:[e.jsx(D,{label:"Status:",isShow:a.status!=="all",children:e.jsx(S,{...E,label:a.status==="ativo"&&"Ativo"||a.status==="ferias"&&"Férias"||a.status==="inativo"&&"Inativo"||a.status,onDelete:t,sx:{textTransform:"capitalize"}})}),e.jsx(D,{label:"Palavra-chave:",isShow:!!a.name,children:e.jsx(S,{...E,label:a.name,onDelete:i})})]})}const ke=[{id:"name",label:"Nome"},{id:"email",label:"Email"},{id:"phone",label:"Telefone"},{id:"lastActivity",label:"Última Atividade"},{id:"vendas",label:"Vendas",align:"center"},{id:"status",label:"Status"},{id:"actions"}];function Se(){const s=he({defaultOrderBy:"name"}),{corretores:c,loading:n,error:a,deleteCorretor:o}=me(),i=te({name:"",status:"all",startDate:null,endDate:null}),{state:t,setState:h}=i,x=Be({inputData:c,comparator:ue(s.order,s.orderBy),filters:t}),m=pe(x,s.page,s.rowsPerPage),y=!!t.name||t.status!=="all",d=!x.length&&y||!x.length,p=!n&&!a&&!c.length,C=r=>c.filter(T=>T.status===r).length,V=[{value:"all",label:"Todos",color:"default",count:c.length},{value:"ativo",label:"Ativo",color:"success",count:C("ativo")},{value:"inativo",label:"Inativo",color:"error",count:C("inativo")},{value:"ferias",label:"Férias",color:"warning",count:C("ferias")}],z=b.useCallback(async r=>{try{await o(r),B.success("Corretor removido com sucesso"),s.onUpdatePageDeleteRow(m.length)}catch{B.error("Erro ao remover corretor")}},[m.length,s,o]),M=b.useCallback((r,T)=>{s.onResetPage(),h({status:T})},[s,h]);return e.jsxs(ae,{children:[e.jsx(oe,{heading:"Corretores",links:[{name:"Dashboard",href:f.dashboard.root},{name:"Corretores",href:f.dashboard.order.root},{name:"Lista"}],action:e.jsx(A,{component:re,href:f.dashboard.corretores.new,variant:"contained",startIcon:e.jsx(u,{icon:"mingcute:add-line"}),children:"Novo corretor"}),sx:{mb:{xs:3,md:5}}}),n&&e.jsx(F,{title:"Carregando corretores...",description:"Aguarde enquanto buscamos os dados",sx:{py:10}}),a&&e.jsx(F,{filled:!0,title:"Erro ao carregar corretores",description:a,action:e.jsx(A,{variant:"contained",onClick:()=>window.location.reload(),startIcon:e.jsx(u,{icon:"eva:refresh-fill"}),children:"Tentar novamente"}),sx:{py:10}}),!n&&!a&&e.jsx(we,{corretores:c,sx:{mb:3}}),p&&e.jsx(F,{filled:!0,title:"Nenhum corretor registrado",description:"Não há corretores cadastrados no sistema ainda",sx:{py:10}}),!n&&!a&&!p&&e.jsxs(I,{children:[e.jsx(ne,{value:t.status,onChange:M,sx:{px:2.5,boxShadow:r=>`inset 0 -2px 0 0 ${le(r.vars.palette.grey["500Channel"],.08)}`},children:V.map(r=>e.jsx(ie,{iconPosition:"end",value:r.value,label:r.label,icon:e.jsx(N,{variant:(r.value==="all"||r.value===t.status)&&"filled"||"soft",color:r.color,children:r.count})},r.value))}),e.jsx(Ae,{filters:i,onResetPage:s.onResetPage}),y&&e.jsx(Ie,{filters:i,totalResults:x.length,onResetPage:s.onResetPage}),e.jsx(l,{sx:{position:"relative"},children:e.jsx(ce,{children:e.jsxs(Te,{size:s.dense?"small":"medium",sx:{minWidth:800},children:[e.jsx(ve,{order:s.order,orderBy:s.orderBy,headCells:ke,onSort:s.onSort}),e.jsxs(Pe,{children:[x.slice(s.page*s.rowsPerPage,s.page*s.rowsPerPage+s.rowsPerPage).map(r=>e.jsx(Fe,{row:r,onDeleteRow:()=>z(r.id),editHref:f.dashboard.corretores.edit(r.id),detailsHref:f.dashboard.corretores.details(r.id)},r.id)),e.jsx(be,{height:s.dense?56:76,emptyRows:je(s.page,s.rowsPerPage,x.length)}),e.jsx(ge,{notFound:d,title:"Nenhum corretor encontrado"})]})]})})}),e.jsx(fe,{page:s.page,dense:s.dense,count:x.length,rowsPerPage:s.rowsPerPage,onPageChange:s.onChangePage,onChangeDense:s.onChangeDense,onRowsPerPageChange:s.onChangeRowsPerPage})]})]})}function Be({inputData:s,comparator:c,filters:n}){const{name:a,status:o}=n,i=s.map((t,h)=>[t,h]);return i.sort((t,h)=>{const x=c(t[0],h[0]);return x!==0?x:t[1]-h[1]}),s=i.map(t=>t[0]),a&&(s=s.filter(t=>t.name.toLowerCase().indexOf(a.toLowerCase())!==-1||t.email.toLowerCase().indexOf(a.toLowerCase())!==-1)),o!=="all"&&(s=s.filter(t=>t.status===o)),s}const Le={title:`Lista de corretores | Dashboard - ${xe.appName}`};function Ye(){return e.jsxs(e.Fragment,{children:[e.jsx(de,{children:e.jsxs("title",{children:[" ",Le.title," "]})}),e.jsx(Se,{})]})}export{Ye as default};

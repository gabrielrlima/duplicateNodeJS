import{r as d,a8 as v,a9 as E,aa as F,ab as Ce,ac as _,ad as G,ae as ee,af as se,ag as oe,j as l,s as V,ah as ve,ai as re,aj as Ee,ak as ae,al as Se,u as je,am as H,an as Pe,ao as U,V as Te,W as Ae,y as Le,z as Me,p as J,ap as Re,aq as X,ar as Ie,B as I,F as Ne,O as Oe,L as De,K as W,a0 as K,a1 as Y,I as Z,f as ze,Q as O,H as Fe}from"./index-D82XrlGq.js";import{C as We}from"./config-global-DAqS2tYC.js";import{C as Be}from"./ClickAwayListener-OZO-zTsG.js";function He(){const[t,s]=d.useState(!1),[f,n]=d.useState(null),w=d.useCallback(async e=>{var a,o;s(!0),n(null);try{const r=(await v.post(E.auth.signIn,{email:e.email,password:e.password})).data.data;if(!r)throw new Error("Dados não encontrados na resposta do servidor");const{token:c,user:h}=r;if(!c)throw new Error("Token não recebido do servidor");if(!h)throw new Error("Dados do usuário não recebidos do servidor");return await F(c),{...h,accessToken:c}}catch(i){const r=((o=(a=i.response)==null?void 0:a.data)==null?void 0:o.message)||"Erro ao fazer login";throw n(r),new Error(r)}finally{s(!1)}},[]),y=d.useCallback(async e=>{s(!0),n(null);try{const a={firstName:e.firstName,lastName:e.lastName,email:e.email.toLowerCase().trim(),password:e.password,passwordConfirmation:e.password,phone:e.phone||"",businessId:e.businessId||""},o=await v.post(E.auth.signUp,a);if(!o.data)throw new Error("Resposta vazia do servidor");const i=o.data.data;if(!i)throw new Error("Dados não encontrados na resposta do servidor");const{token:r,user:c}=i;if(!r)throw new Error("Token não recebido do servidor");if(!c)throw new Error("Dados do usuário não recebidos do servidor");return await F(r),{...c,accessToken:r}}catch(a){let o="Erro ao fazer registro";if(a.response){const{status:i,data:r}=a.response;if(r!=null&&r.message)o=r.message;else if(r!=null&&r.errors&&Array.isArray(r.errors))o=r.errors.map(c=>c.message).join(", ");else switch(i){case 400:o="Dados inválidos. Verifique as informações.";break;case 422:o="Este e-mail já está cadastrado.";break;case 500:o="Erro interno do servidor. Tente novamente.";break;default:o=`Erro no servidor (${i}). Tente novamente.`}}else a.request?o="Erro de conexão. Verifique sua internet e tente novamente.":a.message&&(o=a.message);throw n(o),new Error(o)}finally{s(!1)}},[]),b=d.useCallback(async e=>{var a,o;s(!0),n(null);try{return(await v.post(E.auth.checkEmail,{email:e.toLowerCase().trim()})).data.data}catch(i){const r=((o=(a=i.response)==null?void 0:a.data)==null?void 0:o.message)||"Erro ao verificar email";throw n(r),new Error(r)}finally{s(!1)}},[]),x=d.useCallback(async()=>{s(!0),n(null);try{await v.post(E.auth.logout)}catch(e){console.warn("Erro ao fazer logout no servidor:",e)}finally{await F(null),s(!1)}},[]),k=d.useCallback(async e=>{var a,o;s(!0),n(null);try{return(await v.post(E.auth.forgotPassword,{email:e})).data}catch(i){const r=((o=(a=i.response)==null?void 0:a.data)==null?void 0:o.message)||"Erro ao enviar email de recuperação";throw n(r),new Error(r)}finally{s(!1)}},[]),S=d.useCallback(async(e,a,o,i)=>{var r,c;s(!0),n(null);try{return(await v.post(E.auth.resetPassword,{token:e,email:a,password:o,password_confirmation:i})).data}catch(h){const g=((c=(r=h.response)==null?void 0:r.data)==null?void 0:c.message)||"Erro ao redefinir senha";throw n(g),new Error(g)}finally{s(!1)}},[]),m=d.useCallback(async(e,a)=>{var o,i;s(!0),n(null);try{return(await v.post(E.auth.verifyEmail,{email:e,token:a})).data}catch(r){const c=((i=(o=r.response)==null?void 0:o.data)==null?void 0:i.message)||"Erro ao verificar email";throw n(c),new Error(c)}finally{s(!1)}},[]),j=d.useCallback(async e=>{var a,o;s(!0),n(null);try{return(await v.post(E.auth.resendVerification,{email:e})).data}catch(i){const r=((o=(a=i.response)==null?void 0:a.data)==null?void 0:o.message)||"Erro ao reenviar email de verificação";throw n(r),new Error(r)}finally{s(!1)}},[]),P=d.useCallback(async(e,a,o)=>{var r,c;s(!0),n(null);const i={email:e.toLowerCase().trim()};a&&a.trim().length>=2&&(i.name=a.trim()),o&&o.trim().length>=2&&(i.surname=o.trim());try{return(await v.post(E.auth.sendVerificationCode,i)).data}catch(h){const g=((c=(r=h.response)==null?void 0:r.data)==null?void 0:c.message)||"Erro ao enviar código de verificação";throw n(g),new Error(g)}finally{s(!1)}},[]),L=d.useCallback(async(e,a)=>{var o,i;s(!0),n(null);try{return(await v.post(E.auth.verifyCode,{email:e.toLowerCase().trim(),code:a.trim()})).data}catch(r){const c=((i=(o=r.response)==null?void 0:o.data)==null?void 0:i.message)||"Código inválido ou expirado";throw n(c),new Error(c)}finally{s(!1)}},[]),N=d.useCallback(async()=>{try{const e=await v.post(E.auth.refresh),{token:a}=e.data;if(a)return await F(a),a;throw new Error("Token não recebido")}catch(e){throw console.error("Erro ao renovar token:",e),await F(null),e}},[]),M=d.useCallback(async e=>{var a,o,i,r;s(!0),n(null);try{return(await v.post(E.auth.checkEmail,{email:e.toLowerCase().trim()})).data}catch(c){if(((a=c.response)==null?void 0:a.status)===422)return{success:!1,message:((o=c.response.data)==null?void 0:o.message)||"Email não disponível",data:{email:e.toLowerCase().trim(),is_available:!1},error_type:"email_already_exists"};const h=((r=(i=c.response)==null?void 0:i.data)==null?void 0:r.message)||"Erro ao verificar email";throw n(h),new Error(h)}finally{s(!1)}},[]),z=d.useCallback(async()=>{var e,a;try{return(await v.get(E.auth.passwordRequirements)).data}catch(o){const i=((a=(e=o.response)==null?void 0:e.data)==null?void 0:a.message)||"Erro ao obter requisitos de senha";return console.error(i),null}},[]),u=d.useCallback(async e=>{var a,o;try{return(await v.post(E.auth.checkPasswordStrength,{password:e})).data}catch(i){const r=((o=(a=i.response)==null?void 0:a.data)==null?void 0:o.message)||"Erro ao verificar força da senha";return console.error(r),null}},[]),p=d.useCallback(()=>{n(null)},[]);return{loading:t,error:f,signIn:w,signUp:y,signOut:x,forgotPassword:k,resetPassword:S,verifyEmail:m,resendVerification:j,sendVerificationCode:P,verifyCode:L,refreshToken:N,checkEmail:M,checkEmailAvailability:b,passwordRequirements:z,checkPasswordStrength:u,clearError:p}}function Ue(t={}){const{autoHideDuration:s=null,disableWindowBlurListener:f=!1,onClose:n,open:w,resumeHideDuration:y}=t,b=Ce();d.useEffect(()=>{if(!w)return;function u(p){p.defaultPrevented||p.key==="Escape"&&(n==null||n(p,"escapeKeyDown"))}return document.addEventListener("keydown",u),()=>{document.removeEventListener("keydown",u)}},[w,n]);const x=_((u,p)=>{n==null||n(u,p)}),k=_(u=>{!n||u==null||b.start(u,()=>{x(null,"timeout")})});d.useEffect(()=>(w&&k(s),b.clear),[w,s,k,b]);const S=u=>{n==null||n(u,"clickaway")},m=b.clear,j=d.useCallback(()=>{s!=null&&k(y??s*.5)},[s,y,k]),P=u=>p=>{const e=u.onBlur;e==null||e(p),j()},L=u=>p=>{const e=u.onFocus;e==null||e(p),m()},N=u=>p=>{const e=u.onMouseEnter;e==null||e(p),m()},M=u=>p=>{const e=u.onMouseLeave;e==null||e(p),j()};return d.useEffect(()=>{if(!f&&w)return window.addEventListener("focus",j),window.addEventListener("blur",m),()=>{window.removeEventListener("focus",j),window.removeEventListener("blur",m)}},[f,w,j,m]),{getRootProps:(u={})=>{const p={...G(t),...G(u)};return{role:"presentation",...u,...p,onBlur:P(p),onFocus:L(p),onMouseEnter:N(p),onMouseLeave:M(p)}},onClickAway:S}}function Ve(t){return ee("MuiSnackbarContent",t)}se("MuiSnackbarContent",["root","message","action"]);const qe=t=>{const{classes:s}=t;return re({root:["root"],action:["action"],message:["message"]},Ve,s)},$e=V(Ee,{name:"MuiSnackbarContent",slot:"Root",overridesResolver:(t,s)=>s.root})(ae(({theme:t})=>{const s=t.palette.mode==="light"?.8:.98,f=Se(t.palette.background.default,s);return{...t.typography.body2,color:t.vars?t.vars.palette.SnackbarContent.color:t.palette.getContrastText(f),backgroundColor:t.vars?t.vars.palette.SnackbarContent.bg:f,display:"flex",alignItems:"center",flexWrap:"wrap",padding:"6px 16px",borderRadius:(t.vars||t).shape.borderRadius,flexGrow:1,[t.breakpoints.up("sm")]:{flexGrow:"initial",minWidth:288}}})),_e=V("div",{name:"MuiSnackbarContent",slot:"Message",overridesResolver:(t,s)=>s.message})({padding:"8px 0"}),Ge=V("div",{name:"MuiSnackbarContent",slot:"Action",overridesResolver:(t,s)=>s.action})({display:"flex",alignItems:"center",marginLeft:"auto",paddingLeft:16,marginRight:-8}),Je=d.forwardRef(function(s,f){const n=oe({props:s,name:"MuiSnackbarContent"}),{action:w,className:y,message:b,role:x="alert",...k}=n,S=n,m=qe(S);return l.jsxs($e,{role:x,square:!0,elevation:6,className:ve(m.root,y),ownerState:S,ref:f,...k,children:[l.jsx(_e,{className:m.message,ownerState:S,children:b}),w?l.jsx(Ge,{className:m.action,ownerState:S,children:w}):null]})});function Xe(t){return ee("MuiSnackbar",t)}se("MuiSnackbar",["root","anchorOriginTopCenter","anchorOriginBottomCenter","anchorOriginTopRight","anchorOriginBottomRight","anchorOriginTopLeft","anchorOriginBottomLeft"]);const Ke=t=>{const{classes:s,anchorOrigin:f}=t,n={root:["root",`anchorOrigin${U(f.vertical)}${U(f.horizontal)}`]};return re(n,Xe,s)},Ye=V("div",{name:"MuiSnackbar",slot:"Root",overridesResolver:(t,s)=>{const{ownerState:f}=t;return[s.root,s[`anchorOrigin${U(f.anchorOrigin.vertical)}${U(f.anchorOrigin.horizontal)}`]]}})(ae(({theme:t})=>({zIndex:(t.vars||t).zIndex.snackbar,position:"fixed",display:"flex",left:8,right:8,justifyContent:"center",alignItems:"center",variants:[{props:({ownerState:s})=>s.anchorOrigin.vertical==="top",style:{top:8,[t.breakpoints.up("sm")]:{top:24}}},{props:({ownerState:s})=>s.anchorOrigin.vertical!=="top",style:{bottom:8,[t.breakpoints.up("sm")]:{bottom:24}}},{props:({ownerState:s})=>s.anchorOrigin.horizontal==="left",style:{justifyContent:"flex-start",[t.breakpoints.up("sm")]:{left:24,right:"auto"}}},{props:({ownerState:s})=>s.anchorOrigin.horizontal==="right",style:{justifyContent:"flex-end",[t.breakpoints.up("sm")]:{right:24,left:"auto"}}},{props:({ownerState:s})=>s.anchorOrigin.horizontal==="center",style:{[t.breakpoints.up("sm")]:{left:"50%",right:"auto",transform:"translateX(-50%)"}}}]}))),Q=d.forwardRef(function(s,f){const n=oe({props:s,name:"MuiSnackbar"}),w=je(),y={enter:w.transitions.duration.enteringScreen,exit:w.transitions.duration.leavingScreen},{action:b,anchorOrigin:{vertical:x,horizontal:k}={vertical:"bottom",horizontal:"left"},autoHideDuration:S=null,children:m,className:j,ClickAwayListenerProps:P,ContentProps:L,disableWindowBlurListener:N=!1,message:M,onBlur:z,onClose:u,onFocus:p,onMouseEnter:e,onMouseLeave:a,open:o,resumeHideDuration:i,slots:r={},slotProps:c={},TransitionComponent:h,transitionDuration:g=y,TransitionProps:{onEnter:A,onExited:q,...te}={},...ne}=n,D={...n,anchorOrigin:{vertical:x,horizontal:k},autoHideDuration:S,disableWindowBlurListener:N,TransitionComponent:h,transitionDuration:g},ie=Ke(D),{getRootProps:le,onClickAway:ce}=Ue({...D}),[de,$]=d.useState(!0),ue=C=>{$(!0),q&&q(C)},pe=(C,T)=>{$(!1),A&&A(C,T)},B={slots:{transition:h,...r},slotProps:{content:L,clickAwayListener:P,transition:te,...c}},[me,fe]=H("root",{ref:f,className:[ie.root,j],elementType:Ye,getSlotProps:le,externalForwardedProps:{...B,...ne},ownerState:D}),[he,{ownerState:ge,...we}]=H("clickAwayListener",{elementType:Be,externalForwardedProps:B,getSlotProps:C=>({onClickAway:(...T)=>{var R;(R=C.onClickAway)==null||R.call(C,...T),ce(...T)}}),ownerState:D}),[ye,xe]=H("content",{elementType:Je,shouldForwardComponentProp:!0,externalForwardedProps:B,additionalProps:{message:M,action:b},ownerState:D}),[be,ke]=H("transition",{elementType:Pe,externalForwardedProps:B,getSlotProps:C=>({onEnter:(...T)=>{var R;(R=C.onEnter)==null||R.call(C,...T),pe(...T)},onExited:(...T)=>{var R;(R=C.onExited)==null||R.call(C,...T),ue(...T)}}),additionalProps:{appear:!0,in:o,timeout:g,direction:x==="top"?"down":"up"},ownerState:D});return!o&&de?null:l.jsx(he,{...we,...r.clickAwayListener&&{ownerState:ge},children:l.jsx(me,{...fe,children:l.jsx(be,{...ke,children:m||l.jsx(ye,{...xe})})})})}),Ze=Oe({firstName:O().min(2,{message:"Nome deve ter pelo menos 2 caracteres!"}),lastName:O().min(2,{message:"Sobrenome deve ter pelo menos 2 caracteres!"}),email:O().min(1,{message:"E-mail é obrigatório!"}).email({message:"E-mail deve ser um endereço válido!"}),password:O().min(1,{message:"Senha é obrigatória!"}).min(8,{message:"Senha deve ter pelo menos 8 caracteres!"}).regex(/^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?=.*[@$!%*?&])[A-Za-z\d@$!%*?&]/,{message:"Senha deve conter ao menos: 1 maiúscula, 1 minúscula, 1 número e 1 caractere especial!"}),passwordConfirmation:O().min(1,{message:"Confirmação de senha é obrigatória!"}),phone:O().optional(),businessId:O().optional()}).refine(t=>t.password===t.passwordConfirmation,{message:"As senhas não coincidem!",path:["passwordConfirmation"]});function Qe({defaultValues:t}){const s=Te(),{checkUserSession:f}=Ae(),{signUp:n,checkEmail:w,error:y,clearError:b}=He(),[x,k]=d.useState(!1),[S,m]=d.useState(""),[j,P]=d.useState(""),L=Le({resolver:Me(Ze),defaultValues:t||{firstName:"",lastName:"",email:"",password:"",passwordConfirmation:""}}),{handleSubmit:N,reset:M}=L;d.useEffect(()=>{M({firstName:"",lastName:"",email:"",password:"",passwordConfirmation:""}),k(!1),m(""),P("")},[M]);const z=N(async e=>{var a,o,i,r,c,h;try{if(m(""),P(""),!((a=(await w(e.email)).data)!=null&&a.is_available)){m("Este e-mail já está cadastrado. Tente fazer login ou use outro e-mail.");return}await n({firstName:e.firstName,lastName:e.lastName,email:e.email,password:e.password,passwordConfirmation:e.passwordConfirmation,phone:"",businessId:""}),P("Conta criada com sucesso! Redirecionando..."),await new Promise(A=>setTimeout(A,1500)),s.push(J.dashboard.root),setTimeout(()=>{f().catch(console.error)},100)}catch(g){console.error("Erro no cadastro:",g);let A="Erro ao criar conta. Tente novamente.";((o=g.response)==null?void 0:o.status)===422?A=((r=(i=g.response)==null?void 0:i.data)==null?void 0:r.message)||"Dados inválidos. Verifique as informações.":(h=(c=g.response)==null?void 0:c.data)!=null&&h.message?A=g.response.data.message:g.message&&(A=g.message),m(A)}}),u=l.jsxs(I,{sx:{textAlign:"center",mb:5},children:[l.jsx(I,{component:"h4",sx:{mb:1,typography:"h4"},children:"Criar Conta"}),l.jsxs(I,{component:"p",sx:{color:"text.secondary",typography:"body2",mt:1},children:["Já tem uma conta?",l.jsx(De,{href:J.auth.signIn,variant:"subtitle2",sx:{ml:.5},children:"Entrar"})]})]}),p=l.jsxs(I,{sx:{gap:3,display:"flex",flexDirection:"column",transition:"all 0.3s ease-in-out"},children:[l.jsx(W.Text,{name:"firstName",label:"Nome",placeholder:"Seu nome",InputLabelProps:{shrink:!0},autoComplete:"given-name"}),l.jsx(W.Text,{name:"lastName",label:"Sobrenome",placeholder:"Seu sobrenome",InputLabelProps:{shrink:!0},autoComplete:"family-name"}),l.jsx(W.Text,{name:"email",label:"E-mail",placeholder:"exemplo@email.com",InputLabelProps:{shrink:!0},autoComplete:"email"}),l.jsx(W.Text,{name:"password",label:"Senha",placeholder:"Sua senha",type:x?"text":"password",InputLabelProps:{shrink:!0},InputProps:{endAdornment:l.jsx(K,{position:"end",children:l.jsx(Y,{onClick:()=>k(!x),edge:"end",children:l.jsx(Z,{icon:x?"solar:eye-bold":"solar:eye-closed-bold"})})})},autoComplete:"new-password"}),l.jsx(W.Text,{name:"passwordConfirmation",label:"Confirmar Senha",placeholder:"Confirme sua senha",type:x?"text":"password",InputLabelProps:{shrink:!0},InputProps:{endAdornment:l.jsx(K,{position:"end",children:l.jsx(Y,{onClick:()=>k(!x),edge:"end",children:l.jsx(Z,{icon:x?"solar:eye-bold":"solar:eye-closed-bold"})})})},autoComplete:"new-password"}),l.jsx(ze,{fullWidth:!0,size:"large",type:"submit",variant:"contained",children:"Criar conta"}),l.jsxs(I,{sx:{textAlign:"center",color:"text.secondary",typography:"body2",px:1},children:["Ao me inscrever, concordo com os"," ",l.jsx(I,{component:"span",sx:{fontWeight:"bold",color:"text.primary"},children:"termos de uso"})," ","e a"," ",l.jsx(I,{component:"span",sx:{fontWeight:"bold",color:"text.primary"},children:"política de privacidade"}),"."]})]});return l.jsxs(l.Fragment,{children:[u,l.jsx(Q,{open:!!(S||y),autoHideDuration:6e3,onClose:()=>{m(""),y&&b()},TransitionComponent:Re,anchorOrigin:{vertical:"top",horizontal:"center"},sx:{mt:2},ClickAwayListenerProps:{onClickAway:()=>{m(""),y&&b()}},children:l.jsx(X,{severity:"error",onClose:()=>{m(""),y&&b()},sx:{boxShadow:3,borderRadius:2,minWidth:300,"& .MuiAlert-message":{fontWeight:500},animation:"shake 0.5s ease-in-out"},children:S||y})}),l.jsx(Q,{open:!!j,autoHideDuration:6e3,onClose:()=>P(""),TransitionComponent:Ie,anchorOrigin:{vertical:"top",horizontal:"center"},sx:{mt:2},ClickAwayListenerProps:{onClickAway:()=>P("")},children:l.jsx(X,{severity:"success",onClose:()=>P(""),sx:{boxShadow:3,borderRadius:2,minWidth:300,"& .MuiAlert-message":{fontWeight:500}},children:j})}),l.jsx(I,{sx:{"@keyframes shake":{"0%, 100%":{transform:"translateX(0)"},"10%, 30%, 50%, 70%, 90%":{transform:"translateX(-2px)"},"20%, 40%, 60%, 80%":{transform:"translateX(2px)"}},"@keyframes fadeIn":{"0%":{opacity:0,transform:"translateY(-10px)"},"100%":{opacity:1,transform:"translateY(0)"}}}}),l.jsx(Ne,{methods:L,onSubmit:z,children:p})]})}function es(){return l.jsx(Qe,{})}const ss={title:`Cadastro | ${We.site.name}`};function ts(){return l.jsxs(l.Fragment,{children:[l.jsx(Fe,{children:l.jsxs("title",{children:[" ",ss.title," "]})}),l.jsx(es,{})]})}export{ts as default};

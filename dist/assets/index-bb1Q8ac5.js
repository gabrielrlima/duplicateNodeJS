import{W as $,V as W,u as B,a as q,r as c,p as A,j as s,B as f,ay as H,d1 as N,aJ as O,T as U,q as ss,A as S,ca as es,cb as ts,c3 as as,a1 as D,I as w,D as ns,cc as os,cd as R,d2 as rs,dL as is,dJ as ls,dT as cs,f1 as ds,c$ as hs,ck as ps,dU as xs,ax as ms,c4 as us,au as gs,a0 as js,X as Cs,b8 as fs,C as F,H as ys}from"./index-D82XrlGq.js";import{g as bs,i as vs,h as ks,j as ws,u as Is,k as Ns,a as As,b as M,C as Ss,c as $s,d as Ts,e as Ls,f as Rs}from"./use-collapse-nav-CeNSFNTp.js";import{E as P}from"./empty-content-CAmd9egU.js";import{T as Ds,C as Fs}from"./styles-BlGNM00e.js";import{A as Ws}from"./AvatarGroup-BSnlJl2K.js";import{C as Us}from"./ClickAwayListener-OZO-zTsG.js";import"./use-light-box-dXPttcOB.js";import"./index-nX3EE7Rc.js";import"./index-AY8D22yG.js";import"./keyBy-Dc3MaNHd.js";import"./Skeleton-B8_s61tm.js";import"./calendar-form-BY3cR15k.js";import"./color-preview-fxJWItmu.js";function Es({currentUserId:a,conversation:o}){const{messages:r,participants:l}=o,n=l.filter(p=>p.id!==a),i=r[r.length-1],e=n.length>1,t=n.map(p=>p.name).join(", "),h=e?n.map(p=>p.status).includes("online"):!1;let u="";if(i){const p=i.senderId===a?"You: ":"",x=i.contentType==="image"?"Sent a photo":i.body;u=`${p}${x}`}return{group:e,displayName:t,displayText:u,participants:n,lastActivity:i.createdAt,hasOnlineInGroup:h}}function Ms({selected:a,collapse:o,conversation:r,onCloseMobile:l}){const{user:n}=$(),i=W(),e=B(),t=q(e.breakpoints.up("md")),{group:h,displayName:u,displayText:p,participants:x,lastActivity:k,hasOnlineInGroup:g}=Es({conversation:r,currentUserId:`${n==null?void 0:n.id}`}),d=x[0],j=c.useCallback(async()=>{try{t||l(),await bs(r.id);const y=`${A.dashboard.chat}?id=${r.id}`;c.startTransition(()=>{i.push(y)})}catch(y){console.error(y)}},[r.id,t,l,i]),b=()=>s.jsx(N,{variant:g?"online":"invisible",badgeContent:"",children:s.jsx(Ws,{variant:"compact",sx:{width:48,height:48},children:x.slice(0,2).map(y=>s.jsx(S,{alt:y.name,src:y.avatarUrl},y.id))})}),v=()=>s.jsx(N,{variant:d==null?void 0:d.status,badgeContent:"",children:s.jsx(S,{alt:d==null?void 0:d.name,src:d==null?void 0:d.avatarUrl,sx:{width:48,height:48}})});return s.jsx(f,{component:"li",sx:{display:"flex"},children:s.jsxs(H,{onClick:j,sx:{py:1.5,px:2.5,gap:2,...a&&{bgcolor:"action.selected"}},children:[s.jsx(N,{color:"error",overlap:"circular",badgeContent:o?r.unreadCount:0,children:h?b():v()}),!o&&s.jsxs(s.Fragment,{children:[s.jsx(O,{primary:u,secondary:p,slotProps:{primary:{noWrap:!0},secondary:{noWrap:!0,sx:{...r.unreadCount&&{color:"text.primary",fontWeight:"fontWeightSemiBold"}}}}}),s.jsxs(f,{sx:{display:"flex",alignSelf:"stretch",alignItems:"flex-end",flexDirection:"column"},children:[s.jsx(U,{noWrap:!0,variant:"body2",component:"span",sx:{mb:1.5,fontSize:12,color:"text.disabled"},children:ss(k)}),!!r.unreadCount&&s.jsx(f,{component:"span",sx:{width:8,height:8,borderRadius:"50%",bgcolor:"info.main"}})]})]})]})})}function Ps(){var e;const{user:a}=$(),o=es(),[r,l]=c.useState("online"),n=c.useCallback(t=>{l(t.target.value)},[]),i=()=>s.jsxs(ts,{open:o.open,anchorEl:o.anchorEl,onClose:o.onClose,slotProps:{paper:{sx:{p:0,ml:0,mt:.5}},arrow:{placement:"top-left"}},children:[s.jsxs(f,{sx:{py:2,pr:1,pl:2,gap:2,display:"flex",alignItems:"center"},children:[s.jsx(O,{primary:a==null?void 0:a.displayName,secondary:a==null?void 0:a.email}),s.jsx(as,{title:"Log out",children:s.jsx(D,{color:"error",children:s.jsx(w,{icon:"ic:round-power-settings-new"})})})]}),s.jsx(ns,{sx:{borderStyle:"dashed"}}),s.jsxs(os,{sx:{my:.5,px:.5},children:[s.jsxs(R,{children:[s.jsx(N,{variant:r,badgeContent:"",sx:{width:24,height:24,alignItems:"center",justifyContent:"center",[`& .${rs.badge}`]:{width:12,height:12,transform:"unset",position:"static"}}}),s.jsx(is,{fullWidth:!0,children:s.jsx(ls,{native:!0,fullWidth:!0,value:r,onChange:n,input:s.jsx(hs,{}),inputProps:{id:"chat-status-select"},sx:{[`& .${ds.root}`]:{right:0},[`& .${cs.input}`]:{typography:"body2",textTransform:"capitalize"}},children:["online","always","busy","offline"].map(t=>s.jsx("option",{value:t,children:t},t))})})]}),s.jsxs(R,{children:[s.jsx(w,{width:24,icon:"solar:user-id-bold"}),"Profile"]}),s.jsxs(R,{children:[s.jsx(w,{width:24,icon:"eva:settings-2-fill"}),"Settings"]})]})]});return s.jsxs(s.Fragment,{children:[s.jsx(N,{variant:r,badgeContent:"",overlap:"circular",anchorOrigin:{vertical:"bottom",horizontal:"right"},children:s.jsx(S,{src:a==null?void 0:a.photoURL,alt:a==null?void 0:a.displayName,onClick:o.onOpen,sx:{cursor:"pointer",width:48,height:48},children:(e=a==null?void 0:a.displayName)==null?void 0:e.charAt(0).toUpperCase()})}),i()]})}function Gs({query:a,results:o,onClickResult:r}){const l=o.length,n=!l&&!!a,i=()=>s.jsx(ps,{query:a,sx:{p:3,mx:"auto",width:"calc(100% - 40px)",bgcolor:"background.neutral"}}),e=()=>s.jsx("nav",{children:s.jsx(f,{component:"ul",sx:{"& li":{display:"flex"}},children:o.map(t=>s.jsx("li",{children:s.jsxs(H,{onClick:()=>r(t),sx:{gap:2,py:1.5,px:2.5,typography:"subtitle2"},children:[s.jsx(S,{alt:t.name,src:t.avatarUrl}),t.name]})},t.id))})});return s.jsxs(s.Fragment,{children:[s.jsxs(U,{variant:"h6",sx:{px:2.5,mb:2},children:["Contacts (",l,")"]}),n?i():e()]})}const G=320,Bs=96;function qs({loading:a,contacts:o,collapseNav:r,conversations:l,selectedConversationId:n}){const i=W(),{user:e}=$(),t=B(),h=q(t.breakpoints.up("md")),{openMobile:u,onOpenMobile:p,onCloseMobile:x,onCloseDesktop:k,collapseDesktop:g,onCollapseDesktop:d}=r,[j,b]=c.useState({query:"",results:[]}),v=c.useMemo(()=>({id:`${e==null?void 0:e.id}`,role:`${e==null?void 0:e.role}`,email:`${e==null?void 0:e.email}`,address:`${e==null?void 0:e.address}`,name:`${e==null?void 0:e.displayName}`,lastActivity:xs(),avatarUrl:`${e==null?void 0:e.photoURL}`,phoneNumber:`${e==null?void 0:e.phoneNumber}`,status:"online"}),[e]);c.useEffect(()=>{h||k()},[k,h]);const y=c.useCallback(()=>{h?d():x()},[h,x,d]),z=c.useCallback(()=>{h||x(),i.push(A.dashboard.chat)},[h,x,i]),_=c.useCallback(m=>{if(b(I=>({...I,query:m})),m){const I=o.filter(C=>C.name.toLowerCase().includes(m.toLowerCase()));b(C=>({...C,results:I}))}},[o]),T=c.useCallback(()=>{b({query:"",results:[]})},[]),J=c.useCallback(async m=>{T();const I=C=>i.push(`${A.dashboard.chat}?id=${C}`);try{if(l.allIds.includes(m.id)){I(m.id);return}const C=o.find(Z=>Z.id===m.id);if(!C){console.error("Recipient not found");return}const{conversationData:K}=vs({recipients:[C],me:v}),L=await ks(K);(!L||!L.conversation)&&console.error("Failed to create conversation"),I(L.conversation.id)}catch(C){console.error("Error handling click result:",C)}},[o,l.allIds,T,v,i]),V=()=>s.jsx(ws,{}),Q=()=>s.jsx("nav",{children:s.jsx(f,{component:"ul",children:l.allIds.map(m=>s.jsx(Ms,{collapse:g,conversation:l.byId[m],selected:m===n,onCloseMobile:x},m))})}),X=()=>s.jsx(Gs,{query:j.query,results:j.results,onClickResult:J}),Y=()=>s.jsx(Us,{onClickAway:T,children:s.jsx(gs,{fullWidth:!0,value:j.query,onChange:m=>_(m.target.value),placeholder:"Search contacts...",slotProps:{input:{startAdornment:s.jsx(js,{position:"start",children:s.jsx(w,{icon:"eva:search-fill",sx:{color:"text.disabled"}})})}},sx:{mt:2.5}})}),E=()=>s.jsxs(s.Fragment,{children:[s.jsxs(f,{sx:{p:2.5,pb:0,display:"flex",alignItems:"center",justifyContent:"center"},children:[!g&&s.jsxs(s.Fragment,{children:[s.jsx(Ps,{}),s.jsx(f,{sx:{flexGrow:1}})]}),s.jsx(D,{onClick:y,children:s.jsx(w,{icon:g?"eva:arrow-ios-forward-fill":"eva:arrow-ios-back-fill"})}),!g&&s.jsx(D,{onClick:z,children:s.jsx(w,{width:24,icon:"solar:user-plus-bold"})})]}),s.jsx(f,{sx:{p:2.5,pt:0},children:!g&&Y()}),a?V():s.jsx(us,{sx:{pb:1},children:j.query&&l.allIds.length?X():Q()})]});return s.jsxs(s.Fragment,{children:[s.jsx(Ds,{onClick:p,sx:{display:{md:"none"}},children:s.jsx(w,{width:16,icon:"solar:users-group-rounded-bold"})}),s.jsx(f,{sx:{minHeight:0,flex:"1 1 auto",width:G,flexDirection:"column",display:{xs:"none",md:"flex"},borderRight:`solid 1px ${t.vars.palette.divider}`,transition:t.transitions.create(["width"],{duration:t.transitions.duration.shorter}),...g&&{width:Bs}},children:E()}),s.jsx(ms,{open:u,onClose:x,slotProps:{backdrop:{invisible:!0}},PaperProps:{sx:{width:G}},children:E()})]})}function Hs(){const a=W(),{user:o}=$(),{contacts:r}=Is(),n=Cs().get("id")||"",{conversations:i,conversationsLoading:e}=Ns(),{conversation:t,conversationError:h,conversationLoading:u}=As(n),p=M(),x=M(),[k,g]=c.useState([]);c.useEffect(()=>{n||c.startTransition(()=>{a.push(A.dashboard.chat)})},[h,a,n]);const d=c.useCallback(v=>{g(v)},[]),j=t?t.participants.filter(v=>v.id!==`${o==null?void 0:o.id}`):[],b=n&&t;return s.jsxs(fs,{maxWidth:!1,sx:{display:"flex",flex:"1 1 auto",flexDirection:"column"},children:[s.jsx(U,{variant:"h4",sx:{mb:{xs:3,md:5}},children:"Chat"}),s.jsx(Fs,{slots:{header:b?s.jsx(Ls,{collapseNav:p,participants:j,loading:u}):s.jsx(Rs,{contacts:r,onAddRecipients:d}),nav:s.jsx(qs,{contacts:r,conversations:i,selectedConversationId:n,collapseNav:x,loading:e}),main:s.jsxs(s.Fragment,{children:[n?h?s.jsx(P,{title:h.message,imgUrl:`${F.assetsDir}/assets/icons/empty/ic-chat-empty.svg`}):s.jsx($s,{messages:(t==null?void 0:t.messages)??[],participants:j,loading:u}):s.jsx(P,{title:"Good morning!",description:"Write something awesome...",imgUrl:`${F.assetsDir}/assets/icons/empty/ic-chat-active.svg`}),s.jsx(Ts,{recipients:k,onAddRecipients:d,selectedConversationId:n,disabled:!k.length&&!n})]}),details:b&&s.jsx(Ss,{collapseNav:p,participants:j,loading:u,messages:(t==null?void 0:t.messages)??[]})}})]})}const Os={title:`Chat | Dashboard - ${F.appName}`};function ne(){return s.jsxs(s.Fragment,{children:[s.jsx(ys,{children:s.jsxs("title",{children:[" ",Os.title]})}),s.jsx(Hs,{})]})}export{ne as default};
